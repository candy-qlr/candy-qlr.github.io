(self.webpackChunkvuepress_blog=self.webpackChunkvuepress_blog||[]).push([[133],{1495:(n,s,a)=>{"use strict";a.r(s),a.d(s,{data:()=>t});const t={key:"v-13a6fb92",path:"/guide/vue/vue%E5%93%8D%E5%BA%94%E5%BC%8F.html",title:"Vue 响应式原理",lang:"en-US",frontmatter:{title:"Vue 响应式原理"},excerpt:"",headers:[{level:2,title:"数据驱动",slug:"数据驱动",children:[]},{level:2,title:"双向绑定",slug:"双向绑定",children:[]},{level:2,title:"数据响应式",slug:"数据响应式",children:[{level:3,title:"vue2 Object.defineProperty",slug:"vue2-object-defineproperty",children:[]},{level:3,title:"vue3 Proxy",slug:"vue3-proxy",children:[]},{level:3,title:"发布订阅模式",slug:"发布订阅模式",children:[]},{level:3,title:"观察者模式",slug:"观察者模式",children:[]},{level:3,title:"发布订阅模式 与 观察者模式区别",slug:"发布订阅模式-与-观察者模式区别",children:[]}]},{level:2,title:"vue 响应式原理模拟",slug:"vue-响应式原理模拟",children:[{level:3,title:"vue.js",slug:"vue-js",children:[]},{level:3,title:"observer.js",slug:"observer-js",children:[]},{level:3,title:"compiler.js",slug:"compiler-js",children:[]},{level:3,title:"dep.js",slug:"dep-js",children:[]},{level:3,title:"watcher.js",slug:"watcher-js",children:[]}]}],filePathRelative:"guide/vue/vue响应式.md",git:{updatedTime:1625015909e3,contributors:[]}}},9536:(n,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>N});var t=a(6252);const e=a.p+"assets/img/subpub.28cfd74e.jpg",c=a.p+"assets/img/vue响应式.0ccaef2f.jpg",p=a.p+"assets/img/watcher.d4b24d31.jpg",o=(0,t.Wm)("h2",{id:"数据驱动"},[(0,t.Wm)("a",{class:"header-anchor",href:"#数据驱动"},"#"),(0,t.Uk)(" 数据驱动")],-1),m=(0,t.Wm)("p",null,"开发过程中仅需要关注数据本身，不需要关注数据是如何渲染到视图",-1),l=(0,t.Wm)("h2",{id:"双向绑定"},[(0,t.Wm)("a",{class:"header-anchor",href:"#双向绑定"},"#"),(0,t.Uk)(" 双向绑定")],-1),u=(0,t.Wm)("p",null,"数据改变，视图改变；视图改变，数据也随之改变",-1),k=(0,t.Wm)("p",null,"我们可以使用 v-model 在表单元素上创建双向数据绑定",-1),W=(0,t.Wm)("h2",{id:"数据响应式"},[(0,t.Wm)("a",{class:"header-anchor",href:"#数据响应式"},"#"),(0,t.Uk)(" 数据响应式")],-1),r=(0,t.Wm)("p",null,"数据模型仅仅是普通的 JavaScript 对象，而当我们修改数据时，视图会进行更新，避免了繁琐的 DOM 操作，提高开发效率",-1),i=(0,t.Wm)("li",null,[(0,t.Wm)("h3",{id:"vue2-object-defineproperty"},[(0,t.Wm)("a",{class:"header-anchor",href:"#vue2-object-defineproperty"},"#"),(0,t.Uk)(" vue2 Object.defineProperty")]),(0,t.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" data "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    msg"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'hello'"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  \n"),(0,t.Wm)("span",{class:"token function"},"fn"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("data"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'msg'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" data"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("msg"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"fn"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("obj"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" val")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    Object"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"defineProperty"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("obj"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      enumerable"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token boolean"},"true"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 可枚举（可遍历）"),(0,t.Uk)("\n      configurable"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token boolean"},"true"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 可配置（可以使用 delete 删除，可以通过 defineProperty 重新定义）"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token function"},"get"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" val\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token function"},"set"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("v"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("v "),(0,t.Wm)("span",{class:"token operator"},"==="),(0,t.Uk)(" val"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n          "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n        val "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" v\n        document"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"getElementById"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'app'"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("innerText "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" val\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"9"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"10"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"11"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"12"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"13"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"14"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"15"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"16"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"17"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"18"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"19"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"20"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"21"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"22"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"23"),(0,t.Wm)("br")])]),(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("p",null,"多个属性需要遍历 （ Object.keys(data).forEach()）")])],-1),b=(0,t.Wm)("li",null,[(0,t.Wm)("h3",{id:"vue3-proxy"},[(0,t.Wm)("a",{class:"header-anchor",href:"#vue3-proxy"},"#"),(0,t.Uk)(" vue3 Proxy")]),(0,t.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" data "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    msg"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'hello'"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" vm3 "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Proxy"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("data"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token function"},"get"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("target"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      console"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"log"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'get,target,key'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" target"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" target"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token function"},"set"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("target"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" v"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      console"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"log"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'set'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" v"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("v "),(0,t.Wm)("span",{class:"token operator"},"==="),(0,t.Uk)(" target"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n      target"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" v\n      document"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"getElementById"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'app'"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("innerText "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" target"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"9"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"10"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"11"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"12"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"13"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"14"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"15"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"16"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"17"),(0,t.Wm)("br")])]),(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("p",null,"直接监听对象，而非属性"),(0,t.Wm)("p",null,"ES 6中新增，IE不支持，性能有浏览器优化")])],-1),U=(0,t.Wm)("h3",{id:"发布订阅模式"},[(0,t.Wm)("a",{class:"header-anchor",href:"#发布订阅模式"},"#"),(0,t.Uk)(" 发布订阅模式")],-1),d=(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"订阅者")],-1),y=(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"发布者")],-1),v=(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"信号中心"),(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("p",null,"我们假定，存在一个“信号中心”，某个任务执行完成，就向信号中心“发布”（publish）一个信号，其他任务可以向信号中心“订阅”（subscribe）这个信号，从而知道什么时候自己可以开始执行。这就叫做**“发布/订阅模式”**（publish-subscribe pattern)")])],-1),h={href:"https://cn.vuejs.org/v2/guide/components-custom-events.html#ad",target:"_blank",rel:"noopener noreferrer"},f=(0,t.Uk)("vue自定义事件"),w=(0,t.uE)('<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">EventEmitter</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// {&#39;clicl&#39;:[fn1,fn2], &#39;change&#39;:[fn1]}</span>\n    <span class="token comment">// 记录事件及事件处理函数</span>\n    <span class="token comment">// Object.create(null) 创建没有原型的对象，可以提升性能</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>subs <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n\n\t<span class="token comment">// 订阅，注册事件</span>\n  <span class="token function">$on</span><span class="token punctuation">(</span><span class="token parameter">eventType<span class="token punctuation">,</span> handler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n\n\t<span class="token comment">// 发布，触发事件</span>\n  <span class="token function">$emit</span><span class="token punctuation">(</span><span class="token parameter">eventType<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">handler</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        <span class="token function">handler</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div>',1),g=(0,t.Wm)("li",null,[(0,t.Wm)("h3",{id:"观察者模式"},[(0,t.Wm)("a",{class:"header-anchor",href:"#观察者模式"},"#"),(0,t.Uk)(" 观察者模式")]),(0,t.Wm)("p",null,"没有事件中心"),(0,t.Wm)("p",null,"观察者（订阅者）-- Watcher"),(0,t.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token operator"},"*"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"update"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" 当事件发生时，具体要做的事情，所有订阅者都有一个 update 方法\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br")])]),(0,t.Wm)("p",null,"目标（发布者）-- Dep"),(0,t.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token operator"},"*"),(0,t.Uk)(" subs ：存储所有的观察者\n"),(0,t.Wm)("span",{class:"token operator"},"*"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"addSub"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" 添加观察者\n"),(0,t.Wm)("span",{class:"token operator"},"*"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"notify"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" 当事件发生时，调用所有观察者的 "),(0,t.Wm)("span",{class:"token function"},"update"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(" 方法\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br")])]),(0,t.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token comment"},"// 发布者-目标"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"class"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Dep"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"constructor"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("subs "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 记录所有的订阅者"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"addSub"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"sub"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("sub "),(0,t.Wm)("span",{class:"token operator"},"&&"),(0,t.Uk)(" sub"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("update"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("subs"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"push"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("sub"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"notify"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("subs"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"forEach"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"sub"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      sub"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"update"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token comment"},"// 订阅者-观察者"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"class"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Watcher"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"update"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 更新视图"),(0,t.Uk)("\n    console"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"log"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'update'"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token comment"},"// 测试"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" dep "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Dep"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" watcher "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Watcher"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\ndep"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"addSub"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("watcher"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token comment"},"// 事件发生后"),(0,t.Uk)("\ndep"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"notify"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"9"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"10"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"11"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"12"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"13"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"14"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"15"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"16"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"17"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"18"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"19"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"20"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"21"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"22"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"23"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"24"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"25"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"26"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"27"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"28"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"29"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"30"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"31"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"32"),(0,t.Wm)("br")])])],-1),j=(0,t.Wm)("li",null,[(0,t.Wm)("h3",{id:"发布订阅模式-与-观察者模式区别"},[(0,t.Wm)("a",{class:"header-anchor",href:"#发布订阅模式-与-观察者模式区别"},"#"),(0,t.Uk)(" 发布订阅模式 与 观察者模式区别")]),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"观察者模式是由具体目标调度，比如当事件触发，Dep就会去调用观察者的方法，所以观察者模式的订阅者与发布者之间是存在依赖的"),(0,t.Wm)("li",null,"发布/订阅模式由统一调度中心调用，因此发布者与订阅者不需要知道对方的存在")]),(0,t.Wm)("p",null,[(0,t.Wm)("img",{src:e,alt:"img"})])],-1),x=(0,t.Wm)("h2",{id:"vue-响应式原理模拟"},[(0,t.Wm)("a",{class:"header-anchor",href:"#vue-响应式原理模拟"},"#"),(0,t.Uk)(" vue 响应式原理模拟")],-1),E=(0,t.Wm)("p",null,[(0,t.Wm)("img",{src:c,alt:"img"})],-1),T=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"Vue"),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"记录传入的选项，设置 $data/$el"),(0,t.Wm)("li",null,"把 data 的成员注入到 Vue 实例 负责调用"),(0,t.Wm)("li",null,"Observer 实现数据响应式处理（数据劫持）"),(0,t.Wm)("li",null,"负责调用 Compiler 编译指令/插值表达式等"),(0,t.Wm)("li",null,[(0,t.Wm)("code",null,"$options $el $data _proxyData(data)")])])]),(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"Observer"),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Uk)("数据劫持 "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"负责把 data 中的成员转换成 getter/setter"),(0,t.Wm)("li",null,"负责把多层属性转换成 getter/setter"),(0,t.Wm)("li",null,"如果给属性赋值为新对象，把新对象的成员设置为 getter/setter")])]),(0,t.Wm)("li",null,"添加 Dep 和 Watcher 的依赖关系"),(0,t.Wm)("li",null,"数据变化发送通知"),(0,t.Wm)("li",null,[(0,t.Wm)("code",null,"walk(data) defineReactive(data.key,value)")])])]),(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"Compiler"),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"负责编译模板，解析指令/插值表达式"),(0,t.Wm)("li",null,"负责页面的首次渲染过程"),(0,t.Wm)("li",null,"当数据变化后重新渲染"),(0,t.Wm)("li",null,[(0,t.Wm)("code",null,"el vm compile(el) compileElement(node) compileText(node) isDirective(attrName) isTextNode(node) isElementNode(node)")])])]),(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"Dep"),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"收集依赖，添加订阅者(watcher)"),(0,t.Wm)("li",null,"通知所有订阅者"),(0,t.Wm)("li",null,[(0,t.Wm)("code",null,"subs addSub(sub) notify()")])])]),(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"Watcher"),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"自身实例化的时候往dep对象中添加自己"),(0,t.Wm)("li",null,"当数据变化dep通知所有的 Watcher 实例更新视图"),(0,t.Wm)("li",null,[(0,t.Wm)("code",null,"vm key cb oldValue update()")])]),(0,t.Wm)("p",null,[(0,t.Wm)("img",{src:p,alt:"img"})])])],-1),D=(0,t.Wm)("ol",null,[(0,t.Wm)("li",null,[(0,t.Wm)("h3",{id:"vue-js"},[(0,t.Wm)("a",{class:"header-anchor",href:"#vue-js"},"#"),(0,t.Uk)(),(0,t.Wm)("strong",null,[(0,t.Wm)("code",null,"vue.js")])]),(0,t.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"class"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Vue"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"constructor"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"options"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 1.通过属性保存选项的数据"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("$options "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" options "),(0,t.Wm)("span",{class:"token operator"},"||"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("$data "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" options"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("data "),(0,t.Wm)("span",{class:"token operator"},"||"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("$el "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"typeof"),(0,t.Uk)(" options"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("el "),(0,t.Wm)("span",{class:"token operator"},"==="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'string'"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"?"),(0,t.Uk)(" document"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"querySelector"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("options"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("el"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" options"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("el\n    "),(0,t.Wm)("span",{class:"token comment"},"// 2.把 data 中的成员转换成 getter 和 setter，注入到 vue 实例中"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"_proxyData"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("$data"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 3.调用 observer 对象，监听数据的变化"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Observer"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("$data"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 4.调用 compiler 对象，解析指令和插值表达式"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Compiler"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"_proxyData"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"data"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 遍历 data 中的所有属性"),(0,t.Uk)("\n    Object"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"keys"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("data"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"forEach"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"key"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      Object"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"defineProperty"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        configurable"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token boolean"},"true"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n        enumerable"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token boolean"},"true"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token function"},"get"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n          "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" data"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token function"},"set"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("val"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n          "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("val "),(0,t.Wm)("span",{class:"token operator"},"==="),(0,t.Uk)(" data"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n            "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)("\n          "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n          data"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" val\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 把 data 的属性注入到 vue 实例中"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n\n"),(0,t.Wm)("span",{class:"token comment"},"// 访问 属性时 先触发 _proxyData 中的 get,然后再触发 Observer 中的get"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"9"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"10"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"11"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"12"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"13"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"14"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"15"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"16"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"17"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"18"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"19"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"20"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"21"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"22"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"23"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"24"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"25"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"26"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"27"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"28"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"29"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"30"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"31"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"32"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"33"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"34"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"35"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"36"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"37"),(0,t.Wm)("br")])])]),(0,t.Wm)("li",null,[(0,t.Wm)("h3",{id:"observer-js"},[(0,t.Wm)("a",{class:"header-anchor",href:"#observer-js"},"#"),(0,t.Uk)(),(0,t.Wm)("strong",null,[(0,t.Wm)("code",null,"observer.js")])]),(0,t.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"class"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Observer"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"constructor"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"data"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"walk"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("data"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n  "),(0,t.Wm)("span",{class:"token comment"},"// 遍历对象的所有属性"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"walk"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"data"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 1.判断data是否是对象"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Uk)("data "),(0,t.Wm)("span",{class:"token operator"},"||"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"typeof"),(0,t.Uk)(" data "),(0,t.Wm)("span",{class:"token operator"},"!=="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'object'"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 2.遍历对象的所有属性"),(0,t.Uk)("\n    Object"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"keys"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("data"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"forEach"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"key"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"defineReactive"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("data"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" data"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    \n  "),(0,t.Wm)("span",{class:"token comment"},"// 把属性转换为 getter 和 setter"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"defineReactive"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("obj"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" value")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" that "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Uk)("\n\n    "),(0,t.Wm)("span",{class:"token comment"},"// 负责收集依赖，并且发送通知,为每个属性创建一个 dep 对象"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" dep "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Dep"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n\n    "),(0,t.Wm)("span",{class:"token comment"},"// 如果 val 是对象，会把 val 内部的属性也转换成响应式数据"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"walk"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("val"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n\n    Object"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"defineProperty"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("obj"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      configurable"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token boolean"},"true"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n      enumerable"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token boolean"},"true"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token function"},"get"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// 收集依赖"),(0,t.Uk)("\n        Dep"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("target "),(0,t.Wm)("span",{class:"token operator"},"&&"),(0,t.Uk)(" dep"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"addSub"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("Dep"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("target"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n\n        "),(0,t.Wm)("span",{class:"token comment"},"// 访问 属性时 先触发 _proxyData 中的 get,然后再触发 Observer 中的get"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// 如果不传 data[key],里面直接使用 data[key]时会造成死循环"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// 使用闭包扩展 val 的作用域"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" val\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token function"},"set"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("newVal"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("newVal "),(0,t.Wm)("span",{class:"token operator"},"==="),(0,t.Uk)(" val"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n          "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n        val "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newVal\n        "),(0,t.Wm)("span",{class:"token comment"},"// 如果新赋值的值是 对象，需要将其属性也处理成响应式"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// 不能直接使用 this,此时this 指向 data 对象"),(0,t.Uk)("\n        that"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"walk"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("newVal"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// 发送通知"),(0,t.Uk)("\n        dep"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"notify"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"9"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"10"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"11"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"12"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"13"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"14"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"15"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"16"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"17"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"18"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"19"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"20"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"21"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"22"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"23"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"24"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"25"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"26"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"27"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"28"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"29"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"30"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"31"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"32"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"33"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"34"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"35"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"36"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"37"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"38"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"39"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"40"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"41"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"42"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"43"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"44"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"45"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"46"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"47"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"48"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"49"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"50"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"51"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"52"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"53"),(0,t.Wm)("br")])])]),(0,t.Wm)("li",null,[(0,t.Wm)("h3",{id:"compiler-js"},[(0,t.Wm)("a",{class:"header-anchor",href:"#compiler-js"},"#"),(0,t.Uk)(),(0,t.Wm)("strong",null,[(0,t.Wm)("code",null,"compiler.js")])]),(0,t.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"class"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Compiler"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"constructor"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"vm"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("vm "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" vm\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("el "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" vm"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("$el\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"compile"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("el"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n  "),(0,t.Wm)("span",{class:"token comment"},"// 编译模板，处理文本节点和元素节点"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"compile"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"el"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 遍历所有的子节点"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" childNodes "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" el"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("childNodes\n    Array"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"from"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("childNodes"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"forEach"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"node"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 处理文本节点"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"isTextNode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("node"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"compileText"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("node"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"isElementNode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("node"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// 处理元素节点"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"compileElement"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("node"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n      "),(0,t.Wm)("span",{class:"token comment"},"// 判断 node 节点，是否有子节点，如果有，需要递归调用 compile"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("node"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("childNodes "),(0,t.Wm)("span",{class:"token operator"},"&&"),(0,t.Uk)(" node"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("childNodes"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("length"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"compile"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("node"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n  "),(0,t.Wm)("span",{class:"token comment"},"// 编译元素节点，处理指令"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"compileElement"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"node"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 遍历所有的属性节点"),(0,t.Uk)("\n    Array"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"from"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("node"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("attributes"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"forEach"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"attr"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" attrName "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" attr"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("name\n      "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"isDirective"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("attrName"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// v-text --\x3e text"),(0,t.Uk)("\n        attrName "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" attrName"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"substr"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token number"},"2"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" key "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" attr"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("value\n        "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"update"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("node"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" attrName"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n  "),(0,t.Wm)("span",{class:"token function"},"update"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("node"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" attrName")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" updateFn "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("attrName "),(0,t.Wm)("span",{class:"token operator"},"+"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'Updater'"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n\n    "),(0,t.Wm)("span",{class:"token comment"},"// 处理 v-on 指令"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("attrName"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"startsWith"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'on:'"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" eventType "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" attrName"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"split"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"':'"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token number"},"1"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"onUpdater"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("node"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" eventType"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n    updateFn "),(0,t.Wm)("span",{class:"token operator"},"&&"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"updateFn"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"call"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" node"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("vm"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n  "),(0,t.Wm)("span",{class:"token comment"},"// 处理 v-text 指令"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"textUpdater"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("node"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" value"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    node"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("textContent "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" value\n    "),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Watcher"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("vm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"newValue"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      node"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("textContent "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newValue\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n  "),(0,t.Wm)("span",{class:"token comment"},"// 处理 v-model"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"modelUpdater"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("node"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" value"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    node"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("value "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" value\n    "),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Watcher"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("vm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"newValue"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      node"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("value "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newValue\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n  "),(0,t.Wm)("span",{class:"token comment"},"// 处理 v-html "),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"htmlUpdater"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("node"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" value"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    node"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("innerHTML "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" value\n    "),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Watcher"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("vm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token parameter"},"newValue"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      node"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("innerHTML "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newValue\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 双向绑定"),(0,t.Uk)("\n    node"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"addEventListener"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'input'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("vm"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" node"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("value\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n  "),(0,t.Wm)("span",{class:"token comment"},"// 处理 v-on"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"onUpdater"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("node"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" eventType")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    node"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"addEventListener"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("eventType"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("vm"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("$options"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("methods"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n  "),(0,t.Wm)("span",{class:"token comment"},"// 编译文本节点，处理插值表达式"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"compileText"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"node"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" reg "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token regex"},[(0,t.Wm)("span",{class:"token regex-delimiter"},"/"),(0,t.Wm)("span",{class:"token regex-source language-regex"},"\\{\\{(.+?)\\}\\}"),(0,t.Wm)("span",{class:"token regex-delimiter"},"/")]),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" value "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" node"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("textContent\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("reg"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"test"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("value"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" key "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" RegExp"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("$"),(0,t.Wm)("span",{class:"token number"},"1."),(0,t.Wm)("span",{class:"token function"},"trim"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 获取第一个分组的内容 (.+?)"),(0,t.Uk)("\n      node"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("textContent "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" value"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"replace"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("reg"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("vm"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n\n      "),(0,t.Wm)("span",{class:"token comment"},"// 创建 watcher 对象，当数据改变更新视图"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Watcher"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("vm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"newValue"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        node"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("textContent "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newValue\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n  "),(0,t.Wm)("span",{class:"token comment"},"// 判断元素属性是否是指令"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"isDirective"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"attrName"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" attrName"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"startsWith"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'v-'"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n  "),(0,t.Wm)("span",{class:"token comment"},"// 判断节点是否是文本节点"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"isTextNode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"node"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" node"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("nodeType "),(0,t.Wm)("span",{class:"token operator"},"==="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'3'"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n  "),(0,t.Wm)("span",{class:"token comment"},"// 判断节点是否是元素节点"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"isElementNode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"node"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" node"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("nodeType "),(0,t.Wm)("span",{class:"token operator"},"==="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'1'"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"9"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"10"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"11"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"12"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"13"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"14"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"15"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"16"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"17"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"18"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"19"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"20"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"21"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"22"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"23"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"24"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"25"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"26"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"27"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"28"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"29"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"30"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"31"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"32"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"33"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"34"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"35"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"36"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"37"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"38"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"39"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"40"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"41"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"42"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"43"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"44"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"45"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"46"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"47"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"48"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"49"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"50"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"51"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"52"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"53"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"54"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"55"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"56"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"57"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"58"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"59"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"60"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"61"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"62"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"63"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"64"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"65"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"66"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"67"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"68"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"69"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"70"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"71"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"72"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"73"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"74"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"75"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"76"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"77"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"78"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"79"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"80"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"81"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"82"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"83"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"84"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"85"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"86"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"87"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"88"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"89"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"90"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"91"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"92"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"93"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"94"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"95"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"96"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"97"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"98"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"99"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"100"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"101"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"102"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"103"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"104"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"105"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"106"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"107"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"108"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"109"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"110"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"111"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"112"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"113"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"114"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"115"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"116"),(0,t.Wm)("br")])])]),(0,t.Wm)("li",null,[(0,t.Wm)("h3",{id:"dep-js"},[(0,t.Wm)("a",{class:"header-anchor",href:"#dep-js"},"#"),(0,t.Uk)(),(0,t.Wm)("strong",null,[(0,t.Wm)("code",null,"dep.js")])]),(0,t.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"class"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Dep"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"constructor"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 存储所有的观察者"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("subs "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n  "),(0,t.Wm)("span",{class:"token comment"},"// 添加观察者"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"addSub"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"sub"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("sub "),(0,t.Wm)("span",{class:"token operator"},"&&"),(0,t.Uk)(" sub"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("update"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("subs"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"push"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("sub"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n  "),(0,t.Wm)("span",{class:"token comment"},"// 发送通知"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"notify"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("subs"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"forEach"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"sub"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      sub"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"update"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"9"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"10"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"11"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"12"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"13"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"14"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"15"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"16"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"17"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"18"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"19"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"20"),(0,t.Wm)("br")])])]),(0,t.Wm)("li",null,[(0,t.Wm)("h3",{id:"watcher-js"},[(0,t.Wm)("a",{class:"header-anchor",href:"#watcher-js"},"#"),(0,t.Uk)(),(0,t.Wm)("strong",null,[(0,t.Wm)("code",null,"watcher.js")])]),(0,t.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"class"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Watcher"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"constructor"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("vm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" cb")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("vm "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" vm\n    "),(0,t.Wm)("span",{class:"token comment"},"// data中的属性名称"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("key "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" key\n    "),(0,t.Wm)("span",{class:"token comment"},"// 回调函数负责更新视图"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("cb "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" cb\n\n    "),(0,t.Wm)("span",{class:"token comment"},"// 把watcher对象记录到Dep类的静态属性target"),(0,t.Uk)("\n    Dep"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("target "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 触发get方法，在get方法中会调用addSub"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("oldValue "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" vm"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n    Dep"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("target "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"null"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n  "),(0,t.Wm)("span",{class:"token comment"},"// 当数据发生变化的时候更新视图"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"update"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" newValue "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("vm"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("oldValue "),(0,t.Wm)("span",{class:"token operator"},"==="),(0,t.Uk)(" newValue"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"cb"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("newValue"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"9"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"10"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"11"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"12"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"13"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"14"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"15"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"16"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"17"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"18"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"19"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"20"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"21"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"22"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"23"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"24"),(0,t.Wm)("br")])])])],-1),N={render:function(n,s){const a=(0,t.up)("OutboundLink");return(0,t.wg)(),(0,t.j4)(t.HY,null,[o,m,l,u,k,W,r,(0,t.Wm)("ol",null,[i,b,(0,t.Wm)("li",null,[U,(0,t.Wm)("ul",null,[d,y,v,(0,t.Wm)("li",null,[(0,t.Wm)("p",null,[(0,t.Wm)("a",h,[f,(0,t.Wm)(a)])])])]),w]),g,j]),x,E,T,D],64)}}}}]);