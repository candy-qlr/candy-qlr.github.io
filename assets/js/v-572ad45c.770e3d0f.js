(self.webpackChunkvuepress_blog=self.webpackChunkvuepress_blog||[]).push([[977],{8060:(n,s,a)=>{"use strict";a.r(s),a.d(s,{data:()=>p});const p={key:"v-572ad45c",path:"/guide/CICD/",title:"自动化部署",lang:"en-US",frontmatter:{title:"自动化部署"},excerpt:"",headers:[{level:2,title:"免费部署平台",slug:"免费部署平台",children:[]},{level:2,title:"Github Pages",slug:"github-pages",children:[]},{level:2,title:"Netlify",slug:"netlify",children:[]},{level:2,title:"Vercel",slug:"vercel",children:[]},{level:2,title:"Serverless",slug:"serverless",children:[{level:3,title:"json-server 生成接口",slug:"json-server-生成接口",children:[]}]}],filePathRelative:"guide/CICD/README.md",git:{updatedTime:1625131972e3,contributors:[]}}},4653:(n,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>rn});var p=a(6252);const e=a.p+"assets/img/image-20200826102755348.de85f4e9.png",t=a.p+"assets/img/image-20200826103044427.9bcd1184.png",o=(0,p.Wm)("h2",{id:"免费部署平台"},[(0,p.Wm)("a",{class:"header-anchor",href:"#免费部署平台"},"#"),(0,p.Uk)(" 免费部署平台")],-1),l=(0,p.Wm)("li",null,"Github Pages",-1),c=(0,p.Uk)("Netlify "),u=(0,p.Uk)("Vue: "),r={href:"https://vue-next-template-explorer.netlify.app/",target:"_blank",rel:"noopener noreferrer"},i=(0,p.Uk)("https://vue-next-template-explorer.netlify.app/"),k=(0,p.Uk)("Vue:"),m={href:"https://template-explorer.vuejs.org/",target:"_blank",rel:"noopener noreferrer"},b=(0,p.Uk)("https://template-explorer.vuejs.org/"),d=(0,p.Uk)("Vercel "),g={href:"https://pwa-demo-livid.vercel.app/",target:"_blank",rel:"noopener noreferrer"},v=(0,p.Uk)("https://pwa-demo-livid.vercel.app/"),h=(0,p.Wm)("li",null,"Serverless",-1),W=(0,p.Uk)("静态站点生成器 "),y={href:"https://www.vuepress.cn",target:"_blank",rel:"noopener noreferrer"},f=(0,p.Uk)("vuepress/hexo"),q=(0,p.uE)('<h2 id="github-pages"><a class="header-anchor" href="#github-pages">#</a> Github Pages</h2><ul><li><p>把 dist 目录发布到 gh-pages 分支</p><ul><li><p>.gitignore 中不能忽略 dist 目录</p></li><li><p>把 dist 目录推送到远程的 gh-pages 分支</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">git</span> subtree push --prefix dist origin gh-pages\n<span class="token function">git</span> push origin --delete gh-pages\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul></li><li><p>自定义域名（首先需要买一个域名）</p><ul><li>不建议：github - 项目 - Settings 设置自定义域名</li><li>阿里云设置 成 CNAME-将域名指向另外一个域名</li><li>j建议：public目录下创建一个 CNAME 文件，写上自定义域名</li></ul></li><li><p>Git 设置代理</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">git</span> config --global http.proxy http://127.0.0.1:1080\n<span class="token function">git</span> config --global https.proxy https://127.0.0.1:1080\n\n<span class="token function">git</span> config --global --unset http.proxy\n<span class="token function">git</span> config --global --unset https.proxy\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li><li><p>Github Actions</p></li><li><p>个人设置 - Personal access tokens</p><ul><li><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>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 // 生成的 token\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></li></ul></li><li><p>项目 - Settings - Secrets</p><ul><li>ACCESS_TOKEN：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</li></ul></li><li><p>本地项目，创建 .github/workflows/deploy.yml ----(deploy可以换成随便其他的名字)</p></li><li><p>本地项目，package.json 中增加</p><ul><li>&quot;homepage&quot;: &quot;https://[用户名].github.io/[仓库名称]&quot;,</li></ul></li><li><p>本地项目，创建 vue.config.js</p></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;@vue/cli-service&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ProjectOptions <span class="token punctuation">}</span></span> */</span>\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  outputDir<span class="token operator">:</span> <span class="token string">&#39;dist&#39;</span><span class="token punctuation">,</span>\n  publicPath<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&#39;production&#39;</span> <span class="token operator">?</span> <span class="token string">&#39;/github的仓库名称/&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;/&#39;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div>',3),j=(0,p.Wm)("li",null,[(0,p.Wm)("p",null,"git 提交 git add git commit")],-1),w=(0,p.Wm)("p",null,"设置 Github Pages - 指定 gh-pages 分支",-1),x=(0,p.Wm)("ul",null,[(0,p.Wm)("li",null,".github/workflows/deploy.yml")],-1),U={href:"https://github.com/JamesIves/github-pages-deploy-action",target:"_blank",rel:"noopener noreferrer"},S=(0,p.Uk)("https://github.com/JamesIves/github-pages-deploy-action"),N=(0,p.uE)('<div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">name</span><span class="token punctuation">:</span> GitHub Actions Build and Deploy Demo\n<span class="token key atrule">on</span><span class="token punctuation">:</span>\n  <span class="token key atrule">push</span><span class="token punctuation">:</span>\n    <span class="token key atrule">branches</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> master\n<span class="token key atrule">jobs</span><span class="token punctuation">:</span>\n  <span class="token key atrule">build-and-deploy</span><span class="token punctuation">:</span>\n    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest\n    <span class="token key atrule">steps</span><span class="token punctuation">:</span>\n    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Checkout\n      <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@master\n    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Build and Deploy\n      <span class="token key atrule">uses</span><span class="token punctuation">:</span> JamesIves/github<span class="token punctuation">-</span>pages<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span>action@master\n      <span class="token key atrule">env</span><span class="token punctuation">:</span>\n        <span class="token key atrule">ACCESS_TOKEN</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.ACCESS_TOKEN <span class="token punctuation">}</span><span class="token punctuation">}</span>\n        <span class="token key atrule">BRANCH</span><span class="token punctuation">:</span> gh<span class="token punctuation">-</span>pages\n        <span class="token key atrule">FOLDER</span><span class="token punctuation">:</span> dist\n        <span class="token key atrule">BUILD_SCRIPT</span><span class="token punctuation">:</span> npm install <span class="token important">&amp;&amp;</span> npm run build\n<span class="token comment"># https://github.com/marketplace/actions/deploy-to-github-pages</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div>',1),_={id:"netlify"},E=(0,p.Wm)("a",{class:"header-anchor",href:"#netlify"},"#",-1),C=(0,p.Uk)(),T={href:"https://www.netlify.com/",target:"_blank",rel:"noopener noreferrer"},I=(0,p.Uk)("Netlify"),D=(0,p.uE)('<ul><li>可以在 https://github.com/marketplace 中找到别人写好的 actions</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># .github/workflows/netlify.yml</span>\n<span class="token comment"># https://github.com/marketplace/actions/netlify-actions</span>\n<span class="token key atrule">name</span><span class="token punctuation">:</span> Build and Deploy to Netlify\n<span class="token key atrule">on</span><span class="token punctuation">:</span>\n  <span class="token key atrule">push</span><span class="token punctuation">:</span>\n    <span class="token key atrule">branches</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> master\n  <span class="token key atrule">pull_request</span><span class="token punctuation">:</span>\n    <span class="token key atrule">types</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>opened<span class="token punctuation">,</span> synchronize<span class="token punctuation">]</span>\n<span class="token key atrule">jobs</span><span class="token punctuation">:</span>\n  <span class="token key atrule">build</span><span class="token punctuation">:</span>\n    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span><span class="token number">18.04</span>\n    <span class="token key atrule">steps</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2\n\n      <span class="token comment"># ( Build to ./dist or other directory... )</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Build\n        <span class="token key atrule">run</span><span class="token punctuation">:</span>\n          yarn <span class="token important">&amp;&amp;</span> yarn build\n      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy to Netlify\n        <span class="token key atrule">uses</span><span class="token punctuation">:</span> nwtgck/actions<span class="token punctuation">-</span>netlify@v1.1\n        <span class="token key atrule">with</span><span class="token punctuation">:</span>\n          <span class="token key atrule">publish-dir</span><span class="token punctuation">:</span> <span class="token string">&#39;./dist&#39;</span>\n          <span class="token key atrule">production-branch</span><span class="token punctuation">:</span> master\n          <span class="token key atrule">github-token</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.TOKENFORNETLIFY <span class="token punctuation">}</span><span class="token punctuation">}</span>\n          <span class="token key atrule">deploy-message</span><span class="token punctuation">:</span> <span class="token string">&quot;Deploy from GitHub Actions&quot;</span>\n          <span class="token key atrule">enable-pull-request-comment</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>\n          <span class="token key atrule">enable-commit-comment</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>\n          <span class="token key atrule">overwrites-pull-request-comment</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>\n        <span class="token key atrule">env</span><span class="token punctuation">:</span>\n          <span class="token key atrule">NETLIFY_AUTH_TOKEN</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.NETLIFY_AUTH_TOKEN <span class="token punctuation">}</span><span class="token punctuation">}</span>\n          <span class="token key atrule">NETLIFY_SITE_ID</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.NETLIFY_SITE_ID <span class="token punctuation">}</span><span class="token punctuation">}</span>\n        <span class="token key atrule">timeout-minutes</span><span class="token punctuation">:</span> <span class="token number">1</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div>',2),O={id:"vercel"},F=(0,p.Wm)("a",{class:"header-anchor",href:"#vercel"},"#",-1),R=(0,p.Uk)(),A={href:"https://vercel.com",target:"_blank",rel:"noopener noreferrer"},L=(0,p.Uk)("Vercel"),P=(0,p.Wm)("p",null,"部署文档",-1),B={href:"https://nuxtjs.org/faq/now-deployment",target:"_blank",rel:"noopener noreferrer"},G=(0,p.Uk)("https://nuxtjs.org/faq/now-deployment"),J={href:"https://www.nuxtjs.cn/faq/now-deployment",target:"_blank",rel:"noopener noreferrer"},V=(0,p.Uk)("https://www.nuxtjs.cn/faq/now-deployment"),H=(0,p.Wm)("li",null,[(0,p.Wm)("p",null,"在 Vercel 的网站使用 github 账号登录")],-1),K=(0,p.Wm)("li",null,[(0,p.Wm)("p",null,"全局安装 vercel"),(0,p.Wm)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,p.Wm)("pre",{class:"language-bash"},[(0,p.Wm)("code",null,[(0,p.Wm)("span",{class:"token function"},"yarn"),(0,p.Uk)(" global "),(0,p.Wm)("span",{class:"token function"},"add"),(0,p.Uk)(" vercel\n"),(0,p.Wm)("span",{class:"token function"},"npm"),(0,p.Uk)(" i vercel -g\n")])]),(0,p.Wm)("div",{class:"line-numbers"},[(0,p.Wm)("span",{class:"line-number"},"1"),(0,p.Wm)("br"),(0,p.Wm)("span",{class:"line-number"},"2"),(0,p.Wm)("br")])])],-1),Y=(0,p.Wm)("li",null,[(0,p.Wm)("p",null,"创建配置文件 now.json or vercel.json （静态网站不需要）"),(0,p.Wm)("div",{class:"language-json ext-json line-numbers-mode"},[(0,p.Wm)("pre",{class:"language-json"},[(0,p.Wm)("code",null,[(0,p.Wm)("span",{class:"token punctuation"},"{"),(0,p.Uk)("\n  "),(0,p.Wm)("span",{class:"token property"},'"version"'),(0,p.Wm)("span",{class:"token operator"},":"),(0,p.Uk)(),(0,p.Wm)("span",{class:"token number"},"2"),(0,p.Wm)("span",{class:"token punctuation"},","),(0,p.Uk)("\n  "),(0,p.Wm)("span",{class:"token property"},'"builds"'),(0,p.Wm)("span",{class:"token operator"},":"),(0,p.Uk)(),(0,p.Wm)("span",{class:"token punctuation"},"["),(0,p.Uk)("\n    "),(0,p.Wm)("span",{class:"token punctuation"},"{"),(0,p.Uk)("\n      "),(0,p.Wm)("span",{class:"token property"},'"src"'),(0,p.Wm)("span",{class:"token operator"},":"),(0,p.Uk)(),(0,p.Wm)("span",{class:"token string"},'"nuxt.config.js"'),(0,p.Wm)("span",{class:"token punctuation"},","),(0,p.Uk)("\n      "),(0,p.Wm)("span",{class:"token property"},'"use"'),(0,p.Wm)("span",{class:"token operator"},":"),(0,p.Uk)(),(0,p.Wm)("span",{class:"token string"},'"@nuxtjs/vercel-builder"'),(0,p.Uk)("\n    "),(0,p.Wm)("span",{class:"token punctuation"},"}"),(0,p.Uk)("\n  "),(0,p.Wm)("span",{class:"token punctuation"},"]"),(0,p.Uk)("\n"),(0,p.Wm)("span",{class:"token punctuation"},"}"),(0,p.Uk)("\n")])]),(0,p.Wm)("div",{class:"line-numbers"},[(0,p.Wm)("span",{class:"line-number"},"1"),(0,p.Wm)("br"),(0,p.Wm)("span",{class:"line-number"},"2"),(0,p.Wm)("br"),(0,p.Wm)("span",{class:"line-number"},"3"),(0,p.Wm)("br"),(0,p.Wm)("span",{class:"line-number"},"4"),(0,p.Wm)("br"),(0,p.Wm)("span",{class:"line-number"},"5"),(0,p.Wm)("br"),(0,p.Wm)("span",{class:"line-number"},"6"),(0,p.Wm)("br"),(0,p.Wm)("span",{class:"line-number"},"7"),(0,p.Wm)("br"),(0,p.Wm)("span",{class:"line-number"},"8"),(0,p.Wm)("br"),(0,p.Wm)("span",{class:"line-number"},"9"),(0,p.Wm)("br")])])],-1),$=(0,p.Wm)("li",null,[(0,p.Wm)("p",null,".nowignore/.vercelignore （静态网站不需要）"),(0,p.Wm)("p",null,"忽略构建的文件夹 .nuxt"),(0,p.Wm)("div",{class:"language-text ext-text line-numbers-mode"},[(0,p.Wm)("pre",{class:"language-text"},[(0,p.Wm)("code",null,".nuxt\n")]),(0,p.Wm)("div",{class:"line-numbers"},[(0,p.Wm)("span",{class:"line-number"},"1"),(0,p.Wm)("br")])])],-1),z=(0,p.Wm)("li",null,[(0,p.Wm)("p",null,"发布"),(0,p.Wm)("ul",null,[(0,p.Wm)("li",null,"登陆")]),(0,p.Wm)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,p.Wm)("pre",{class:"language-bash"},[(0,p.Wm)("code",null,"vercel login\n")]),(0,p.Wm)("div",{class:"line-numbers"},[(0,p.Wm)("span",{class:"line-number"},"1"),(0,p.Wm)("br")])]),(0,p.Wm)("p",null,[(0,p.Wm)("img",{src:e,alt:"image-20200826102755348"})]),(0,p.Wm)("ul",null,[(0,p.Wm)("li",null,"然后发邮件到你的邮箱中确认，确认之后")]),(0,p.Wm)("p",null,[(0,p.Wm)("img",{src:t,alt:"image-20200826103044427"})]),(0,p.Wm)("ul",null,[(0,p.Wm)("li",null,"发布")]),(0,p.Wm)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,p.Wm)("pre",{class:"language-bash"},[(0,p.Wm)("code",null,"vercel // 预览部署\n-》简写 vc\nvercel --prod // 生产环境部署\n")]),(0,p.Wm)("div",{class:"line-numbers"},[(0,p.Wm)("span",{class:"line-number"},"1"),(0,p.Wm)("br"),(0,p.Wm)("span",{class:"line-number"},"2"),(0,p.Wm)("br"),(0,p.Wm)("span",{class:"line-number"},"3"),(0,p.Wm)("br")])]),(0,p.Wm)("p",null,"发布完毕后，首页是静态的，可以直接查看到，但是需要请求接口的地方，比如：登录 会出错。"),(0,p.Wm)("p",null,"点击登录按钮的时候会在控制台提示，在https的主域名下访问接口的时候，接口地址也需要使用 https")],-1),M=(0,p.uE)('<p>修改 baseUrl，把接口地址更改成 https 的</p><p>在 plugins/request.js</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> request <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  \n    <span class="token comment">// baseURL: &#39;http://realworld.api.fed.lagounews.com&#39;  </span>\n    baseURL<span class="token operator">:</span> <span class="token string">&#39;https://conduit.productionready.io&#39;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div>',3),Z={href:"https://github.com/gothinkster/realworld-starter-kit/blob/master/FRONTEND_INSTRUCTIONS.md",target:"_blank",rel:"noopener noreferrer"},Q=(0,p.Uk)("https://github.com/gothinkster/realworld-starter-kit/blob/master/FRONTEND_INSTRUCTIONS.md"),X={href:"https://conduit.productionready.io/api/tags",target:"_blank",rel:"noopener noreferrer"},nn=(0,p.Uk)("https://conduit.productionready.io/api/tags"),sn=(0,p.Wm)("h2",{id:"serverless"},[(0,p.Wm)("a",{class:"header-anchor",href:"#serverless"},"#"),(0,p.Uk)(" Serverless")],-1),an=(0,p.uE)("<li><p>Serverless 是一种架构模式，无服务器架构</p><ul><li>对于使用 Serverless 架构进行开发的项目，开发者最明显的感受就是更关注应用的业务本身，不必再去过多关心服务器和运行平台的一系列问题</li></ul></li><li><p>无服务器，并不是真的没有服务器，只是开发人员眼中不需要关注服务器。开发人员只需要按照一定的要求完成开发工作，剩下的所有事情全部交给 Serverless 容器完成。</p></li><li><p>我们的应用主要由两大块组成，分别是逻辑与存储。Serverless 中就通过两种方式解决了这两块的需求，分别是：</p><ul><li>函数即服务，Function as a Service，FaaS；</li><li>后端即服务，Backend as a Service，BaaS。</li></ul></li><li><p>Serverless 的优势</p><ul><li>不需要再考虑什么物理机/虚拟机，结合工作流的情况下，代码提交自动部署，直接运行；</li><li>没有服务器，维护成本自然大大降低，安全性稳定性更高；</li><li>都是弹性伸缩云，硬件资源需要多少分配多少，不用担心性能问题；</li><li>大多数 Serverless 服务商的计价方式都是按使用情况（如流量、CPU 占用）来收费；</li></ul></li>",4),pn=(0,p.Wm)("p",null,"Vercel Serverless 文档",-1),en={href:"https://vercel.com/docs",target:"_blank",rel:"noopener noreferrer"},tn=(0,p.Uk)("https://vercel.com/docs"),on={href:"https://vercel.com/docs/runtimes#official-runtimes/node-js/node-js-dependencies",target:"_blank",rel:"noopener noreferrer"},ln=(0,p.Uk)("https://vercel.com/docs/runtimes#official-runtimes/node-js/node-js-dependencies"),cn=(0,p.Wm)("li",null,[(0,p.Wm)("p",null,"demo1"),(0,p.Wm)("ul",null,[(0,p.Wm)("li",null,"本地测试 vercel dev")])],-1),un=(0,p.uE)('<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  \n    <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token operator">=</span> <span class="token string">&#39;World&#39;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query  \n    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>demo2</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&#39;axios&#39;</span>\nmodule<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  \n    <span class="token comment">// const { name = &#39;World&#39; } = req.query  </span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;https://conduit.productionready.io/api/tags&#39;</span><span class="token punctuation">)</span>  \n    <span class="token keyword">let</span> html <span class="token operator">=</span> <span class="token string">&#39;&lt;ul&gt;&#39;</span>  \n    data<span class="token punctuation">.</span>tags<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    \n        html <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;li&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;</span><span class="token template-punctuation string">`</span></span>  \n    <span class="token punctuation">}</span><span class="token punctuation">)</span>  \n    html <span class="token operator">+=</span> <span class="token string">&#39;&lt;/ul&gt;&#39;</span>  \n    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>demo3</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  \n    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;../data.json&#39;</span><span class="token punctuation">)</span>  \n    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><p>demo4</p><p>now.json/vercel.json</p><p><strong>使用json-server</strong>生成接口，作为模块使用</p></li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>  \n    <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>  \n    <span class="token property">&quot;builds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>    \n        <span class="token punctuation">{</span> <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/server.js&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;use&quot;</span><span class="token operator">:</span> <span class="token string">&quot;@vercel/node&quot;</span> <span class="token punctuation">}</span>  \n    <span class="token punctuation">]</span><span class="token punctuation">,</span>  \n    <span class="token property">&quot;routes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>    \n        <span class="token punctuation">{</span> <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/(.*)&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;dest&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/server.js&quot;</span> <span class="token punctuation">}</span>  \n     <span class="token punctuation">]</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> jsonServer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;json-server&#39;</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> server <span class="token operator">=</span> jsonServer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> router <span class="token operator">=</span> jsonServer<span class="token punctuation">.</span><span class="token function">router</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;data.json&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> middlewares <span class="token operator">=</span> jsonServer<span class="token punctuation">.</span><span class="token function">defaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\nserver<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>middlewares<span class="token punctuation">)</span>\nserver<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span>\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> server\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> os <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;os&#39;</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> jsonServer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;json-server&#39;</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> server <span class="token operator">=</span> jsonServer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> middlewares <span class="token operator">=</span> jsonServer<span class="token punctuation">.</span><span class="token function">defaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> dbFilename <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">tmpdir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;db.json&#39;</span><span class="token punctuation">)</span>\n<span class="token comment">// 判断一下 dbFilename 是否存在，如果不存在才创建</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>dbFilename<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  \n    fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>dbFilename<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    \n        <span class="token string">&quot;posts&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>      \n            <span class="token punctuation">{</span> <span class="token string">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;json-server&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;typicode&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>      \n            <span class="token punctuation">{</span> <span class="token string">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;iis&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ms&quot;</span> <span class="token punctuation">}</span>    \n        <span class="token punctuation">]</span><span class="token punctuation">,</span>    \n        <span class="token string">&quot;comments&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>      \n            <span class="token punctuation">{</span> <span class="token string">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;body&quot;</span><span class="token operator">:</span> <span class="token string">&quot;some comment&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;postId&quot;</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>    \n        <span class="token punctuation">]</span><span class="token punctuation">,</span>    \n        <span class="token string">&quot;profile&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;typicode&quot;</span> <span class="token punctuation">}</span>  \n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">const</span> router <span class="token operator">=</span> jsonServer<span class="token punctuation">.</span><span class="token function">router</span><span class="token punctuation">(</span>dbFilename<span class="token punctuation">)</span>\nserver<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>middlewares<span class="token punctuation">)</span>\nserver<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span>\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> server\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="json-server-生成接口"><a class="header-anchor" href="#json-server-生成接口">#</a> json-server 生成接口</h3><ul><li><p>直接使用</p></li><li><p>Install JSON Server</p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> -g json-server\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>Create a <code>db.json</code> file with some data</li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>\n  <span class="token property">&quot;posts&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">{</span> <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;json-server&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;typicode&quot;</span> <span class="token punctuation">}</span>\n  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;comments&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">{</span> <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token property">&quot;body&quot;</span><span class="token operator">:</span> <span class="token string">&quot;some comment&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;postId&quot;</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>\n  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;profile&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;typicode&quot;</span> <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>Start JSON Server</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>json-server --watch db.json\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>Now if you go to http://localhost:3000/posts/1, you&#39;ll get</li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span> <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;json-server&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;typicode&quot;</span> <span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div>',18),rn={render:function(n,s){const a=(0,p.up)("OutboundLink");return(0,p.wg)(),(0,p.j4)(p.HY,null,[o,(0,p.Wm)("ul",null,[l,(0,p.Wm)("li",null,[c,(0,p.Wm)("ul",null,[(0,p.Wm)("li",null,[u,(0,p.Wm)("a",r,[i,(0,p.Wm)(a)])]),(0,p.Wm)("li",null,[k,(0,p.Wm)("a",m,[b,(0,p.Wm)(a)])])])]),(0,p.Wm)("li",null,[d,(0,p.Wm)("ul",null,[(0,p.Wm)("li",null,[(0,p.Wm)("a",g,[v,(0,p.Wm)(a)])])])]),h,(0,p.Wm)("li",null,[W,(0,p.Wm)("a",y,[f,(0,p.Wm)(a)])])]),q,(0,p.Wm)("ul",null,[j,(0,p.Wm)("li",null,[w,x,(0,p.Wm)("p",null,[(0,p.Wm)("a",U,[S,(0,p.Wm)(a)])])])]),N,(0,p.Wm)("h2",_,[E,C,(0,p.Wm)("a",T,[I,(0,p.Wm)(a)])]),D,(0,p.Wm)("h2",O,[F,R,(0,p.Wm)("a",A,[L,(0,p.Wm)(a)])]),(0,p.Wm)("ul",null,[(0,p.Wm)("li",null,[P,(0,p.Wm)("ul",null,[(0,p.Wm)("li",null,[(0,p.Wm)("a",B,[G,(0,p.Wm)(a)])]),(0,p.Wm)("li",null,[(0,p.Wm)("a",J,[V,(0,p.Wm)(a)])])])]),H,K,Y,$,z,(0,p.Wm)("li",null,[M,(0,p.Wm)("p",null,[(0,p.Wm)("a",Z,[Q,(0,p.Wm)(a)])]),(0,p.Wm)("p",null,[(0,p.Wm)("a",X,[nn,(0,p.Wm)(a)])])])]),sn,(0,p.Wm)("ul",null,[an,(0,p.Wm)("li",null,[pn,(0,p.Wm)("ul",null,[(0,p.Wm)("li",null,[(0,p.Wm)("a",en,[tn,(0,p.Wm)(a)])]),(0,p.Wm)("li",null,[(0,p.Wm)("a",on,[ln,(0,p.Wm)(a)])])])]),cn]),un],64)}}}}]);