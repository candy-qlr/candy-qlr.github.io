(self.webpackChunkvuepress_blog=self.webpackChunkvuepress_blog||[]).push([[240],{261:(n,s,a)=>{"use strict";a.r(s),a.d(s,{data:()=>e});const e={key:"v-405ef340",path:"/guide/SSR/%E6%90%AD%E5%BB%BASSR%E5%BA%94%E7%94%A8.html",title:"搭建 SSR 应用",lang:"en-US",frontmatter:{title:"搭建 SSR 应用"},excerpt:"",headers:[{level:2,title:"基本用法",slug:"基本用法",children:[]},{level:2,title:"构建配置",slug:"构建配置",children:[{level:3,title:"1. 基本思路",slug:"_1-基本思路",children:[]},{level:3,title:"2. 源码结构",slug:"_2-源码结构",children:[]},{level:3,title:"3. 安装依赖",slug:"_3-安装依赖",children:[]},{level:3,title:"4. 配置文件及打包命令",slug:"_4-配置文件及打包命令",children:[]},{level:3,title:"5. 配置命令",slug:"_5-配置命令",children:[]},{level:3,title:"6. 启动应用",slug:"_6-启动应用",children:[]},{level:3,title:"7. 解析渲染流程",slug:"_7-解析渲染流程",children:[]}]},{level:2,title:"构建配置-开发模式",slug:"构建配置-开发模式",children:[{level:3,title:"1. 基本思路",slug:"_1-基本思路-1",children:[]},{level:3,title:"2. 提取处理模块",slug:"_2-提取处理模块",children:[]},{level:3,title:"3. update 更新函数",slug:"_3-update-更新函数",children:[]},{level:3,title:"4. 处理模板文件",slug:"_4-处理模板文件",children:[]},{level:3,title:"5. 服务端监视打包",slug:"_5-服务端监视打包",children:[]},{level:3,title:"6. 把数据写入内存中",slug:"_6-把数据写入内存中",children:[]},{level:3,title:"7. 客户端构建",slug:"_7-客户端构建",children:[]},{level:3,title:"8. 热更新",slug:"_8-热更新",children:[]}]},{level:2,title:"编写通用应用注意事项",slug:"编写通用应用注意事项",children:[]},{level:2,title:"路由",slug:"路由",children:[{level:3,title:"1. 路由配置",slug:"_1-路由配置",children:[]},{level:3,title:"2. 服务端 server 适配",slug:"_2-服务端-server-适配",children:[]},{level:3,title:"3. 适配客户端入口",slug:"_3-适配客户端入口",children:[]},{level:3,title:"4. 路由处理完成",slug:"_4-路由处理完成",children:[]},{level:3,title:"5. 管理页面 Head 内容",slug:"_5-管理页面-head-内容",children:[]}]},{level:2,title:"代码分割",slug:"代码分割",children:[]},{level:2,title:"数据预取和状态管理",slug:"数据预取和状态管理",children:[{level:3,title:"数据预取存储容器 (Data Store)",slug:"数据预取存储容器-data-store",children:[]},{level:3,title:"带有逻辑配置的组件 (Logic Collocation with Components)",slug:"带有逻辑配置的组件-logic-collocation-with-components",children:[]},{level:3,title:"服务器端数据预取 (Server Data Fetching)",slug:"服务器端数据预取-server-data-fetching",children:[]},{level:3,title:"客户端数据预取 (Client Data Fetching)",slug:"客户端数据预取-client-data-fetching",children:[]},{level:3,title:"Store 代码拆分 (Store Code Splitting)",slug:"store-代码拆分-store-code-splitting",children:[]}]}],filePathRelative:"guide/SSR/搭建SSR应用.md",git:{updatedTime:1625646436e3,contributors:[]}}},7126:(n,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>Ls});var e=a(6252);const t=a.p+"assets/img/vue-ssr.94e8c534.png",m=(0,e.Wm)("h2",{id:"基本用法"},[(0,e.Wm)("a",{class:"header-anchor",href:"#基本用法"},"#"),(0,e.Uk)(" 基本用法")],-1),o=(0,e.Wm)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-bash"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token function"},"mkdir"),(0,e.Uk)(" vue-ssr\n"),(0,e.Wm)("span",{class:"token builtin class-name"},"cd"),(0,e.Uk)(" vue-ssr\n"),(0,e.Wm)("span",{class:"token function"},"npm"),(0,e.Uk)(" init -y\n"),(0,e.Wm)("span",{class:"token function"},"npm"),(0,e.Uk)(" i vue vue-server-renderer\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br")])],-1),c=(0,e.Wm)("ol",null,[(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Uk)("在项目根目录创建 "),(0,e.Wm)("code",null,"server.js"),(0,e.Uk)("，渲染一个 vue 实例")]),(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" Vue "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'vue'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" renderer "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'vue-server-renderer'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"createRenderer"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" app "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"new"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token class-name"},"Vue"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    template"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token template-string"},[(0,e.Wm)("span",{class:"token template-punctuation string"},"`"),(0,e.Wm)("span",{class:"token string"},'\n\t\t<div id="app">\n\t\t\t<h1>{{ message }}</h1>\n\t\t</div>\n\t'),(0,e.Wm)("span",{class:"token template-punctuation string"},"`")]),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n    data"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        message"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token string"},"'拉勾教育'"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\nrenderer"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"renderToString"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("app"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},[(0,e.Uk)("err"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("html")]),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"if"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("err"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"throw"),(0,e.Uk)(" err\n    console"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"log"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("html"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token comment"},"// html : 渲染出来的结果字符串"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"15"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"16"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"17"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"18"),(0,e.Wm)("br")])]),(0,e.Wm)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-bash"},[(0,e.Wm)("code",null,[(0,e.Uk)("node server.js\n\n// 输出："),(0,e.Wm)("span",{class:"token operator"},"<"),(0,e.Uk)("div "),(0,e.Wm)("span",{class:"token assign-left variable"},"id"),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Wm)("span",{class:"token string"},'"app"'),(0,e.Uk)(" data-server-renderer"),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Wm)("span",{class:"token string"},'"true"'),(0,e.Wm)("span",{class:"token operator"},">"),(0,e.Wm)("span",{class:"token operator"},"<"),(0,e.Uk)("h"),(0,e.Wm)("span",{class:"token operator"},[(0,e.Wm)("span",{class:"token file-descriptor important"},"1"),(0,e.Uk)(">")]),(0,e.Uk)("拉勾教育"),(0,e.Wm)("span",{class:"token operator"},"<"),(0,e.Uk)("/h"),(0,e.Wm)("span",{class:"token operator"},[(0,e.Wm)("span",{class:"token file-descriptor important"},"1"),(0,e.Uk)(">")]),(0,e.Wm)("span",{class:"token operator"},"<"),(0,e.Uk)("/div"),(0,e.Wm)("span",{class:"token operator"},">"),(0,e.Uk)("\n// data-server-renderer"),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Wm)("span",{class:"token string"},'"true"'),(0,e.Uk)(" 用于将来客户端渲染激活接管的一个入口\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br")])])]),(0,e.Wm)("li",null,[(0,e.Wm)("p",null,"结合到 web 服务器中，将渲染得到的结果发送给用户端浏览器"),(0,e.Wm)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-bash"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token function"},"npm"),(0,e.Uk)(" i express\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br")])]),(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token comment"},"// server.js"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" Vue "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'vue'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" express "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'express'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" renderer "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'vue-server-renderer'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"createRenderer"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" server "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"express"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\nserver"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"get"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'/'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},[(0,e.Uk)("req"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("res")]),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" app "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"new"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token class-name"},"Vue"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        template"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token template-string"},[(0,e.Wm)("span",{class:"token template-punctuation string"},"`"),(0,e.Wm)("span",{class:"token string"},'\n            <div id="app">\n                <h1>{{ message }}</h1>\n            </div>\n        '),(0,e.Wm)("span",{class:"token template-punctuation string"},"`")]),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n        data"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n            message"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token string"},"'拉勾教育'"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n\t"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    renderer"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"renderToString"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("app"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},[(0,e.Uk)("err"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("html")]),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token keyword"},"if"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("err"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n            "),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(" res"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"status"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token number"},"500"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"end"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'Internal Server Error.'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token comment"},"// 解决乱码1：设置响应头"),(0,e.Uk)("\n        res"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"setHeader"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'Content-Type'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Wm)("span",{class:"token string"},"'text/html;charset=utf8'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token comment"},"// res.end(html)"),(0,e.Uk)("\n        \n        "),(0,e.Wm)("span",{class:"token comment"},'// 解决乱码2：html里设置 meta 标签 <meta charset="UTF-8">'),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token comment"},"// 一般建议两种方法一起用"),(0,e.Uk)("\n        res"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"end"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token template-string"},[(0,e.Wm)("span",{class:"token template-punctuation string"},"`"),(0,e.Wm)("span",{class:"token string"},'\n\t\t\t<!DOCTYPE html>\n\t\t\t<html>\n\t\t\t<head>\n\t\t\t\t<meta charset="UTF-8">\n\t\t\t\t<meta name="viewport" content="width=device-width,initial-scale=1.0">\n\t\t\t\t<title>Document</title>\n\t\t\t</head>\n\t\t\t<body>\n\t\t\t\t'),(0,e.Wm)("span",{class:"token interpolation"},[(0,e.Wm)("span",{class:"token interpolation-punctuation punctuation"},"${"),(0,e.Uk)("html"),(0,e.Wm)("span",{class:"token interpolation-punctuation punctuation"},"}")]),(0,e.Wm)("span",{class:"token string"},"\n\t\t\t</body>\n\t\t\t</html>\n\t\t"),(0,e.Wm)("span",{class:"token template-punctuation string"},"`")]),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\nserver"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"listen"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token number"},"3000"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    console"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"log"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'server running at port 3000.'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"15"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"16"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"17"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"18"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"19"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"20"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"21"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"22"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"23"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"24"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"25"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"26"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"27"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"28"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"29"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"30"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"31"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"32"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"33"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"34"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"35"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"36"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"37"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"38"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"39"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"40"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"41"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"42"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"43"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"44"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"45"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"46"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"47"),(0,e.Wm)("br")])])]),(0,e.Wm)("li",null,[(0,e.Wm)("p",null,"使用 html 模板"),(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Uk)("建立一个 "),(0,e.Wm)("code",null,"index.template.html"),(0,e.Uk)(" 文件")]),(0,e.Wm)("div",{class:"language-html ext-html line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-html"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token doctype"},[(0,e.Wm)("span",{class:"token punctuation"},"<!"),(0,e.Wm)("span",{class:"token doctype-tag"},"DOCTYPE"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token name"},"html"),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("html")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("head")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("meta")]),(0,e.Uk)(),(0,e.Wm)("span",{class:"token attr-name"},"charset"),(0,e.Wm)("span",{class:"token attr-value"},[(0,e.Wm)("span",{class:"token punctuation attr-equals"},"="),(0,e.Wm)("span",{class:"token punctuation"},'"'),(0,e.Uk)("UTF-8"),(0,e.Wm)("span",{class:"token punctuation"},'"')]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("meta")]),(0,e.Uk)(),(0,e.Wm)("span",{class:"token attr-name"},"name"),(0,e.Wm)("span",{class:"token attr-value"},[(0,e.Wm)("span",{class:"token punctuation attr-equals"},"="),(0,e.Wm)("span",{class:"token punctuation"},'"'),(0,e.Uk)("viewport"),(0,e.Wm)("span",{class:"token punctuation"},'"')]),(0,e.Uk)(),(0,e.Wm)("span",{class:"token attr-name"},"content"),(0,e.Wm)("span",{class:"token attr-value"},[(0,e.Wm)("span",{class:"token punctuation attr-equals"},"="),(0,e.Wm)("span",{class:"token punctuation"},'"'),(0,e.Uk)("width=device-width,initial-scale=1.0"),(0,e.Wm)("span",{class:"token punctuation"},'"')]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("title")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("Document"),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("title")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("head")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("body")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n        // 特殊标记，左右也不能有空格等字符，vue会自动把内容渲染到这个位置\n        "),(0,e.Wm)("span",{class:"token comment"},"\x3c!--vue-ssr-outlet--\x3e"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("body")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("html")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br")])])]),(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"server.js")]),(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" Vue "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'vue'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" express "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'express'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" fs "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'fs'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" renderer "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'vue-server-renderer'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"createRenderer"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// 配置模板，调用renderer.renderToString时会把 渲染出来的结果 解析替换到配置的模板当中"),(0,e.Uk)("\n    template"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(" fs"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"readFileSync"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'./index.template.html'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Wm)("span",{class:"token string"},"'utf-8'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" server "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"express"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\nserver"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"get"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'/'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},[(0,e.Uk)("req"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("res")]),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" app "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"new"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token class-name"},"Vue"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        template"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token template-string"},[(0,e.Wm)("span",{class:"token template-punctuation string"},"`"),(0,e.Wm)("span",{class:"token string"},'\n            <div id="app">\n                <h1>{{ message }}</h1>\n            </div>\n        '),(0,e.Wm)("span",{class:"token template-punctuation string"},"`")]),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n        data"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n            message"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token string"},"'拉勾教育'"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n\t"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    renderer"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"renderToString"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("app"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},[(0,e.Uk)("err"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("html")]),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token keyword"},"if"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("err"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n            "),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(" res"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"status"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token number"},"500"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"end"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'Internal Server Error.'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n        res"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"setHeader"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'Content-Type'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Wm)("span",{class:"token string"},"'text/html;charset=utf8'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n        res"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"end"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("html"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\nserver"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"listen"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token number"},"3000"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    console"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"log"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'server running at port 3000.'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"15"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"16"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"17"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"18"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"19"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"20"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"21"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"22"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"23"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"24"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"25"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"26"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"27"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"28"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"29"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"30"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"31"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"32"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"33"),(0,e.Wm)("br")])])])])]),(0,e.Wm)("li",null,[(0,e.Wm)("p",null,"在模板中使用外部数据"),(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"server.js")]),(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Uk)("renderer"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"renderToString"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("app"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    title"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'hello world'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n    meta"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token template-string"},[(0,e.Wm)("span",{class:"token template-punctuation string"},"`"),(0,e.Wm)("span",{class:"token string"},'<meta name="description" content="test">'),(0,e.Wm)("span",{class:"token template-punctuation string"},"`")]),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},[(0,e.Uk)("err"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("html")]),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"if"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("err"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(" res"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"status"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token number"},"500"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"end"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'Internal Server Error.'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n    res"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"setHeader"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'Content-Type'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Wm)("span",{class:"token string"},"'text/html;charset=utf8'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    res"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"end"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("html"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br")])])]),(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"index.template.html")]),(0,e.Wm)("div",{class:"language-html ext-html line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-html"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token doctype"},[(0,e.Wm)("span",{class:"token punctuation"},"<!"),(0,e.Wm)("span",{class:"token doctype-tag"},"DOCTYPE"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token name"},"html"),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("html")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("head")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("meta")]),(0,e.Uk)(),(0,e.Wm)("span",{class:"token attr-name"},"charset"),(0,e.Wm)("span",{class:"token attr-value"},[(0,e.Wm)("span",{class:"token punctuation attr-equals"},"="),(0,e.Wm)("span",{class:"token punctuation"},'"'),(0,e.Uk)("UTF-8"),(0,e.Wm)("span",{class:"token punctuation"},'"')]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("meta")]),(0,e.Uk)(),(0,e.Wm)("span",{class:"token attr-name"},"name"),(0,e.Wm)("span",{class:"token attr-value"},[(0,e.Wm)("span",{class:"token punctuation attr-equals"},"="),(0,e.Wm)("span",{class:"token punctuation"},'"'),(0,e.Uk)("viewport"),(0,e.Wm)("span",{class:"token punctuation"},'"')]),(0,e.Uk)(),(0,e.Wm)("span",{class:"token attr-name"},"content"),(0,e.Wm)("span",{class:"token attr-value"},[(0,e.Wm)("span",{class:"token punctuation attr-equals"},"="),(0,e.Wm)("span",{class:"token punctuation"},'"'),(0,e.Uk)("width=device-width,initial-scale=1.0"),(0,e.Wm)("span",{class:"token punctuation"},'"')]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n        // {{{}}} 使用3个大括号，vue不会对它处理，会原文输出\n        {{{ meta }}} \n        "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("title")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("{{ title }}"),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("title")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("head")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("body")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n        // 特殊标记，左右也不能有空格等字符，vue会自动把内容渲染到这个位置\n        "),(0,e.Wm)("span",{class:"token comment"},"\x3c!--vue-ssr-outlet--\x3e"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("body")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("html")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br")])])]),(0,e.Wm)("li",null,[(0,e.Wm)("p",null,"重启服务器")])])])],-1),l=(0,e.Wm)("h2",{id:"构建配置"},[(0,e.Wm)("a",{class:"header-anchor",href:"#构建配置"},"#"),(0,e.Uk)(" 构建配置")],-1),p=(0,e.Wm)("h3",{id:"_1-基本思路"},[(0,e.Wm)("a",{class:"header-anchor",href:"#_1-基本思路"},"#"),(0,e.Uk)(" 1. 基本思路")],-1),u=(0,e.Wm)("p",null,"到目前为止，我们还没有讨论过如何将相同的 Vue 应用程序提供给客户端。为了做到这一点，我们需要使用 webpack 来打包我们的 Vue 应用程序。事实上，我们可能需要在服务器上使用 webpack 打包 Vue 应用程序，因为：",-1),W=(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Uk)("通常 Vue 应用程序是由 webpack 和 "),(0,e.Wm)("code",null,"vue-loader"),(0,e.Uk)(" 构建，并且许多 webpack 特定功能不能直接在 Node.js 中运行（例如通过 "),(0,e.Wm)("code",null,"file-loader"),(0,e.Uk)(" 导入文件，通过 "),(0,e.Wm)("code",null,"css-loader"),(0,e.Uk)(" 导入 CSS）。")]),(0,e.Wm)("li",null,"尽管 Node.js 最新版本能够完全支持 ES2015 特性，我们还是需要转译客户端代码以适应老版浏览器。这也会涉及到构建步骤。")],-1),r=(0,e.Wm)("p",null,"所以基本看法是，对于客户端应用程序和服务器应用程序，我们都要使用 webpack 打包 - 服务器需要「服务器 bundle」然后用于服务器端渲染(SSR)，而「客户端 bundle」会发送给浏览器，用于混合静态标记。",-1),k=(0,e.Wm)("p",null,[(0,e.Wm)("img",{src:t,alt:"img"})],-1),i=(0,e.Wm)("h3",{id:"_2-源码结构"},[(0,e.Wm)("a",{class:"header-anchor",href:"#_2-源码结构"},"#"),(0,e.Uk)(" 2. 源码结构")],-1),b=(0,e.Uk)("现在我们正在使用 webpack 来处理服务器和客户端的应用程序，大部分源码可以使用通用方式编写，可以使用 webpack 支持的所有功能。同时，在编写通用代码时，有一些"),U={href:"https://ssr.vuejs.org/zh/guide/universal.html",target:"_blank",rel:"noopener noreferrer"},d=(0,e.Uk)("事项"),g=(0,e.Uk)("要牢记在心。"),v=(0,e.Wm)("p",null,"一个基本项目可能像是这样：",-1),f=(0,e.Wm)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-bash"},[(0,e.Wm)("code",null,[(0,e.Uk)("src\n├── components\n│   ├── Foo.vue\n│   ├── Bar.vue\n│   └── Baz.vue\n├── App.vue\n├── app.js "),(0,e.Wm)("span",{class:"token comment"},"# 通用 entry(universal entry)"),(0,e.Uk)("\n├── entry-client.js "),(0,e.Wm)("span",{class:"token comment"},"# 仅运行于浏览器"),(0,e.Uk)("\n└── entry-server.js "),(0,e.Wm)("span",{class:"token comment"},"# 仅运行于服务器"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br")])],-1),y=(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("strong",null,[(0,e.Wm)("code",null,"app.js")])])],-1),w=(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"app.js"),(0,e.Uk)(" 是我们应用程序的「通用 entry」。在纯客户端应用程序中，我们将在此文件中创建根 Vue 实例，并直接挂载到 DOM。但是，对于服务器端渲染(SSR)，责任转移到纯客户端 entry 文件。"),(0,e.Wm)("code",null,"app.js"),(0,e.Uk)(" 简单地使用 export 导出一个 "),(0,e.Wm)("code",null,"createApp"),(0,e.Uk)(" 函数：")],-1),h=(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Uk)(" Vue "),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'vue'"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Uk)(" App "),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'./App.vue'"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token comment"},"// 导出一个工厂函数，用于创建新的"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token comment"},"// 应用程序、router 和 store 实例"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"export"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"function"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"createApp"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" app "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"new"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token class-name"},"Vue"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// 根实例简单的渲染应用程序组件。"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token function-variable function"},"render"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token parameter"},"h"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"h"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("App"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" app "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br")])],-1),j=(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("strong",null,[(0,e.Wm)("code",null,"entry-client.js"),(0,e.Uk)(":")])])],-1),x=(0,e.Wm)("p",null,"客户端 entry 只需创建应用程序，并且将其挂载到 DOM 中：",-1),_=(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" createApp "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'./app'"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token comment"},"// 客户端特定引导逻辑……"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" app "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"createApp"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token comment"},'// 这里假定 App.vue 模板中根元素具有 `id="app"`'),(0,e.Uk)("\napp"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"$mount"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'#app'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br")])],-1),S=(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("strong",null,[(0,e.Wm)("code",null,"entry-server.js"),(0,e.Uk)(":")])])],-1),q=(0,e.Wm)("p",null,"服务器 entry 使用 default export 导出函数，并在每次渲染中重复调用此函数。此时，除了创建和返回应用程序实例之外，它不会做太多事情 - 但是稍后我们将在此执行服务器端路由匹配 (server-side route matching) 和数据预取逻辑 (data pre-fetching logic)。",-1),R=(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" createApp "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'./app'"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token keyword"},"export"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"default"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token parameter"},"context"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" app "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"createApp"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(" app\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br")])],-1),A=(0,e.Wm)("h3",{id:"_3-安装依赖"},[(0,e.Wm)("a",{class:"header-anchor",href:"#_3-安装依赖"},"#"),(0,e.Uk)(" 3. 安装依赖")],-1),C=(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("p",null,"安装生产依赖"),(0,e.Wm)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-bash"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token function"},"npm"),(0,e.Uk)(" i vue vue-server-renderer express cross-env\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br")])]),(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"vue-server-renderer"),(0,e.Uk)(" : Vue 服务端渲染工具")]),(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"cross-env"),(0,e.Uk)(" : 通过 npm scripts 设置跨平台环境变量")])]),(0,e.Wm)("li",null,[(0,e.Wm)("p",null,"安装开发依赖"),(0,e.Wm)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-bash"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token function"},"npm"),(0,e.Uk)(" i -D webpack webpack-cli webpack-merge webpack-node-externals @babel/core @babel/plugin-transform-runtime @babel/preset-env babel-loader css-loader url-loader file-loader rimraf vue-loader vue-template-compiler friendly-errors-webpack-plugin\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br")])]),(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"webpack-merge"),(0,e.Uk)(" : webpack 配置信息合并工具")]),(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"webpack-node-externals"),(0,e.Uk)(" : 排除 webpack 中的 Node 模块")]),(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"rimraf"),(0,e.Uk)(" : 基于 Node 封装的一个跨平台 rm -rf 工具，清除之前打包的结果")]),(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"friendly-errors-webpack-plugin"),(0,e.Uk)(" : 友好的 webpack 错误提示")]),(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"vue-loader vue-template-compiler"),(0,e.Uk)(" : 处理 .vue 资源")])])],-1),M=(0,e.Wm)("h3",{id:"_4-配置文件及打包命令"},[(0,e.Wm)("a",{class:"header-anchor",href:"#_4-配置文件及打包命令"},"#"),(0,e.Uk)(" 4. 配置文件及打包命令")],-1),D=(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("p",null,"初始化 webpack 打包配置文件"),(0,e.Wm)("div",{class:"language-docker ext-docker line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-docker"},[(0,e.Wm)("code",null,[(0,e.Uk)("build\n"),(0,e.Wm)("span",{class:"token punctuation"},"|"),(0,e.Wm)("span",{class:"token punctuation"},"-"),(0,e.Wm)("span",{class:"token punctuation"},"-"),(0,e.Uk)(" webpack.base.config.js "),(0,e.Wm)("span",{class:"token comment"},"# 公共配置"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"|"),(0,e.Wm)("span",{class:"token punctuation"},"-"),(0,e.Wm)("span",{class:"token punctuation"},"-"),(0,e.Uk)(" webpack.client.config.js "),(0,e.Wm)("span",{class:"token comment"},"# 客户端打包配置文件"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"|"),(0,e.Wm)("span",{class:"token punctuation"},"-"),(0,e.Wm)("span",{class:"token punctuation"},"-"),(0,e.Uk)(" webpack.server.config.js "),(0,e.Wm)("span",{class:"token comment"},"# 服务端打包配置文件"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br")])]),(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("code",null,"webpack.base.config.js")])]),(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token comment"},"/*\n* 公共配置\n*/"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" VueLoaderPlugin "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'vue-loader/lib/plugin'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" path "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'path'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" FriendlyErrorsWebpackPlugin "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'friendly-errors-webpack-plugin'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function-variable function"},"resolve"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token parameter"},"file"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(" path"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"resolve"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("__dirname"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("file"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" isProd "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(" process"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("env"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token constant"},"NODE_ENV"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"==="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'production'"),(0,e.Uk)("\n\nmodule"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("exports "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n  mode"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)("isProd "),(0,e.Wm)("span",{class:"token operator"},"?"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'production'"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'development'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  output"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    path"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token function"},"resolve"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'../dist'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n    publicPath"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'/dist/'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n    filename"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'[name].[chunkhash].js'"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  resolve"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    alias"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token comment"},"// 路径别名， @ 指向 src"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token string"},"'@'"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token function"},"resolve"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'../src/'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// 可以省略的扩展"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// 当省略扩展名的时候，按照从前往后的顺序依次解析"),(0,e.Uk)("\n    extensions"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"["),(0,e.Wm)("span",{class:"token string"},"'.js'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Wm)("span",{class:"token string"},"'.vue'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Wm)("span",{class:"token string"},"'.json'"),(0,e.Wm)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  devtool"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)("isProd "),(0,e.Wm)("span",{class:"token operator"},"?"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'source-map'"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'cheap-module-eval-source-map'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  module"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    rules"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"["),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token comment"},"// 处理图片资源"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        test"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token regex"},[(0,e.Wm)("span",{class:"token regex-delimiter"},"/"),(0,e.Wm)("span",{class:"token regex-source language-regex"},"\\.(png|jpg|gif)$"),(0,e.Wm)("span",{class:"token regex-delimiter"},"/"),(0,e.Wm)("span",{class:"token regex-flags"},"i")]),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n        use"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"["),(0,e.Uk)("\n          "),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n            loader"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token string"},"'url-loader'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n            options"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n              limit"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token number"},"8192"),(0,e.Uk)("\n            "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n          "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      \n      "),(0,e.Wm)("span",{class:"token comment"},"// 处理字体资源"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        test"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token regex"},[(0,e.Wm)("span",{class:"token regex-delimiter"},"/"),(0,e.Wm)("span",{class:"token regex-source language-regex"},"\\.(woff|woff2|eot|ttf|otf)$"),(0,e.Wm)("span",{class:"token regex-delimiter"},"/")]),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n        use"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"["),(0,e.Uk)("\n          "),(0,e.Wm)("span",{class:"token string"},"'file-loader'"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      \n      "),(0,e.Wm)("span",{class:"token comment"},"// 处理 .vue 资源"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        test"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token regex"},[(0,e.Wm)("span",{class:"token regex-delimiter"},"/"),(0,e.Wm)("span",{class:"token regex-source language-regex"},"\\.vue$"),(0,e.Wm)("span",{class:"token regex-delimiter"},"/")]),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n        loader"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token string"},"'vue-loader'"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      \n      "),(0,e.Wm)("span",{class:"token comment"},"// 处理 css 资源"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token comment"},"// 它会应用到普通的 .css 文件"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token comment"},"// 以及 .vue 文件中的 style 块"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        test"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token regex"},[(0,e.Wm)("span",{class:"token regex-delimiter"},"/"),(0,e.Wm)("span",{class:"token regex-source language-regex"},"\\.css$"),(0,e.Wm)("span",{class:"token regex-delimiter"},"/")]),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n        use"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"["),(0,e.Uk)("\n          "),(0,e.Wm)("span",{class:"token string"},"'vue-style-loader'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n          "),(0,e.Wm)("span",{class:"token string"},"'css-loader'"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      \n      "),(0,e.Wm)("span",{class:"token comment"},"// css 预处理器，参考：https://vue-loader.vuejs.org/zh/guide/pre-processors.html"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token comment"},"// 例如处理 less 资源"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        test"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token regex"},[(0,e.Wm)("span",{class:"token regex-delimiter"},"/"),(0,e.Wm)("span",{class:"token regex-source language-regex"},"\\.less$"),(0,e.Wm)("span",{class:"token regex-delimiter"},"/")]),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n        use"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"["),(0,e.Uk)("\n          "),(0,e.Wm)("span",{class:"token string"},"'vue-style-loader'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n          "),(0,e.Wm)("span",{class:"token string"},"'css-loader'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n          "),(0,e.Wm)("span",{class:"token string"},"'less-loader'"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  plugins"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"["),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"new"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token class-name"},"VueLoaderPlugin"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"new"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token class-name"},"FriendlyErrorsWebpackPlugin"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"15"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"16"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"17"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"18"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"19"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"20"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"21"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"22"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"23"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"24"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"25"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"26"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"27"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"28"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"29"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"30"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"31"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"32"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"33"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"34"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"35"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"36"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"37"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"38"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"39"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"40"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"41"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"42"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"43"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"44"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"45"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"46"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"47"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"48"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"49"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"50"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"51"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"52"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"53"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"54"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"55"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"56"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"57"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"58"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"59"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"60"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"61"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"62"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"63"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"64"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"65"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"66"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"67"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"68"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"69"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"70"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"71"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"72"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"73"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"74"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"75"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"76"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"77"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"78"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"79"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"80"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"81"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"82"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"83"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"84"),(0,e.Wm)("br")])]),(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("code",null,"webpack.client.config.js")])]),(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token doc-comment comment"},"/**\n * 客户端打包配置\n */"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" merge "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'webpack-merge'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" baseConfig "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'./webpack.base.config'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" VueSSRClientPlugin "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'vue-server-renderer/client-plugin'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\nmodule"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("exports "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"merge"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("baseConfig"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n  entry"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    app"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token string"},"'./src/entry-client.js'"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token comment"},"// 路径相对于执行打包命令所处的目录"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  module"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    rules"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"["),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token comment"},"// ES6 转 ES5"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        test"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token regex"},[(0,e.Wm)("span",{class:"token regex-delimiter"},"/"),(0,e.Wm)("span",{class:"token regex-source language-regex"},"\\.m?js$"),(0,e.Wm)("span",{class:"token regex-delimiter"},"/")]),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n        exclude"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token regex"},[(0,e.Wm)("span",{class:"token regex-delimiter"},"/"),(0,e.Wm)("span",{class:"token regex-source language-regex"},"(node_modules|brower_components)"),(0,e.Wm)("span",{class:"token regex-delimiter"},"/")]),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n        use"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n          loader"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token string"},"'babel-loader'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n          options"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n            presets"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"["),(0,e.Wm)("span",{class:"token string"},"'@babel/preset-env'"),(0,e.Wm)("span",{class:"token punctuation"},"]"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n            cacheDirectory"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token boolean"},"true"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n            plugins"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"["),(0,e.Wm)("span",{class:"token string"},"'@babel/plugin-transform-runtime'"),(0,e.Wm)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n          "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token comment"},"// 重要信息:这将 webpack 运行时分离到一个引导 chunk 中"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token comment"},"// 以便可以在以后正确注入异步 chunk"),(0,e.Uk)("\n  optimization"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    splitChunks"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n      name"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token string"},"'mainfest'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      minChunks"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token number"},"Infinity"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  plugins"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"["),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// 此插件在输出目录中生成 'vue-ssr-client-mainfest.json'"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"new"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token class-name"},"VueSSRClientPlugin"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"15"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"16"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"17"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"18"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"19"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"20"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"21"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"22"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"23"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"24"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"25"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"26"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"27"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"28"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"29"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"30"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"31"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"32"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"33"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"34"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"35"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"36"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"37"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"38"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"39"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"40"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"41"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"42"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"43"),(0,e.Wm)("br")])]),(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("code",null,"webpack.server.config.js")])]),(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token doc-comment comment"},"/**\n * 服务端打包配置\n */"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" merge "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'webpack-merge'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" nodeExternals "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'webpack-node-externals'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" baseConfig "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'./webpack.base.config'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" VueSSRServerPlugin "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'vue-server-renderer/server-plugin'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n\nmodule"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("exports "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"merge"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("baseConfig"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token comment"},"// 将 entry 指向应用程序的 server entry 文件"),(0,e.Uk)("\n  entry"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token string"},"'./src/entry-server.js'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  \n  "),(0,e.Wm)("span",{class:"token comment"},"// 这允许 webpack 以 node 适用方式处理模块加载"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token comment"},"// 并且还会在编译 Vue 组件时，告知 ’vue-loader' 输送面向服务器代码（server-oriented code)"),(0,e.Uk)("\n  target"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token string"},"'node'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  \n  output"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    filename"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token string"},"'server-bundle.js'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// 此处告知 server bundle 使用 Node 风格导出模块（Node-style exports)"),(0,e.Uk)("\n    libraryTarget"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token string"},"'commonjs2'"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  \n  "),(0,e.Wm)("span",{class:"token comment"},"// 不打包 node_modules 第三方包，而是保留 require 方式直接加载"),(0,e.Uk)("\n  externals"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"["),(0,e.Wm)("span",{class:"token function"},"nodeExternals"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// 白名单中的资源依然正常打包"),(0,e.Uk)("\n    allowlist"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"["),(0,e.Wm)("span",{class:"token regex"},[(0,e.Wm)("span",{class:"token regex-delimiter"},"/"),(0,e.Wm)("span",{class:"token regex-source language-regex"},"\\.css$"),(0,e.Wm)("span",{class:"token regex-delimiter"},"/")]),(0,e.Wm)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},"]"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  plugins"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"["),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// 将服务器的整个输出构建为单个的 JSON 文件的插件"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// 默认文件名为 'vue-ssr-server-bundle.json'"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"new"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token class-name"},"VueSSRServerPlugin"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"15"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"16"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"17"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"18"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"19"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"20"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"21"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"22"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"23"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"24"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"25"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"26"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"27"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"28"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"29"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"30"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"31"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"32"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"33"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"34"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"35"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"36"),(0,e.Wm)("br")])])])],-1),P=(0,e.Wm)("h3",{id:"_5-配置命令"},[(0,e.Wm)("a",{class:"header-anchor",href:"#_5-配置命令"},"#"),(0,e.Uk)(" 5. 配置命令")],-1),V=(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"package.json")]),(0,e.Wm)("div",{class:"language-json ext-json line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-json"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token property"},'"scripts"'),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token property"},'"build:client"'),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},'"cross-env NODE_ENV=production webpack --config build/webpack.client.config.js"'),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token property"},'"build:server"'),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},'"cross-env NODE_ENV=production webpack --config build/webpack.server.config.js"'),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token property"},'"build"'),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},'"rimraf dist && npm run build:client && npm run build:server"'),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token property"},'"start"'),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},'"cross-env NODE_ENV=production node server.js"'),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token property"},'"dev"'),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},'"node server.js"'),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br")])])])],-1),T=(0,e.Wm)("h3",{id:"_6-启动应用"},[(0,e.Wm)("a",{class:"header-anchor",href:"#_6-启动应用"},"#"),(0,e.Uk)(" 6. 启动应用")],-1),E=(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"server.js")]),(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" Vue "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'vue'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" express "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'express'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" fs "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'fs'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" serverBundle "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)("  "),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'./dist/vue-ssr-server-bundle.json'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" template "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(" fs"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"readFileSync"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'./index.template.html'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Wm)("span",{class:"token string"},"'utf-8'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" clientManifest "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'./dist/vue-ssr-client-manifest.json'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" renderer "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'vue-server-renderer'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"createBundleRenderer"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("serverBundle"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    template"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n    clientManifest\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" server "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"express"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token comment"},"// 当请求到 /dist 开头的资源，则自动加载 dist 下的文件"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token comment"},"// express.static('./dist'):将静态资源暴露出去"),(0,e.Uk)("\nserver"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"use"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'/dist'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" express"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"static"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'./dist'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\nserver"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"get"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'/'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},[(0,e.Uk)("req"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("res")]),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    renderer"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"renderToString"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("app"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        title"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'hello world'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n        meta"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token template-string"},[(0,e.Wm)("span",{class:"token template-punctuation string"},"`"),(0,e.Wm)("span",{class:"token string"},'<meta name="description" content="test">'),(0,e.Wm)("span",{class:"token template-punctuation string"},"`")]),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},[(0,e.Uk)("err"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("html")]),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token keyword"},"if"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("err"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n            "),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(" res"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"status"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token number"},"500"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"end"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'Internal Server Error.'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n        res"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"setHeader"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'Content-Type'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Wm)("span",{class:"token string"},"'text/html;charset=utf8'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n        res"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"end"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("html"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\nserver"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"listen"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token number"},"3000"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    console"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"log"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'server running at port 3000.'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"15"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"16"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"17"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"18"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"19"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"20"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"21"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"22"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"23"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"24"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"25"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"26"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"27"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"28"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"29"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"30"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"31"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"32"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"33"),(0,e.Wm)("br")])]),(0,e.Wm)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-bash"},[(0,e.Wm)("code",null,"nodemon server.js\n")]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br")])])])],-1),I=(0,e.Wm)("h3",{id:"_7-解析渲染流程"},[(0,e.Wm)("a",{class:"header-anchor",href:"#_7-解析渲染流程"},"#"),(0,e.Uk)(" 7. 解析渲染流程")],-1),N=(0,e.Wm)("p",null,"使用「SSR + 客户端混合」时，需要了解的一件事是，浏览器可能会更改的一些特殊的 HTML 结构。例如，当你在 Vue 模板中写入：",-1),F=(0,e.Wm)("div",{class:"language-html ext-html line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-html"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("table")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("tr")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("td")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("hi"),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("td")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("tr")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("table")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br")])],-1),B=(0,e.Wm)("p",null,[(0,e.Uk)("浏览器会在 "),(0,e.Wm)("code",null,"<table>"),(0,e.Uk)(" 内部自动注入 "),(0,e.Wm)("code",null,"<tbody>"),(0,e.Uk)("，然而，由于 Vue 生成的虚拟 DOM (virtual DOM) 不包含 "),(0,e.Wm)("code",null,"<tbody>"),(0,e.Uk)("，所以会导致无法匹配。为能够正确匹配，请确保在模板中写入有效的 HTML。")],-1),O=(0,e.Wm)("h2",{id:"构建配置-开发模式"},[(0,e.Wm)("a",{class:"header-anchor",href:"#构建配置-开发模式"},"#"),(0,e.Uk)(" 构建配置-开发模式")],-1),$=(0,e.Wm)("h3",{id:"_1-基本思路-1"},[(0,e.Wm)("a",{class:"header-anchor",href:"#_1-基本思路-1"},"#"),(0,e.Uk)(" 1. 基本思路")],-1),H=(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("p",null,"自动构建")]),(0,e.Wm)("li",null,[(0,e.Wm)("p",null,"自动重启服务")]),(0,e.Wm)("li",null,[(0,e.Wm)("p",null,"自动刷新浏览器")]),(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Wm)("strong",null,[(0,e.Wm)("code",null,"renderer")]),(0,e.Uk)(" 开发模式下要更新")])]),(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"package.json")]),(0,e.Wm)("div",{class:"language-json ext-json line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-json"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token property"},'"scripts"'),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token property"},'"start"'),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token string"},'"cross-env NODE_ENV=production node server.js"'),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token property"},'"dev"'),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token string"},'"node server.js"'),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br")])])]),(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"server.js")]),(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" Vue "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'vue'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" express "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'express'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" fs "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'fs'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" createBundleRenderer "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'vue-server-renderer'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" setupDevServer "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'./build/setup-dev-server.js'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" server "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"express"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token comment"},"// 当请求到 /dist 开头的资源，则自动加载 dist 下的文件"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token comment"},"// express.static('./dist'):将静态资源暴露出去"),(0,e.Uk)("\nserver"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"use"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'/dist'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" express"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"static"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'./dist'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" isProd "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(" process"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("env"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token constant"},"NODE_ENV"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"==="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'production'"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"let"),(0,e.Uk)(" renderer\n"),(0,e.Wm)("span",{class:"token keyword"},"let"),(0,e.Uk)(" onReady\n"),(0,e.Wm)("span",{class:"token keyword"},"if"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("isProd"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// 生产模式"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" serverBundle "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)("  "),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'./dist/vue-ssr-server-bundle.json'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" template "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(" fs"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"readFileSync"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'./index.template.html'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Wm)("span",{class:"token string"},"'utf-8'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" clientManifest "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'./dist/vue-ssr-client-manifest.json'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    renderer "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"createBundleRenderer"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("serverBundle"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        template"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n        clientManifest\n    "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token keyword"},"else"),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// 开发模式 -》 监视打包构建 -》 重新生成 Renderer 渲染器"),(0,e.Uk)("\n    onReady "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"setupDevServer"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("server"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},[(0,e.Uk)("serverBundle"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" template"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" clientManifest")]),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        renderer "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"createBundleRenderer"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("serverBundle"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n            template"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n            clientManifest\n        "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function-variable function"},"render"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},[(0,e.Uk)("req"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("res")]),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    renderer"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"renderToString"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("app"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        title"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'hello world'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n        meta"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token template-string"},[(0,e.Wm)("span",{class:"token template-punctuation string"},"`"),(0,e.Wm)("span",{class:"token string"},'<meta name="description" content="test">'),(0,e.Wm)("span",{class:"token template-punctuation string"},"`")]),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},[(0,e.Uk)("err"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("html")]),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token keyword"},"if"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("err"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n            "),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(" res"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"status"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token number"},"500"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"end"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'Internal Server Error.'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n        res"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"setHeader"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'Content-Type'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Wm)("span",{class:"token string"},"'text/html;charset=utf8'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n        res"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"end"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("html"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n\nserver"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"get"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'/'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" isProd\n\t"),(0,e.Wm)("span",{class:"token operator"},"?"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function-variable function"},"render"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"async"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},[(0,e.Uk)("req"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("res")]),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    \t"),(0,e.Wm)("span",{class:"token comment"},"// TODO 等待有了 Renderer 渲染器后，调用 render 进行渲染"),(0,e.Uk)("\n    \t"),(0,e.Wm)("span",{class:"token keyword"},"await"),(0,e.Uk)(" onReady\n    \t"),(0,e.Wm)("span",{class:"token function"},"render"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("req"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("res"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\t"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\nserver"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"listen"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token number"},"3000"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    console"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"log"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'server running at port 3000.'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"15"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"16"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"17"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"18"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"19"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"20"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"21"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"22"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"23"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"24"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"25"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"26"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"27"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"28"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"29"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"30"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"31"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"32"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"33"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"34"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"35"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"36"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"37"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"38"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"39"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"40"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"41"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"42"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"43"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"44"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"45"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"46"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"47"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"48"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"49"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"50"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"51"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"52"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"53"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"54"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"55"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"56"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"57"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"58"),(0,e.Wm)("br")])])])],-1),L=(0,e.Wm)("h3",{id:"_2-提取处理模块"},[(0,e.Wm)("a",{class:"header-anchor",href:"#_2-提取处理模块"},"#"),(0,e.Uk)(" 2. 提取处理模块")],-1),z=(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"build/setup-dev-server.js")]),(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Uk)("module"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function-variable function"},"exports"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},[(0,e.Uk)("server"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" callback")]),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" onReady "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"new"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token class-name"},"Promise"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    \n    "),(0,e.Wm)("span",{class:"token comment"},"// 监视构建 -》 更新 Renderer"),(0,e.Uk)("\n    \n    "),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(" onReady\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br")])])])],-1),Y=(0,e.Wm)("h3",{id:"_3-update-更新函数"},[(0,e.Wm)("a",{class:"header-anchor",href:"#_3-update-更新函数"},"#"),(0,e.Uk)(" 3. update 更新函数")],-1),J=(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"build/setup-dev-server.js")]),(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Uk)("module"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function-variable function"},"exports"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},[(0,e.Uk)("server"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" callback")]),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"let"),(0,e.Uk)(" ready\n    "),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" onReady "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"new"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token class-name"},"Promise"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},"r"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(" ready "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(" r"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    \n    "),(0,e.Wm)("span",{class:"token comment"},"// 监视构建 -》 更新 Renderer"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"let"),(0,e.Uk)(" template\n    "),(0,e.Wm)("span",{class:"token keyword"},"let"),(0,e.Uk)(" serverBundle\n    "),(0,e.Wm)("span",{class:"token keyword"},"let"),(0,e.Uk)(" clientManifest\n    "),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function-variable function"},"update"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token keyword"},"if"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("template "),(0,e.Wm)("span",{class:"token operator"},"&&"),(0,e.Uk)(" serverBundle "),(0,e.Wm)("span",{class:"token operator"},"&&"),(0,e.Uk)(" clientManifest"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n            "),(0,e.Wm)("span",{class:"token function"},"ready"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token comment"},"// 调用 promise 的 resolve()"),(0,e.Uk)("\n            "),(0,e.Wm)("span",{class:"token function"},"callback"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("serverBundle"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" template"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" clientManifest"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n    \n    "),(0,e.Wm)("span",{class:"token comment"},"// 监视构建 template -> 调用 update -> 更新 Renderer渲染器"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// 监视构建 serverBundle -> 调用 update -> 更新 Renderer渲染器"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// 监视构建 clientManifest -> 调用 update -> 更新 Renderer渲染器"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(" onReady\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"15"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"16"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"17"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"18"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"19"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"20"),(0,e.Wm)("br")])])])],-1),G=(0,e.Wm)("h3",{id:"_4-处理模板文件"},[(0,e.Wm)("a",{class:"header-anchor",href:"#_4-处理模板文件"},"#"),(0,e.Uk)(" 4. 处理模板文件")],-1),K=(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"build/setup-dev-server.js")]),(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" fs "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'fs'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" path "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'path'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" chokidar "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'chokidar'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token comment"},"// 监视构建 template -> 调用 update -> 更新 Renderer渲染器"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" templatePath "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(" path"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"resolve"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("__dirname"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Wm)("span",{class:"token string"},"'../index.template.html'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\ntemplate "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(" fs"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"readFileSync"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("templatePath"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'utf-8'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token function"},"update"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\nchokidar"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"watch"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("templatePath"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"on"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'change'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token function"},"update"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br")])])])],-1),Q=(0,e.Wm)("h3",{id:"_5-服务端监视打包"},[(0,e.Wm)("a",{class:"header-anchor",href:"#_5-服务端监视打包"},"#"),(0,e.Uk)(" 5. 服务端监视打包")],-1),X=(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"build/setup-dev-server.js")]),(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" webpack "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'webpack'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" resolve "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(" file "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(" path"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"resolve"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("__dirname"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("file"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token comment"},"// 监视构建 serverBundle -> 调用 update -> 更新 Renderer渲染器"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" serverConfig "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'./webpack.server.config'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" serverCompiler "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"webpack"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("serverConfig"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\nserverCompiler"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"watch"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},[(0,e.Uk)("err"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("stats")]),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"if"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("err"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"throw"),(0,e.Uk)(" err\n    "),(0,e.Wm)("span",{class:"token keyword"},"if"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("stats"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"hasErrors"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)("\n    serverBundle "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token constant"},"JSON"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"parse"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("\n        fs"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"readFileSync"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token function"},"resolve"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'../dist/vue-ssr-server-bundle.json'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'utf-8'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token function"},"update"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"15"),(0,e.Wm)("br")])])])],-1),Z=(0,e.Wm)("h3",{id:"_6-把数据写入内存中"},[(0,e.Wm)("a",{class:"header-anchor",href:"#_6-把数据写入内存中"},"#"),(0,e.Uk)(" 6. 把数据写入内存中")],-1),nn=(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Uk)("第一种方案："),(0,e.Wm)("code",null,"memfs"),(0,e.Uk)(": webpack 将打包文件保存到内存中")])]),(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Uk)("第二种方案："),(0,e.Wm)("strong",null,[(0,e.Wm)("code",null,"webpack-dev-middleware")]),(0,e.Uk)("：默认将打包构建结果输出到内存中")])]),(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"build/setup-dev-server.js")]),(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" devMiddleWare "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'webpack-dev-middleware'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" webpack "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'webpack'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" resolve "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(" file "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(" path"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"resolve"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("__dirname"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("file"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token comment"},"// 监视构建 serverBundle -> 调用 update -> 更新 Renderer渲染器"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" serverConfig "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'./webpack.server.config'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" serverCompiler "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"webpack"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("serverConfig"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" serverDevMiddleWare "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"devMiddleWare"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("serverCompiler"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    logLevel"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token string"},"'silent'"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token comment"},"// 关闭日志输出，由 FriendlyErrorsWebpackPlugin 管理输出"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\nserverCompiler"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("hooks"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("done"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"tap"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'server'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// serverDevMiddleWare.fileSystem 相当于 fs,拿到的是 devMiddleWare 内部生成的文件，由于是在内存中，fs获取不到"),(0,e.Uk)("\n    serverBundle "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token constant"},"JSON"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"parse"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("\n        serverDevMiddleWare"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("fileSystem"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"readFileSync"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token function"},"resolve"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'../dist/vue-ssr-server-bundle.json'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'utf-8'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token function"},"update"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"15"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"16"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"17"),(0,e.Wm)("br")])])])],-1),sn=(0,e.Wm)("h3",{id:"_7-客户端构建"},[(0,e.Wm)("a",{class:"header-anchor",href:"#_7-客户端构建"},"#"),(0,e.Uk)(" 7. 客户端构建")],-1),an=(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"build/setup-dev-server.js")]),(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token comment"},"// 监视构建 clientManifest -> 调用 update -> 更新 Renderer渲染器"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" clientConfig "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'./webpack.client.config'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" clientCompiler "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"webpack"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("clientConfig"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" clientDevMiddleWare "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"devMiddleWare"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("clientCompiler"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    publicPath"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)("clientConfig"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("output"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("publicPath"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n    logLevel"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token string"},"'silent'"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token comment"},"// 关闭日志输出，由 FriendlyErrorsWebpackPlugin 管理输出"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\nclientCompiler"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("hooks"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("done"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"tap"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'client'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// clientDevMiddleWare.fileSystem 相当于 fs,拿到的是 devMiddleWare 内部生成的文件，由于是在内存中，fs获取不到"),(0,e.Uk)("\n    clientManifest "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token constant"},"JSON"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"parse"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("\n        clientDevMiddleWare"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("fileSystem"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"readFileSync"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token function"},"resolve"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'../dist/vue-ssr-client-manifest.json'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'utf-8'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token function"},"update"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token comment"},"// 将 clientDevMiddleWare 挂载到 Express 服务中，提供对其内部内存中数据的访问"),(0,e.Uk)("\nserver"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"use"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("clientDevMiddleWare"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"15"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"16"),(0,e.Wm)("br")])])])],-1),en=(0,e.Wm)("h3",{id:"_8-热更新"},[(0,e.Wm)("a",{class:"header-anchor",href:"#_8-热更新"},"#"),(0,e.Uk)(" 8. 热更新")],-1),tn=(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"webpack-hot-middleware"),(0,e.Uk)(" : webpack 打包后自动热更新网页内容")])]),(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"build/setup-dev-server.js")]),(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" hotMiddleware "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'webpack-hot-middleware'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token comment"},"// 监视构建 clientManifest -> 调用 update -> 更新 Renderer渲染器"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" clientConfig "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"require"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'./webpack.client.config'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\nclientConfig"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("plugins"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"push"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token keyword"},"new"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token class-name"},[(0,e.Uk)("webpack"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("HotModuleReplacementPlugin")]),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\nclientConfig"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("entry"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("app "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"["),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// 'webpack-hot-middleware/client', // 和服务端交互处理热更新一个客户端脚本"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token string"},"'webpack-hot-middleware/client?quiet=true&reload=true'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token comment"},"// 禁用日志输出"),(0,e.Uk)("\n    clientConfig"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("entry"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("app\n"),(0,e.Wm)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\nclientConfig"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("output"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("filename "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'[name].js'"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token comment"},"// 热更新模式下确保一致的 hash"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token operator"},"..."),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("\n\nserver"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"use"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token function"},"hotMiddleware"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("clientCompiler"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    log"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token boolean"},"false"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token comment"},"// 关闭它本身的日志输出"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token comment"},"// 将 clientDevMiddleWare 挂载到 Express 服务中，提供对其内部内存中数据的访问"),(0,e.Uk)("\nserver"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"use"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("clientDevMiddleWare"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"15"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"16"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"17"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"18"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"19"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"20"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"21"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"22"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"23"),(0,e.Wm)("br")])])])],-1),mn=(0,e.Wm)("h2",{id:"编写通用应用注意事项"},[(0,e.Wm)("a",{class:"header-anchor",href:"#编写通用应用注意事项"},"#"),(0,e.Uk)(" 编写通用应用注意事项")],-1),on=(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("strong",null,"编写通用代码")])],-1),cn=(0,e.Wm)("p",null,'在进一步介绍之前，让我们花点时间来讨论编写"通用"代码时的约束条件 - 即运行在服务器和客户端的代码。由于用例和平台 API 的差异，当运行在不同环境中时，我们的代码将不会完全相同。所以这里我们将会阐述你需要理解的关键事项。',-1),ln=(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("strong",null,"服务器上的数据响应")])],-1),pn=(0,e.Wm)("p",null,"在纯客户端应用程序 (client-only app) 中，每个用户会在他们各自的浏览器中使用新的应用程序实例。对于服务器端渲染，我们也希望如此：每个请求应该都是全新的、独立的应用程序实例，以便不会有交叉请求造成的状态污染 (cross-request state pollution)。",-1),un=(0,e.Wm)("p",null,'因为实际的渲染过程需要确定性，所以我们也将在服务器上“预取”数据 ("pre-fetching" data) - 这意味着在我们开始渲染时，我们的应用程序就已经解析完成其状态。也就是说，将数据进行响应式的过程在服务器上是多余的，所以默认情况下禁用。禁用响应式数据，还可以避免将「数据」转换为「响应式对象」的性能开销。',-1),Wn=(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("strong",null,"组件生命周期钩子函数")])],-1),rn=(0,e.Wm)("p",null,[(0,e.Uk)("由于没有动态更新，所有的生命周期钩子函数中，只有 "),(0,e.Wm)("code",null,"beforeCreate"),(0,e.Uk)(" 和 "),(0,e.Wm)("code",null,"created"),(0,e.Uk)(" 会在服务器端渲染 (SSR) 过程中被调用。这就是说任何其他生命周期钩子函数中的代码（例如 "),(0,e.Wm)("code",null,"beforeMount"),(0,e.Uk)(" 或 "),(0,e.Wm)("code",null,"mounted"),(0,e.Uk)("），只会在客户端执行。")],-1),kn=(0,e.Wm)("p",null,[(0,e.Uk)("此外还需要注意的是，你应该避免在 "),(0,e.Wm)("code",null,"beforeCreate"),(0,e.Uk)(" 和 "),(0,e.Wm)("code",null,"created"),(0,e.Uk)(" 生命周期时产生全局副作用的代码，例如在其中使用 "),(0,e.Wm)("code",null,"setInterval"),(0,e.Uk)(" 设置 timer。在纯客户端 (client-side only) 的代码中，我们可以设置一个 timer，然后在 "),(0,e.Wm)("code",null,"beforeDestroy"),(0,e.Uk)(" 或 "),(0,e.Wm)("code",null,"destroyed"),(0,e.Uk)(" 生命周期时将其销毁。但是，由于在 SSR 期间并不会调用销毁钩子函数，所以 timer 将永远保留下来。为了避免这种情况，请将副作用代码移动到 "),(0,e.Wm)("code",null,"beforeMount"),(0,e.Uk)("或 "),(0,e.Wm)("code",null,"mounted"),(0,e.Uk)(" 生命周期中。")],-1),bn=(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("strong",null,"访问特定平台(Platform-Specific) API")])],-1),Un=(0,e.Wm)("p",null,[(0,e.Uk)("通用代码不可接受特定平台的 API，因此如果你的代码中，直接使用了像 "),(0,e.Wm)("code",null,"window"),(0,e.Uk)(" 或 "),(0,e.Wm)("code",null,"document"),(0,e.Uk)("，这种仅浏览器可用的全局变量，则会在 Node.js 中执行时抛出错误，反之也是如此。")],-1),dn=(0,e.Uk)("对于共享于服务器和客户端，但用于不同平台 API 的任务(task)，建议将平台特定实现包含在通用 API 中，或者使用为你执行此操作的 library。例如，"),gn={href:"https://github.com/axios/axios",target:"_blank",rel:"noopener noreferrer"},vn=(0,e.Uk)("axios"),fn=(0,e.Uk)(" 是一个 HTTP 客户端，可以向服务器和客户端都暴露相同的 API。"),yn=(0,e.Wm)("p",null,"对于仅浏览器可用的 API，通常方式是，在「纯客户端 (client-only)」的生命周期钩子函数中惰性访问 (lazily access) 它们。",-1),wn=(0,e.Wm)("p",null,[(0,e.Uk)("请注意，考虑到如果第三方 library 不是以上面的通用用法编写，则将其集成到服务器渲染的应用程序中，可能会很棘手。你"),(0,e.Wm)("em",null,"可能"),(0,e.Uk)("要通过模拟 (mock) 一些全局变量来使其正常运行，但这只是 hack 的做法，并且可能会干扰到其他 library 的环境检测代码。")],-1),hn=(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("strong",null,"自定义指令")])],-1),jn=(0,e.Wm)("p",null,"大多数自定义指令直接操作 DOM，因此会在服务器端渲染 (SSR) 过程中导致错误。有两种方法可以解决这个问题：",-1),xn=(0,e.Wm)("li",null,"推荐使用组件作为抽象机制，并运行在「虚拟 DOM 层级(Virtual-DOM level)」（例如，使用渲染函数(render function)）。",-1),_n=(0,e.Uk)("如果你有一个自定义指令，但是不是很容易替换为组件，则可以在创建服务器 renderer 时，使用 "),Sn={href:"https://ssr.vuejs.org/zh/api/#directives",target:"_blank",rel:"noopener noreferrer"},qn=(0,e.Wm)("code",null,"directives",-1),Rn=(0,e.Uk)(' 选项所提供"服务器端版本(server-side version)"。'),An=(0,e.Wm)("h2",{id:"路由"},[(0,e.Wm)("a",{class:"header-anchor",href:"#路由"},"#"),(0,e.Uk)(" 路由")],-1),Cn=(0,e.Wm)("h3",{id:"_1-路由配置"},[(0,e.Wm)("a",{class:"header-anchor",href:"#_1-路由配置"},"#"),(0,e.Uk)(" 1. 路由配置")],-1),Mn=(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Uk)("使用 "),(0,e.Wm)("code",null,"vue-router"),(0,e.Uk)(" 的路由")])]),(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"router.js")]),(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token comment"},"// router.js"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Uk)(" Vue "),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'vue'"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Uk)(" Router "),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'vue-router'"),(0,e.Uk)("\n\nVue"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"use"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("Router"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token keyword"},"export"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"function"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"createRouter"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"new"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token class-name"},"Router"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    mode"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'history'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token comment"},"// 不能使用 hash,服务端不兼容"),(0,e.Uk)("\n    routes"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"["),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token comment"},"// ..."),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br")])]),(0,e.Wm)("div",{class:"custom-container tip"},[(0,e.Wm)("p",{class:"custom-container-title"},"注意"),(0,e.Wm)("p",null,[(0,e.Uk)("类似于 "),(0,e.Wm)("code",null,"createApp"),(0,e.Uk)("，我们也需要给每个请求一个新的 router 实例，所以文件导出一个 "),(0,e.Wm)("code",null,"createRouter"),(0,e.Uk)(" 函数：")])])]),(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"app.js")]),(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token comment"},"// app.js"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Uk)(" Vue "),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'vue'"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Uk)(" App "),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'./App.vue'"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" createRouter "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'./router'"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token keyword"},"export"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"function"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"createApp"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token comment"},"// 创建 router 实例"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" router "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"createRouter"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n  "),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" app "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"new"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token class-name"},"Vue"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// 注入 router 到根 Vue 实例"),(0,e.Uk)("\n    router"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token function-variable function"},"render"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token parameter"},"h"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"h"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("App"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n  "),(0,e.Wm)("span",{class:"token comment"},"// 返回 app 和 router"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" app"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" router "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"15"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"16"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"17"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"18"),(0,e.Wm)("br")])])]),(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"entry-server.js")]),(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token comment"},"// entry-server.js"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" createApp "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'./app'"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token keyword"},"export"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"default"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token parameter"},"context"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token comment"},"// 因为有可能会是异步路由钩子函数或组件，所以我们将返回一个 Promise，"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// 以便服务器能够等待所有的内容在渲染前，"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// 就已经准备就绪。"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"new"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token class-name"},"Promise"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},[(0,e.Uk)("resolve"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" reject")]),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" app"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" router "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"createApp"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n    "),(0,e.Wm)("span",{class:"token comment"},"// 设置服务器端 router 的位置"),(0,e.Uk)("\n    router"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"push"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("context"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("url"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n    "),(0,e.Wm)("span",{class:"token comment"},"// 等到 router 将可能的异步组件和钩子函数解析完"),(0,e.Uk)("\n    router"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"onReady"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token comment"},"// router.js 已经处理了匹配不到的路由，所以下面的代码就不需要了"),(0,e.Uk)("\n        \n      "),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" matchedComponents "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(" router"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"getMatchedComponents"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token comment"},"// 匹配不到的路由，执行 reject 函数，并返回 404"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token keyword"},"if"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token operator"},"!"),(0,e.Uk)("matchedComponents"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("length"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"reject"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" code"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token number"},"404"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n\n      "),(0,e.Wm)("span",{class:"token comment"},"// Promise 应该 resolve 应用程序实例，以便它可以渲染"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token function"},"resolve"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("app"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" reject"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"15"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"16"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"17"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"18"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"19"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"20"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"21"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"22"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"23"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"24"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"25"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"26"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"27"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"28"),(0,e.Wm)("br")])]),(0,e.Wm)("p",null,[(0,e.Wm)("strong",null,"改造优化")]),(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token comment"},"// entry-server.js"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" createApp "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'./app'"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token keyword"},"export"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"default"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"async"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token parameter"},"context"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// async 函数默认返回 promise"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" app"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" router "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"createApp"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n    "),(0,e.Wm)("span",{class:"token comment"},"// 设置服务器端 router 的位置"),(0,e.Uk)("\n    router"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"push"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("context"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("url"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n    "),(0,e.Wm)("span",{class:"token comment"},"// 等到 router 将可能的异步组件和钩子函数解析完"),(0,e.Uk)("\n\t"),(0,e.Wm)("span",{class:"token comment"},"// new Promise((resolve,reject) => {"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token comment"},"// router.onReady(resolve,reject)"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// })"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"await"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"new"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token class-name"},"Promise"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("router"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"onReady"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"bind"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("router"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    \n    "),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(" app\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"15"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"16"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"17"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"18"),(0,e.Wm)("br")])])])],-1),Dn=(0,e.Wm)("h3",{id:"_2-服务端-server-适配"},[(0,e.Wm)("a",{class:"header-anchor",href:"#_2-服务端-server-适配"},"#"),(0,e.Uk)(" 2. 服务端 server 适配")],-1),Pn=(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"server.js")]),(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function-variable function"},"render"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"async"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},[(0,e.Uk)("req"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" res")]),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token keyword"},"try"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" html "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"await"),(0,e.Uk)(" renderer"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"renderToString"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n      title"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token string"},"'走遍中国'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      meta"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Wm)("span",{class:"token template-string"},[(0,e.Wm)("span",{class:"token template-punctuation string"},"`"),(0,e.Wm)("span",{class:"token string"},'\n      <meta name="description" content="美食">\n    '),(0,e.Wm)("span",{class:"token template-punctuation string"},"`")]),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      url"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)("req"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("url "),(0,e.Wm)("span",{class:"token comment"},"// 添加 url"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// 中文乱码 - 设置 header 和 页面模板"),(0,e.Uk)("\n    res"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"setHeader"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'Content-Type'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Wm)("span",{class:"token string"},"'text/html; charset=utf-8'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    res"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"end"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("html"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token keyword"},"catch"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("err"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    res"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"status"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token number"},"500"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"end"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'Internal Server Error'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token comment"},"// 服务端路由设置为 * ，则所有的路由都会进入到这里(服务端本身的路由)"),(0,e.Uk)("\nserver"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"get"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'*'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" isProd\n  "),(0,e.Wm)("span",{class:"token operator"},"?"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function-variable function"},"render"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"async"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},[(0,e.Uk)("req"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("res")]),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"await"),(0,e.Uk)(" onReady\n    "),(0,e.Wm)("span",{class:"token function"},"render"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("req"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("res"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"15"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"16"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"17"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"18"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"19"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"20"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"21"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"22"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"23"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"24"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"25"),(0,e.Wm)("br")])])]),(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"entry-server.js")]),(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token comment"},"// entry-server.js"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" createApp "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'./app'"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token keyword"},"export"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"default"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"async"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token parameter"},"context"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// async 函数默认返回 promise"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" app"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" router "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"createApp"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n    "),(0,e.Wm)("span",{class:"token comment"},"// 设置服务器端 router 的位置"),(0,e.Uk)("\n    router"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"push"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("context"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("url"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n    "),(0,e.Wm)("span",{class:"token comment"},"// 等到 router 将可能的异步组件和钩子函数解析完"),(0,e.Uk)("\n\t"),(0,e.Wm)("span",{class:"token comment"},"// new Promise((resolve,reject) => {"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token comment"},"// router.onReady(resolve,reject)"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// })"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"await"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"new"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token class-name"},"Promise"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("router"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"onReady"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"bind"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("router"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    \n    "),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(" app\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"15"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"16"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"17"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"18"),(0,e.Wm)("br")])])])],-1),Vn=(0,e.Wm)("h3",{id:"_3-适配客户端入口"},[(0,e.Wm)("a",{class:"header-anchor",href:"#_3-适配客户端入口"},"#"),(0,e.Uk)(" 3. 适配客户端入口")],-1),Tn=(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"entry-client.js")]),(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" createApp "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'./app'"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token comment"},"// 客户端特定引导逻辑……"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" app"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" router "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"createApp"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\nrouter"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"onReady"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    app"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"$mount"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'#app'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br")])])])],-1),En=(0,e.Wm)("h3",{id:"_4-路由处理完成"},[(0,e.Wm)("a",{class:"header-anchor",href:"#_4-路由处理完成"},"#"),(0,e.Uk)(" 4. 路由处理完成")],-1),In=(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("code",null,"router-link")]),(0,e.Wm)("li",null,[(0,e.Wm)("code",null,"router-view")])],-1),Nn=(0,e.Wm)("h3",{id:"_5-管理页面-head-内容"},[(0,e.Wm)("a",{class:"header-anchor",href:"#_5-管理页面-head-内容"},"#"),(0,e.Uk)(" 5. 管理页面 Head 内容")],-1),Fn=(0,e.Wm)("li",null,[(0,e.Wm)("p",null,"让不同的页面定制 不同 的 head 标签内容")],-1),Bn=(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Wm)("code",null,"vue-meta"),(0,e.Uk)(" : 插件：轻松实现不同页面的 head 内容管理")])],-1),On={href:"https://vue-meta.nuxtjs.org/",target:"_blank",rel:"noopener noreferrer"},$n=(0,e.Uk)("https://vue-meta.nuxtjs.org/"),Hn=(0,e.uE)('<div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>npm i vue-meta\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// app.js</span>\n<span class="token keyword">import</span> VueMeta <span class="token keyword">from</span> <span class="token string">&#39;vue-meta&#39;</span>\nVue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueMeta<span class="token punctuation">)</span>\n\nVue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  metaInfo<span class="token operator">:</span><span class="token punctuation">{</span>\n    titleTemplate<span class="token operator">:</span><span class="token string">&#39;%s - 快乐中国&#39;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// entry-server.js</span>\n\n<span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./app&#39;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token parameter">context</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token comment">// async 函数默认返回 promise</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> app<span class="token punctuation">,</span> router <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    \n    <span class="token keyword">const</span> meta <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">$meta</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n    <span class="token comment">// 设置服务器端 router 的位置</span>\n    router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>url<span class="token punctuation">)</span>\n    \n    context<span class="token punctuation">.</span>meta <span class="token operator">=</span> meta\n\n    <span class="token comment">// 等到 router 将可能的异步组件和钩子函数解析完</span>\n\t<span class="token comment">// new Promise((resolve,reject) =&gt; {</span>\n        <span class="token comment">// router.onReady(resolve,reject)</span>\n    <span class="token comment">// })</span>\n    <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">onReady</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token keyword">return</span> app\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code>// index.template.html\n<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width,initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n  {{{ meta.inject().title.text() }}}\n  {{{ meta.inject().meta.text() }}}\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>\n  <span class="token comment">&lt;!--vue-ssr-outlet--&gt;</span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code>// about.vue\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">\n  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n    name<span class="token operator">:</span> <span class="token string">&quot;About&quot;</span><span class="token punctuation">,</span>\n    metaInfo<span class="token operator">:</span><span class="token punctuation">{</span>\n      title<span class="token operator">:</span><span class="token string">&#39;关于&#39;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div>',5),Ln=(0,e.Wm)("h2",{id:"代码分割"},[(0,e.Wm)("a",{class:"header-anchor",href:"#代码分割"},"#"),(0,e.Uk)(" 代码分割")],-1),zn=(0,e.Wm)("p",null,'应用程序的代码分割或惰性加载，有助于减少浏览器在初始渲染中下载的资源体积，可以极大地改善大体积 bundle 的可交互时间(TTI - time-to-interactive)。这里的关键在于，对初始首屏而言，"只加载所需"。',-1),Yn=(0,e.Uk)("Vue 提供异步组件作为第一类的概念，将其与 "),Jn={href:"https://webpack.js.org/guides/code-splitting-async/",target:"_blank",rel:"noopener noreferrer"},Gn=(0,e.Uk)("webpack 2 所支持的使用动态导入作为代码分割点"),Kn=(0,e.Uk)("相结合，你需要做的是："),Qn=(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token comment"},"// 这里进行修改……"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Uk)(" Foo "),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'./Foo.vue'"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token comment"},"// 改为这样："),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function-variable function"},"Foo"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'./Foo.vue'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br")])],-1),Xn=(0,e.Wm)("p",null,"在 Vue 2.5 以下的版本中，服务端渲染时异步组件只能用在路由组件上。然而在 2.5+ 的版本中，得益于核心算法的升级，异步组件现在可以在应用中的任何地方使用。",-1),Zn=(0,e.Wm)("p",null,[(0,e.Uk)("需要注意的是，你仍然需要在挂载 app 之前调用 "),(0,e.Wm)("code",null,"router.onReady"),(0,e.Uk)("，因为路由器必须要提前解析路由配置中的异步组件，才能正确地调用组件中可能存在的路由钩子。这一步我们已经在我们的服务器入口 (server entry) 中实现过了，现在我们只需要更新客户端入口 (client entry)：")],-1),ns=(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token comment"},"// entry-client.js"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" createApp "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'./app'"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" app"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" router "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"createApp"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\nrouter"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"onReady"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n  app"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"$mount"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'#app'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br")])],-1),ss=(0,e.Wm)("p",null,"异步路由组件的路由配置示例：",-1),as=(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token comment"},"// router.js"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Uk)(" Vue "),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'vue'"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Uk)(" Router "),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'vue-router'"),(0,e.Uk)("\n\nVue"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"use"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("Router"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token keyword"},"export"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"function"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"createRouter"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"new"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token class-name"},"Router"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    mode"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'history'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n    routes"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"["),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" path"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'/'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function-variable function"},"component"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'./components/Home.vue'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" path"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'/item/:id'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function-variable function"},"component"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'./components/Item.vue'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"15"),(0,e.Wm)("br")])],-1),es=(0,e.Wm)("h2",{id:"数据预取和状态管理"},[(0,e.Wm)("a",{class:"header-anchor",href:"#数据预取和状态管理"},"#"),(0,e.Uk)(" 数据预取和状态管理")],-1),ts=(0,e.Wm)("h3",{id:"数据预取存储容器-data-store"},[(0,e.Wm)("a",{class:"header-anchor",href:"#数据预取存储容器-data-store"},"#"),(0,e.Uk)(" 数据预取存储容器 (Data Store)")],-1),ms=(0,e.Wm)("p",null,[(0,e.Uk)('在服务器端渲染(SSR)期间，我们本质上是在渲染我们应用程序的"快照"，所以如果应用程序依赖于一些异步数据，'),(0,e.Wm)("strong",null,"那么在开始渲染过程之前，需要先预取和解析好这些数据"),(0,e.Uk)("。")],-1),os=(0,e.Wm)("p",null,"另一个需要关注的问题是在客户端，在挂载 (mount) 到客户端应用程序之前，需要获取到与服务器端应用程序完全相同的数据 - 否则，客户端应用程序会因为使用与服务器端应用程序不同的状态，然后导致混合失败。",-1),cs=(0,e.Wm)("p",null,'为了解决这个问题，获取的数据需要位于视图组件之外，即放置在专门的数据预取存储容器(data store)或"状态容器(state container)"中。首先，在服务器端，我们可以在渲染之前预取数据，并将数据填充到 store 中。此外，我们将在 HTML 中序列化(serialize)和内联预置(inline)状态。这样，在挂载(mount)到客户端应用程序之前，可以直接从 store 获取到内联预置(inline)状态。',-1),ls=(0,e.Uk)("为此，我们将使用官方状态管理库 "),ps={href:"https://github.com/vuejs/vuex/",target:"_blank",rel:"noopener noreferrer"},us=(0,e.Uk)("Vuex"),Ws=(0,e.Uk)("。我们先创建一个 "),rs=(0,e.Wm)("code",null,"store.js",-1),ks=(0,e.Uk)(" 文件，里面会模拟一些根据 id 获取 item 的逻辑："),is=(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token comment"},"// store.js"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Uk)(" Vue "),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'vue'"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Uk)(" Vuex "),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'vuex'"),(0,e.Uk)("\n\nVue"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"use"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("Vuex"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token comment"},"// 假定我们有一个可以返回 Promise 的"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token comment"},"// 通用 API（请忽略此 API 具体实现细节）"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" fetchItem "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'./api'"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token keyword"},"export"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"function"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"createStore"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"new"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token class-name"},[(0,e.Uk)("Vuex"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("Store")]),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    state"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n      items"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n    actions"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token function"},"fetchItem"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},[(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" commit "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" id")]),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token comment"},"// `store.dispatch()` 会返回 Promise，"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token comment"},"// 以便我们能够知道数据在何时更新"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"fetchItem"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("id"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"then"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},"item"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n          "),(0,e.Wm)("span",{class:"token function"},"commit"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'setItem'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" id"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" item "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n    mutations"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token function"},"setItem"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},[(0,e.Uk)("state"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" id"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" item "),(0,e.Wm)("span",{class:"token punctuation"},"}")]),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        Vue"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"set"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("state"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("items"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" id"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" item"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"15"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"16"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"17"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"18"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"19"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"20"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"21"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"22"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"23"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"24"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"25"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"26"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"27"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"28"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"29"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"30"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"31"),(0,e.Wm)("br")])],-1),bs=(0,e.Wm)("p",null,[(0,e.Uk)("然后修改 "),(0,e.Wm)("code",null,"app.js"),(0,e.Uk)("：")],-1),Us=(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token comment"},"// app.js"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Uk)(" Vue "),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'vue'"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Uk)(" App "),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'./App.vue'"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" createRouter "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'./router'"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" createStore "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'./store'"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" sync "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'vuex-router-sync'"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token keyword"},"export"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"function"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"createApp"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token comment"},"// 创建 router 和 store 实例"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" router "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"createRouter"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" store "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"createStore"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n  "),(0,e.Wm)("span",{class:"token comment"},"// 同步路由状态(route state)到 store"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token function"},"sync"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("store"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" router"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n  "),(0,e.Wm)("span",{class:"token comment"},"// 创建应用程序实例，将 router 和 store 注入"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" app "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"new"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token class-name"},"Vue"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    router"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n    store"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token function-variable function"},"render"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token parameter"},"h"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"h"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("App"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n  "),(0,e.Wm)("span",{class:"token comment"},"// 暴露 app, router 和 store。"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" app"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" router"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" store "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"15"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"16"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"17"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"18"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"19"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"20"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"21"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"22"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"23"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"24"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"25"),(0,e.Wm)("br")])],-1),ds=(0,e.Wm)("h3",{id:"带有逻辑配置的组件-logic-collocation-with-components"},[(0,e.Wm)("a",{class:"header-anchor",href:"#带有逻辑配置的组件-logic-collocation-with-components"},"#"),(0,e.Uk)(" 带有逻辑配置的组件 (Logic Collocation with Components)")],-1),gs=(0,e.Wm)("p",null,"那么，我们在哪里放置「dispatch 数据预取 action」的代码？",-1),vs=(0,e.Wm)("p",null,"我们需要通过访问路由，来决定获取哪部分数据 - 这也决定了哪些组件需要渲染。事实上，给定路由所需的数据，也是在该路由上渲染组件时所需的数据。所以在路由组件中放置数据预取逻辑，是很自然的事情。",-1),fs=(0,e.Wm)("p",null,[(0,e.Uk)("我们将在路由组件上暴露出一个自定义静态函数 "),(0,e.Wm)("code",null,"asyncData"),(0,e.Uk)("。注意，由于此函数会在组件实例化之前调用，所以它无法访问 "),(0,e.Wm)("code",null,"this"),(0,e.Uk)("。需要将 store 和路由信息作为参数传递进去：")],-1),ys=(0,e.Wm)("div",{class:"language-html ext-html line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-html"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token comment"},"\x3c!-- Item.vue --\x3e"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("template")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("div")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("{{ item.title }}"),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("div")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("template")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("script")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Wm)("span",{class:"token script"},[(0,e.Wm)("span",{class:"token language-javascript"},[(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"export"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"default"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token function"},"asyncData"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},[(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" store"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" route "),(0,e.Wm)("span",{class:"token punctuation"},"}")]),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// 触发 action 后，会返回 Promise"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(" store"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"dispatch"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'fetchItem'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" route"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("params"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("id"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  computed"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// 从 store 的 state 对象中的获取 item。"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token function"},"item"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"this"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("$store"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("state"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("items"),(0,e.Wm)("span",{class:"token punctuation"},"["),(0,e.Wm)("span",{class:"token keyword"},"this"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("$route"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("params"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("id"),(0,e.Wm)("span",{class:"token punctuation"},"]"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n")])]),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("script")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"15"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"16"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"17"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"18"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"19"),(0,e.Wm)("br")])],-1),ws=(0,e.Wm)("h3",{id:"服务器端数据预取-server-data-fetching"},[(0,e.Wm)("a",{class:"header-anchor",href:"#服务器端数据预取-server-data-fetching"},"#"),(0,e.Uk)(" 服务器端数据预取 (Server Data Fetching)")],-1),hs=(0,e.Wm)("p",null,[(0,e.Uk)("在 "),(0,e.Wm)("code",null,"entry-server.js"),(0,e.Uk)(" 中，我们可以通过路由获得与 "),(0,e.Wm)("code",null,"router.getMatchedComponents()"),(0,e.Uk)(" 相匹配的组件，如果组件暴露出 "),(0,e.Wm)("code",null,"asyncData"),(0,e.Uk)("，我们就调用这个方法。然后我们需要将解析完成的状态，附加到渲染上下文(render context)中。")],-1),js=(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token comment"},"// entry-server.js"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" createApp "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'./app'"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token keyword"},"export"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"default"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"async"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token parameter"},"context"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" app"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" router"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" store "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"createApp"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" meta "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(" app"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"$meta"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n  router"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"push"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("context"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("url"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n  context"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("meta "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(" meta\n  "),(0,e.Wm)("span",{class:"token keyword"},"await"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"new"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token class-name"},"Promise"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("router"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"onReady"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"bind"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("router"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n  \n  context"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function-variable function"},"rendered"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// rendered 会把 context.state 数据对象内联到页面模板中"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// 最终发送给客户端的页面会包含一段脚本：window.__INITIAL_STATE__ = context.state"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// 客户端就要把页面中的 window.__INITIAL_STATE__ 拿出来填充到客户端 store 容器中"),(0,e.Uk)("\n    context"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("state "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(" store"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("state\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(" app\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"15"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"16"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"17"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"18"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"19"),(0,e.Wm)("br")])],-1),xs=(0,e.Wm)("p",null,[(0,e.Uk)("当使用 "),(0,e.Wm)("code",null,"template"),(0,e.Uk)(" 时，"),(0,e.Wm)("code",null,"context.state"),(0,e.Uk)(" 将作为 "),(0,e.Wm)("code",null,"window.__INITIAL_STATE__"),(0,e.Uk)(" 状态，自动嵌入到最终的 HTML 中。而在客户端，在挂载到应用程序之前，store 就应该获取到状态：")],-1),_s=(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token comment"},"// entry-client.js"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" createApp "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'./app'"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" app"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" router"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" store "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"createApp"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token keyword"},"if"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("window"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("__INITIAL_STATE__"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n  store"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"replaceState"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("window"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("__INITIAL_STATE__"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n\nrouter"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"onReady"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n  app"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"$mount"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'#app'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br")])],-1),Ss=(0,e.Wm)("h3",{id:"客户端数据预取-client-data-fetching"},[(0,e.Wm)("a",{class:"header-anchor",href:"#客户端数据预取-client-data-fetching"},"#"),(0,e.Uk)(" 客户端数据预取 (Client Data Fetching)")],-1),qs=(0,e.Wm)("p",null,"在客户端，处理数据预取有两种不同方式：",-1),Rs=(0,e.Wm)("ol",null,[(0,e.Wm)("li",null,[(0,e.Wm)("strong",null,"在路由导航之前解析数据：")])],-1),As=(0,e.Wm)("p",null,'使用此策略，应用程序会等待视图所需数据全部解析之后，再传入数据并处理当前视图。好处在于，可以直接在数据准备就绪时，传入视图渲染完整内容，但是如果数据预取需要很长时间，用户在当前视图会感受到"明显卡顿"。因此，如果使用此策略，建议提供一个数据加载指示器 (data loading indicator)。',-1),Cs=(0,e.Wm)("p",null,[(0,e.Uk)("我们可以通过检查匹配的组件，并在全局路由钩子函数中执行 "),(0,e.Wm)("code",null,"asyncData"),(0,e.Uk)(" 函数，来在客户端实现此策略。注意，在初始路由准备就绪之后，我们应该注册此钩子，这样我们就不必再次获取服务器提取的数据。")],-1),Ms=(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token comment"},"// entry-client.js"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token comment"},"// ...忽略无关代码"),(0,e.Uk)("\n\nrouter"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"onReady"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token comment"},"// 添加路由钩子函数，用于处理 asyncData."),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token comment"},"// 在初始路由 resolve 后执行，"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token comment"},"// 以便我们不会二次预取(double-fetch)已有的数据。"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token comment"},"// 使用 `router.beforeResolve()`，以便确保所有异步组件都 resolve。"),(0,e.Uk)("\n  router"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"beforeResolve"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},[(0,e.Uk)("to"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" next")]),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" matched "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(" router"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"getMatchedComponents"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("to"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" prevMatched "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(" router"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"getMatchedComponents"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n    "),(0,e.Wm)("span",{class:"token comment"},"// 我们只关心非预渲染的组件"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"// 所以我们对比它们，找出两个匹配列表的差异组件"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"let"),(0,e.Uk)(" diffed "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token boolean"},"false"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(" activated "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(" matched"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"filter"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},[(0,e.Uk)("c"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" i")]),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(" diffed "),(0,e.Wm)("span",{class:"token operator"},"||"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("diffed "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("prevMatched"),(0,e.Wm)("span",{class:"token punctuation"},"["),(0,e.Uk)("i"),(0,e.Wm)("span",{class:"token punctuation"},"]"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"!=="),(0,e.Uk)(" c"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n    "),(0,e.Wm)("span",{class:"token keyword"},"if"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token operator"},"!"),(0,e.Uk)("activated"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("length"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"next"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n\n    "),(0,e.Wm)("span",{class:"token comment"},"// 这里如果有加载指示器 (loading indicator)，就触发"),(0,e.Uk)("\n\n    Promise"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"all"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("activated"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"map"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},"c"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token keyword"},"if"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("c"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("asyncData"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        "),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(" c"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"asyncData"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" store"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" route"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(" to "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"then"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n\n      "),(0,e.Wm)("span",{class:"token comment"},"// 停止加载指示器(loading indicator)"),(0,e.Uk)("\n\n      "),(0,e.Wm)("span",{class:"token function"},"next"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"catch"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("next"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n\n  app"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"$mount"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'#app'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"15"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"16"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"17"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"18"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"19"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"20"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"21"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"22"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"23"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"24"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"25"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"26"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"27"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"28"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"29"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"30"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"31"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"32"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"33"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"34"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"35"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"36"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"37"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"38"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"39"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"40"),(0,e.Wm)("br")])],-1),Ds=(0,e.Wm)("ol",null,[(0,e.Wm)("li",null,[(0,e.Wm)("strong",null,"匹配要渲染的视图后，再获取数据：")])],-1),Ps=(0,e.Wm)("p",null,[(0,e.Uk)("此策略将客户端数据预取逻辑，放在视图组件的 "),(0,e.Wm)("code",null,"beforeMount"),(0,e.Uk)(" 函数中。当路由导航被触发时，可以立即切换视图，因此应用程序具有更快的响应速度。然而，传入视图在渲染时不会有完整的可用数据。因此，对于使用此策略的每个视图组件，都需要具有条件加载状态。")],-1),Vs=(0,e.Wm)("p",null,"这可以通过纯客户端 (client-only) 的全局 mixin 来实现：",-1),Ts=(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Uk)("Vue"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"mixin"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token function"},"beforeMount"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" asyncData "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"this"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("$options\n    "),(0,e.Wm)("span",{class:"token keyword"},"if"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("asyncData"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token comment"},"// 将获取数据操作分配给 promise"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token comment"},"// 以便在组件中，我们可以在数据准备就绪后"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token comment"},"// 通过运行 `this.dataPromise.then(...)` 来执行其他任务"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token keyword"},"this"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("dataPromise "),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"asyncData"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        store"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"this"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("$store"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n        route"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"this"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("$route\n      "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br")])],-1),Es=(0,e.Wm)("p",null,[(0,e.Uk)("这两种策略是根本上不同的用户体验决策，应该根据你创建的应用程序的实际使用场景进行挑选。但是无论你选择哪种策略，当路由组件重用（同一路由，但是 params 或 query 已更改，例如，从 "),(0,e.Wm)("code",null,"user/1"),(0,e.Uk)(" 到 "),(0,e.Wm)("code",null,"user/2"),(0,e.Uk)("）时，也应该调用 "),(0,e.Wm)("code",null,"asyncData"),(0,e.Uk)(" 函数。我们也可以通过纯客户端 (client-only) 的全局 mixin 来处理这个问题：")],-1),Is=(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Uk)("Vue"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"mixin"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token function"},"beforeRouteUpdate"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},[(0,e.Uk)("to"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" next")]),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"const"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" asyncData "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"="),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"this"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("$options\n    "),(0,e.Wm)("span",{class:"token keyword"},"if"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("asyncData"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token function"},"asyncData"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n        store"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"this"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("$store"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n        route"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(" to\n      "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"then"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("next"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"catch"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("next"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"else"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token function"},"next"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br")])],-1),Ns=(0,e.Wm)("h3",{id:"store-代码拆分-store-code-splitting"},[(0,e.Wm)("a",{class:"header-anchor",href:"#store-代码拆分-store-code-splitting"},"#"),(0,e.Uk)(" Store 代码拆分 (Store Code Splitting)")],-1),Fs=(0,e.Wm)("p",null,"在大型应用程序中，我们的 Vuex store 可能会分为多个模块。当然，也可以将这些模块代码，分割到相应的路由组件 chunk 中。假设我们有以下 store 模块：",-1),Bs=(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token comment"},"// store/modules/foo.js"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"export"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"default"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n  namespaced"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token boolean"},"true"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token comment"},"// 重要信息：state 必须是一个函数，"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token comment"},"// 因此可以创建多个实例化该模块"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token function-variable function"},"state"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    count"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token number"},"0"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  actions"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token function-variable function"},"inc"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},[(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" commit "),(0,e.Wm)("span",{class:"token punctuation"},"}")]),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token function"},"commit"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'inc'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n  mutations"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token function-variable function"},"inc"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token parameter"},"state"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(" state"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("count"),(0,e.Wm)("span",{class:"token operator"},"++"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"15"),(0,e.Wm)("br")])],-1),Os=(0,e.Wm)("p",null,[(0,e.Uk)("我们可以在路由组件的 "),(0,e.Wm)("code",null,"asyncData"),(0,e.Uk)(" 钩子函数中，使用 "),(0,e.Wm)("code",null,"store.registerModule"),(0,e.Uk)(" 惰性注册(lazy-register)这个模块：")],-1),$s=(0,e.Wm)("div",{class:"language-vue ext-vue line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-vue"},[(0,e.Wm)("code",null,[(0,e.Uk)("// 在路由组件内\n"),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("template")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("div")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("{{ fooCount }}"),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("div")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("template")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("script")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Wm)("span",{class:"token script"},[(0,e.Wm)("span",{class:"token language-javascript"},[(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token comment"},"// 在这里导入模块，而不是在 `store/index.js` 中"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"import"),(0,e.Uk)(" fooStoreModule "),(0,e.Wm)("span",{class:"token keyword"},"from"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token string"},"'../store/modules/foo'"),(0,e.Uk)("\n\n"),(0,e.Wm)("span",{class:"token keyword"},"export"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"default"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token function"},"asyncData"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},[(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)(" store "),(0,e.Wm)("span",{class:"token punctuation"},"}")]),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    store"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"registerModule"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'foo'"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" fooStoreModule"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(" store"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"dispatch"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'foo/inc'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n\n  "),(0,e.Wm)("span",{class:"token comment"},"// 重要信息：当多次访问路由时，"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token comment"},"// 避免在客户端重复注册模块。"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token function"},"destroyed"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token keyword"},"this"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("$store"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"unregisterModule"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},"'foo'"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)("\n\n  computed"),(0,e.Wm)("span",{class:"token operator"},":"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token function"},"fooCount"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"this"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("$store"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("state"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("foo"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Uk)("count\n    "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n")])]),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("script")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"15"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"16"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"17"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"18"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"19"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"20"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"21"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"22"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"23"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"24"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"25"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"26"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"27"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"28"),(0,e.Wm)("br")])],-1),Hs=(0,e.Wm)("p",null,"由于模块现在是路由组件的依赖，所以它将被 webpack 移动到路由组件的异步 chunk 中。",-1),Ls={render:function(n,s){const a=(0,e.up)("OutboundLink");return(0,e.wg)(),(0,e.j4)(e.HY,null,[m,o,c,l,p,u,W,r,k,i,(0,e.Wm)("p",null,[b,(0,e.Wm)("a",U,[d,(0,e.Wm)(a)]),g]),v,f,y,w,h,j,x,_,S,q,R,A,C,M,D,P,V,T,E,I,N,F,B,O,$,H,L,z,Y,J,G,K,Q,X,Z,nn,sn,an,en,tn,mn,on,cn,ln,pn,un,Wn,rn,kn,bn,Un,(0,e.Wm)("p",null,[dn,(0,e.Wm)("a",gn,[vn,(0,e.Wm)(a)]),fn]),yn,wn,hn,jn,(0,e.Wm)("ol",null,[xn,(0,e.Wm)("li",null,[_n,(0,e.Wm)("a",Sn,[qn,(0,e.Wm)(a)]),Rn])]),An,Cn,Mn,Dn,Pn,Vn,Tn,En,In,Nn,(0,e.Wm)("ul",null,[Fn,Bn,(0,e.Wm)("li",null,[(0,e.Wm)("p",null,[(0,e.Wm)("a",On,[$n,(0,e.Wm)(a)])]),Hn])]),Ln,zn,(0,e.Wm)("p",null,[Yn,(0,e.Wm)("a",Jn,[Gn,(0,e.Wm)(a)]),Kn]),Qn,Xn,Zn,ns,ss,as,es,ts,ms,os,cs,(0,e.Wm)("p",null,[ls,(0,e.Wm)("a",ps,[us,(0,e.Wm)(a)]),Ws,rs,ks]),is,bs,Us,ds,gs,vs,fs,ys,ws,hs,js,xs,_s,Ss,qs,Rs,As,Cs,Ms,Ds,Ps,Vs,Ts,Es,Is,Ns,Fs,Bs,Os,$s,Hs],64)}}}}]);