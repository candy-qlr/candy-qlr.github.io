(self.webpackChunkvuepress_blog=self.webpackChunkvuepress_blog||[]).push([[205],{8324:(n,s,a)=>{"use strict";a.r(s),a.d(s,{data:()=>t});const t={key:"v-71773936",path:"/guide/vue/%E8%99%9A%E6%8B%9FDOM.html",title:"Virtual DOM",lang:"en-US",frontmatter:{title:"Virtual DOM"},excerpt:"",headers:[{level:3,title:"什么是 Virtual DOM",slug:"什么是-virtual-dom",children:[]},{level:3,title:"为什么使用 Virtual DOM",slug:"为什么使用-virtual-dom",children:[]},{level:3,title:"虚拟 DOM 的作用",slug:"虚拟-dom-的作用",children:[]},{level:3,title:"Virtual DOM 库",slug:"virtual-dom-库",children:[]},{level:2,title:"Snabbdom 基本使用",slug:"snabbdom-基本使用",children:[{level:3,title:"创建项目",slug:"创建项目",children:[]},{level:3,title:"导入 Snabbdom",slug:"导入-snabbdom",children:[]},{level:3,title:"代码演示",slug:"代码演示",children:[]}]},{level:2,title:"Snabbdom 源码解析",slug:"snabbdom-源码解析",children:[{level:3,title:"如何学习源码",slug:"如何学习源码",children:[]},{level:3,title:"Snabbdom 的核心",slug:"snabbdom-的核心",children:[]},{level:3,title:"Snabbdom 源码",slug:"snabbdom-源码",children:[]},{level:3,title:"h 函数",slug:"h-函数",children:[]},{level:3,title:"VNode",slug:"vnode",children:[]},{level:3,title:"snabbdom",slug:"snabbdom",children:[]},{level:3,title:"init",slug:"init",children:[]},{level:3,title:"patch",slug:"patch",children:[]},{level:3,title:"createElm",slug:"createelm",children:[]},{level:3,title:"patchVnode",slug:"patchvnode",children:[]},{level:3,title:"updateChildren",slug:"updatechildren",children:[]},{level:3,title:"调试 updateChildren",slug:"调试-updatechildren",children:[]}]}],filePathRelative:"guide/vue/虚拟DOM.md",git:{updatedTime:1625131972e3,contributors:[]}}},4531:(n,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>ls});var t=a(6252);const e=a.p+"assets/img/image-20200102104642121.005a8857.png",o=a.p+"assets/img/image-20200102103653779.b20192d5.png",p=a.p+"assets/img/patchVnode.0fbf498c.jpg",l=a.p+"assets/img/image-20200109184608649.b0eb7670.png",c=a.p+"assets/img/image-20200103121812840.94678028.png",m=a.p+"assets/img/image-20200103125428541.937ab20a.png",u=a.p+"assets/img/image-20200103125735048.e9b53c0c.png",k=a.p+"assets/img/image-20200109184822439.9ffa2126.png",W=a.p+"assets/img/image-20200103150918335.2cc690c2.png",i=a.p+"assets/img/image-20200109194751093.7e167e5a.png",r=a.p+"assets/img/image-20200112120036948.2c707b62.png",U=(0,t.Wm)("h1",{id:"virtual-dom"},[(0,t.Wm)("a",{class:"header-anchor",href:"#virtual-dom"},"#"),(0,t.Uk)(" Virtual DOM")],-1),d=(0,t.Wm)("h4",{id:"课程目标"},[(0,t.Wm)("a",{class:"header-anchor",href:"#课程目标"},"#"),(0,t.Uk)(" 课程目标")],-1),b=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"了解什么是虚拟 DOM，以及虚拟 DOM 的作用"),(0,t.Wm)("li",null,"Snabbdom 的基本使用"),(0,t.Wm)("li",null,[(0,t.Wm)("strong",null,"Snabbdom 的源码解析")])],-1),h=(0,t.Wm)("h3",{id:"什么是-virtual-dom"},[(0,t.Wm)("a",{class:"header-anchor",href:"#什么是-virtual-dom"},"#"),(0,t.Uk)(" 什么是 Virtual DOM")],-1),g=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Wm)("p",null,[(0,t.Wm)("strong",null,"Virtual DOM(虚拟 DOM)"),(0,t.Uk)("，是由普通的 JS 对象来描述 DOM 对象，因为不是真实的 DOM 对象，所以叫 Virtual DOM")])]),(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"真实 DOM 成员"),(0,t.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" element "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" document"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"querySelector"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'#app'"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" s "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"''"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"for"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"var"),(0,t.Uk)(" key "),(0,t.Wm)("span",{class:"token keyword"},"in"),(0,t.Uk)(" element"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  s "),(0,t.Wm)("span",{class:"token operator"},"+="),(0,t.Uk)(" key "),(0,t.Wm)("span",{class:"token operator"},"+"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"','"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\nconsole"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"log"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("s"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// 打印结果"),(0,t.Uk)("\nalign"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("title"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("lang"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("translate"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("dir"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("hidden"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("accessKey"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("draggable"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("spellcheck"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("autocapitalize"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("contentEditable"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("isContentEditable"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("inputMode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("offsetParent"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("offsetTop"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("offsetLeft"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("offsetWidth"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("offsetHeight"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("style"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("innerText"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("outerText"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("oncopy"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("oncut"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onpaste"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onabort"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onblur"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("oncancel"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("oncanplay"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("oncanplaythrough"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onchange"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onclick"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onclose"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("oncontextmenu"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("oncuechange"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("ondblclick"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("ondrag"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("ondragend"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("ondragenter"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("ondragleave"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("ondragover"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("ondragstart"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("ondrop"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("ondurationchange"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onemptied"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onended"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onerror"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onfocus"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("oninput"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("oninvalid"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onkeydown"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onkeypress"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onkeyup"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onload"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onloadeddata"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onloadedmetadata"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onloadstart"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onmousedown"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onmouseenter"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onmouseleave"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onmousemove"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onmouseout"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onmouseover"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onmouseup"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onmousewheel"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onpause"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onplay"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onplaying"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onprogress"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onratechange"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onreset"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onresize"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onscroll"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onseeked"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onseeking"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onselect"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onstalled"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onsubmit"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onsuspend"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("ontimeupdate"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("ontoggle"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onvolumechange"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onwaiting"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onwheel"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onauxclick"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("ongotpointercapture"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onlostpointercapture"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onpointerdown"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onpointermove"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onpointerup"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onpointercancel"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onpointerover"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onpointerout"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onpointerenter"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onpointerleave"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onselectstart"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onselectionchange"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onanimationend"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onanimationiteration"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onanimationstart"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("ontransitionend"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("dataset"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("nonce"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("autofocus"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("tabIndex"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("click"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("focus"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("blur"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("enterKeyHint"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onformdata"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onpointerrawupdate"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("attachInternals"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("namespaceURI"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("prefix"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("localName"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("tagName"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("id"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("className"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("classList"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("slot"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("part"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("attributes"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("shadowRoot"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("assignedSlot"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("innerHTML"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("outerHTML"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("scrollTop"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("scrollLeft"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("scrollWidth"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("scrollHeight"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("clientTop"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("clientLeft"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("clientWidth"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("clientHeight"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("attributeStyleMap"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onbeforecopy"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onbeforecut"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onbeforepaste"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onsearch"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("elementTiming"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("previousElementSibling"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("nextElementSibling"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("children"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("firstElementChild"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("lastElementChild"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("childElementCount"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onfullscreenchange"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onfullscreenerror"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onwebkitfullscreenchange"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("onwebkitfullscreenerror"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("setPointerCapture"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("releasePointerCapture"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("hasPointerCapture"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("hasAttributes"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("getAttributeNames"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("getAttribute"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("getAttributeNS"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("setAttribute"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("setAttributeNS"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("removeAttribute"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("removeAttributeNS"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("hasAttribute"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("hasAttributeNS"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("toggleAttribute"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("getAttributeNode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("getAttributeNodeNS"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("setAttributeNode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("setAttributeNodeNS"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("removeAttributeNode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("closest"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("matches"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("webkitMatchesSelector"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("attachShadow"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("getElementsByTagName"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("getElementsByTagNameNS"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("getElementsByClassName"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("insertAdjacentElement"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("insertAdjacentText"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("insertAdjacentHTML"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("requestPointerLock"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("getClientRects"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("getBoundingClientRect"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("scrollIntoView"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("scroll"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("scrollTo"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("scrollBy"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("scrollIntoViewIfNeeded"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("animate"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("computedStyleMap"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("before"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("after"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("replaceWith"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("remove"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("prepend"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("append"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("querySelector"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("querySelectorAll"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("requestFullscreen"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("webkitRequestFullScreen"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("webkitRequestFullscreen"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("createShadowRoot"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("getDestinationInsertionPoints"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Wm)("span",{class:"token constant"},"ELEMENT_NODE"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Wm)("span",{class:"token constant"},"ATTRIBUTE_NODE"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Wm)("span",{class:"token constant"},"TEXT_NODE"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Wm)("span",{class:"token constant"},"CDATA_SECTION_NODE"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Wm)("span",{class:"token constant"},"ENTITY_REFERENCE_NODE"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Wm)("span",{class:"token constant"},"ENTITY_NODE"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Wm)("span",{class:"token constant"},"PROCESSING_INSTRUCTION_NODE"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Wm)("span",{class:"token constant"},"COMMENT_NODE"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Wm)("span",{class:"token constant"},"DOCUMENT_NODE"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Wm)("span",{class:"token constant"},"DOCUMENT_TYPE_NODE"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Wm)("span",{class:"token constant"},"DOCUMENT_FRAGMENT_NODE"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Wm)("span",{class:"token constant"},"NOTATION_NODE"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Wm)("span",{class:"token constant"},"DOCUMENT_POSITION_DISCONNECTED"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Wm)("span",{class:"token constant"},"DOCUMENT_POSITION_PRECEDING"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Wm)("span",{class:"token constant"},"DOCUMENT_POSITION_FOLLOWING"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Wm)("span",{class:"token constant"},"DOCUMENT_POSITION_CONTAINS"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Wm)("span",{class:"token constant"},"DOCUMENT_POSITION_CONTAINED_BY"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Wm)("span",{class:"token constant"},"DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("nodeType"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("nodeName"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("baseURI"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("isConnected"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("ownerDocument"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("parentNode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("parentElement"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("childNodes"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("firstChild"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("lastChild"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("previousSibling"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("nextSibling"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("nodeValue"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("textContent"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("hasChildNodes"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("getRootNode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("normalize"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("cloneNode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("isEqualNode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("isSameNode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("compareDocumentPosition"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("contains"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("lookupPrefix"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("lookupNamespaceURI"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("isDefaultNamespace"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("insertBefore"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("appendChild"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("replaceChild"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("removeChild"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("addEventListener"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("removeEventListener"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("dispatchEvent\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br")])])]),(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"可以使用 Virtual DOM 来描述真实 DOM，示例"),(0,t.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  sel"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},'"div"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  data"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  children"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"undefined"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  text"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},'"Hello Virtual DOM"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  elm"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"undefined"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  key"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"undefined"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br")])])])],-1),f=(0,t.Wm)("h3",{id:"为什么使用-virtual-dom"},[(0,t.Wm)("a",{class:"header-anchor",href:"#为什么使用-virtual-dom"},"#"),(0,t.Uk)(" 为什么使用 Virtual DOM")],-1),w=(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"手动操作 DOM 比较麻烦，还需要考虑浏览器兼容性问题，虽然有 jQuery 等库简化 DOM 操作，但是随着项目的复杂 DOM 操作复杂提升")],-1),y=(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"为了简化 DOM 的复杂操作于是出现了各种 MVVM 框架，MVVM 框架解决了视图和状态的同步问题")],-1),v=(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"为了简化视图的操作我们可以使用模板引擎，但是模板引擎没有解决跟踪状态变化的问题，于是 Virtual DOM 出现了")],-1),V=(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"Virtual DOM 的好处是当状态改变时不需要立即更新 DOM，只需要创建一个虚拟树来描述 DOM， Virtual DOM 内部将弄清楚如何有效(diff)的更新 DOM")],-1),x=(0,t.Uk)("参考 github 上 "),N={href:"https://github.com/Matt-Esch/virtual-dom",target:"_blank",rel:"noopener noreferrer"},O=(0,t.Uk)("virtual-dom"),E=(0,t.Uk)(" 的描述"),D=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"虚拟 DOM 可以维护程序的状态，跟踪上一次的状态"),(0,t.Wm)("li",null,"通过比较前后两次状态的差异更新真实 DOM")],-1),M=(0,t.Wm)("h3",{id:"虚拟-dom-的作用"},[(0,t.Wm)("a",{class:"header-anchor",href:"#虚拟-dom-的作用"},"#"),(0,t.Uk)(" 虚拟 DOM 的作用")],-1),S=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"维护视图和状态的关系")]),(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"复杂视图情况下提升渲染性能")]),(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"除了渲染 DOM 以外，还可以实现 SSR(Nuxt.js/Next.js)、原生应用(Weex/React Native)、小程序(mpvue/uni-app)等"),(0,t.Wm)("p",null,[(0,t.Wm)("img",{src:e,alt:"image-20200102104642121"})])])],-1),I=(0,t.Wm)("h3",{id:"virtual-dom-库"},[(0,t.Wm)("a",{class:"header-anchor",href:"#virtual-dom-库"},"#"),(0,t.Uk)(" Virtual DOM 库")],-1),j={href:"https://github.com/snabbdom/snabbdom",target:"_blank",rel:"noopener noreferrer"},C=(0,t.Uk)("Snabbdom"),T=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"Vue 2.x 内部使用的 Virtual DOM 就是改造的 Snabbdom"),(0,t.Wm)("li",null,"大约 200 SLOC（single line of code）"),(0,t.Wm)("li",null,"通过模块可扩展"),(0,t.Wm)("li",null,"源码使用 TypeScript 开发"),(0,t.Wm)("li",null,"最快的 Virtual DOM 之一")],-1),A={href:"https://github.com/Matt-Esch/virtual-dom",target:"_blank",rel:"noopener noreferrer"},_=(0,t.Uk)("virtual-dom"),Q=(0,t.Wm)("h4",{id:"案例演示"},[(0,t.Wm)("a",{class:"header-anchor",href:"#案例演示"},"#"),(0,t.Uk)(" 案例演示")],-1),P={href:"https://codesandbox.io/s/jq-demo-5i7qp",target:"_blank",rel:"noopener noreferrer"},q=(0,t.Uk)("jQuery-demo"),R={href:"https://codesandbox.io/s/snabbdom-demo-4hbyb",target:"_blank",rel:"noopener noreferrer"},L=(0,t.Uk)("snabbdom-demo"),B=(0,t.Wm)("h2",{id:"snabbdom-基本使用"},[(0,t.Wm)("a",{class:"header-anchor",href:"#snabbdom-基本使用"},"#"),(0,t.Uk)(" Snabbdom 基本使用")],-1),H=(0,t.Wm)("h3",{id:"创建项目"},[(0,t.Wm)("a",{class:"header-anchor",href:"#创建项目"},"#"),(0,t.Uk)(" 创建项目")],-1),K=(0,t.Uk)("打包工具为了方便使用 "),F={href:"https://parceljs.org/getting_started.html",target:"_blank",rel:"noopener noreferrer"},Y=(0,t.Uk)("parcel"),G=(0,t.Uk)("创建项目，并安装 "),J={href:"https://parceljs.org/getting_started.html",target:"_blank",rel:"noopener noreferrer"},z=(0,t.Uk)("parcel"),$=(0,t.uE)('<div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 创建项目目录</span>\nmd snabbdom-demo\n<span class="token comment"># 进入项目目录</span>\n<span class="token builtin class-name">cd</span> snabbdom-demo\n<span class="token comment"># 创建 package.json</span>\n<span class="token function">npm</span> init -y\n<span class="token comment"># 本地安装 parcel</span>\n<span class="token function">npm</span> <span class="token function">install</span> parcel-bundler -D\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div>',1),X=(0,t.uE)('<li><p>配置 package.json 的 scripts</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n  <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;parcel index.html --open&quot;</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;parcel build index.html&quot;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li><li><p>创建目录结构</p><div class="language-txt ext-txt line-numbers-mode"><pre class="language-txt"><code>│  index.html\n│  package.json\n└─src\n     \t\t01-basicusage.js\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li>',2),Z=(0,t.Wm)("h3",{id:"导入-snabbdom"},[(0,t.Wm)("a",{class:"header-anchor",href:"#导入-snabbdom"},"#"),(0,t.Uk)(" 导入 Snabbdom")],-1),nn=(0,t.Wm)("h4",{id:"snabbdom-文档"},[(0,t.Wm)("a",{class:"header-anchor",href:"#snabbdom-文档"},"#"),(0,t.Uk)(" Snabbdom 文档")],-1),sn=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"看文档的意义"),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"学习任何一个库都要先看文档"),(0,t.Wm)("li",null,"通过文档了解库的作用"),(0,t.Wm)("li",null,"看文档中提供的示例，自己快速实现一个 demo"),(0,t.Wm)("li",null,"通过文档查看 API 的使用")])]),(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"文档地址"),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"https://github.com/snabbdom/snabbdom"),(0,t.Wm)("li",null,"当前版本 v2.1.0")]),(0,t.Wm)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-bash"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token comment"},"# --depth 表示克隆深度, 1 表示只克隆最新的版本. 因为如果项目迭代的版本很多, 克隆会很慢"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token function"},"git"),(0,t.Uk)(" clone -b v2.1.0 --depth"),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Wm)("span",{class:"token number"},"1"),(0,t.Uk)(" https://github.com/snabbdom/snabbdom.git\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br")])])])],-1),an=(0,t.Wm)("h4",{id:"安装-snabbdom"},[(0,t.Wm)("a",{class:"header-anchor",href:"#安装-snabbdom"},"#"),(0,t.Uk)(" 安装 Snabbdom")],-1),tn=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"安装 Snabbdom"),(0,t.Wm)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-bash"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token function"},"npm"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"install"),(0,t.Uk)(" snabbdom@2.1.0\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br")])])])],-1),en=(0,t.Wm)("h4",{id:"导入-snabbdom-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#导入-snabbdom-1"},"#"),(0,t.Uk)(" 导入 Snabbdom")],-1),on=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Uk)("Snabbdom 的两个核心函数 init 和 h() "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"init() 是一个高阶函数，返回 patch()"),(0,t.Wm)("li",null,"h() 返回虚拟节点 VNode，这个函数我们在使用 Vue.js 的时候见过")])])],-1),pn=(0,t.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"import"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" init "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"from"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'snabbdom/init'"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"import"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" h "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"from"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'snabbdom/h'"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" patch "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"init"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br")])],-1),ln=(0,t.Wm)("blockquote",null,[(0,t.Wm)("p",null,"注意：此时运行的话会告诉我们找不到 init / h 模块，因为模块路径并不是 snabbdom/int，这个路径是在 package.json 中的 exports 字段设置的，而我们使用的打包工具不支持 exports 这个字段，webpack 4 也不支持，webpack 5 支持该字段。该字段在导入 snabbdom/init 的时候会补全路径成 snabbdom/build/package/init.js")],-1),cn=(0,t.Wm)("div",{class:"language-text ext-text line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-text"},[(0,t.Wm)("code",null,'"exports": {\n    "./init": "./build/package/init.js",\n    "./h": "./build/package/h.js",\n    "./helpers/attachto": "./build/package/helpers/attachto.js",\n    "./hooks": "./build/package/hooks.js",\n    "./htmldomapi": "./build/package/htmldomapi.js",\n    "./is": "./build/package/is.js",\n    "./jsx": "./build/package/jsx.js",\n    "./modules/attributes": "./build/package/modules/attributes.js",\n    "./modules/class": "./build/package/modules/class.js",\n    "./modules/dataset": "./build/package/modules/dataset.js",\n    "./modules/eventlisteners": "./build/package/modules/eventlisteners.js",\n    "./modules/hero": "./build/package/modules/hero.js",\n    "./modules/module": "./build/package/modules/module.js",\n    "./modules/props": "./build/package/modules/props.js",\n    "./modules/style": "./build/package/modules/style.js",\n    "./thunk": "./build/package/thunk.js",\n    "./tovnode": "./build/package/tovnode.js",\n    "./vnode": "./build/package/vnode.js"\n  }\n')]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"9"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"10"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"11"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"12"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"13"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"14"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"15"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"16"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"17"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"18"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"19"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"20"),(0,t.Wm)("br")])],-1),mn=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Uk)("如果使用不支持 package.json 的 exports 字段的打包工具，我们应该把模块的路径写全 "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"查看安装的 snabbdom 的目录结构")])])],-1),un=(0,t.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"import"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" h "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"from"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'snabbdom/build/package/h'"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"import"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" init "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"from"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'snabbdom/build/package/init'"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"import"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" classModule "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"from"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'snabbdom/build/package/modules/class'"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br")])],-1),kn=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"回顾 Vue 中的 render 函数")],-1),Wn=(0,t.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Vue"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  router"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  store"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function-variable function"},"render"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token parameter"},"h"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"h"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("App"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"$mount"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'#app'"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br")])],-1),rn=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"thunk() 是一种优化策略，可以在处理不可变数据时使用")],-1),Un=(0,t.Wm)("h3",{id:"代码演示"},[(0,t.Wm)("a",{class:"header-anchor",href:"#代码演示"},"#"),(0,t.Uk)(" 代码演示")],-1),dn=(0,t.Wm)("h4",{id:"基本使用"},[(0,t.Wm)("a",{class:"header-anchor",href:"#基本使用"},"#"),(0,t.Uk)(" 基本使用")],-1),bn=(0,t.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"import"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" h "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"from"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'snabbdom/build/package/h'"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"import"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" init "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"from"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'snabbdom/build/package/init'"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token comment"},"// 使用 init() 函数创建 patch()"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// init() 的参数是数组，将来可以传入模块，处理属性/样式/事件等"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" patch "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"init"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token comment"},"// 使用 h() 函数创建 vnode"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" vnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"h"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'div.cls'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"h"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'h1'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'Hello Snabbdom'"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"h"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'p'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'这是段落'"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" app "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" document"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"querySelector"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'#app'"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// 把 vnode 渲染到空的 DOM 元素（替换）"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// 会返回新的 vnode"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" oldVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"patch"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("app"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token function"},"setTimeout"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  vnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"h"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'div.cls'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token function"},"h"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'h1'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'Hello World'"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token function"},"h"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'p'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'这是段落'"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 把老的视图更新到新的状态"),(0,t.Uk)("\n  oldVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"patch"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// h('!') 是创建注释"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"patch"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"h"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'!'"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"2000"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"9"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"10"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"11"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"12"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"13"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"14"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"15"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"16"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"17"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"18"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"19"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"20"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"21"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"22"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"23"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"24"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"25"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"26"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"27"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"28"),(0,t.Wm)("br")])],-1),hn=(0,t.Wm)("h4",{id:"模块"},[(0,t.Wm)("a",{class:"header-anchor",href:"#模块"},"#"),(0,t.Uk)(" 模块")],-1),gn=(0,t.Wm)("p",null,"Snabbdom 的核心库并不能处理 DOM 元素的属性/样式/事件等，如果需要处理的话，可以使用模块",-1),fn=(0,t.Wm)("h4",{id:"常用模块"},[(0,t.Wm)("a",{class:"header-anchor",href:"#常用模块"},"#"),(0,t.Uk)(" 常用模块")],-1),wn=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"官方提供了 6 个模块"),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Uk)("attributes "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Uk)("设置 DOM 元素的属性，使用 "),(0,t.Wm)("code",null,"setAttribute"),(0,t.Uk)("()")]),(0,t.Wm)("li",null,"处理布尔类型的属性")])]),(0,t.Wm)("li",null,[(0,t.Uk)("props "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Uk)("和 "),(0,t.Wm)("code",null,"attributes"),(0,t.Uk)(" 模块相似，设置 DOM 元素的属性 "),(0,t.Wm)("code",null,"element[attr] = value")]),(0,t.Wm)("li",null,"不处理布尔类型的属性")])]),(0,t.Wm)("li",null,[(0,t.Uk)("class "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"切换类样式"),(0,t.Wm)("li",null,[(0,t.Uk)("注意：给元素设置类样式是通过 "),(0,t.Wm)("code",null,"sel"),(0,t.Uk)(" 选择器")])])]),(0,t.Wm)("li",null,[(0,t.Uk)("dataset "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Uk)("设置 "),(0,t.Wm)("code",null,"data-*"),(0,t.Uk)(" 的自定义属性")])])]),(0,t.Wm)("li",null,[(0,t.Uk)("eventlisteners "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"注册和移除事件")])]),(0,t.Wm)("li",null,[(0,t.Uk)("style "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"设置行内样式，支持动画"),(0,t.Wm)("li",null,"delayed/remove/destroy")])])])])],-1),yn=(0,t.Wm)("h4",{id:"模块使用"},[(0,t.Wm)("a",{class:"header-anchor",href:"#模块使用"},"#"),(0,t.Uk)(" 模块使用")],-1),vn=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Uk)("模块使用步骤： "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"导入需要的模块"),(0,t.Wm)("li",null,"init() 中注册模块"),(0,t.Wm)("li",null,"使用 h() 函数创建 VNode 的时候，可以把第二个参数设置为对象，其他参数往后移")])])],-1),Vn=(0,t.Wm)("h4",{id:"代码演示-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#代码演示-1"},"#"),(0,t.Uk)(" 代码演示")],-1),xn=(0,t.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"import"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" h "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"from"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'snabbdom/build/package/h'"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"import"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" init "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"from"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'snabbdom/build/package/init'"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// 导入需要的模块"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"import"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" styleModule "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"from"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'snabbdom/build/package/modules/style'"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"import"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" eventListenersModule "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"from"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'snabbdom/build/package/modules/eventlisteners'"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token comment"},"// 使用 init() 函数创建 patch()"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// init() 的参数是数组，将来可以传入模块，处理属性/样式/事件等"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" patch "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"init"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 注册模块"),(0,t.Uk)("\n  styleModule"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  eventListenersModule\n"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token comment"},"// 使用 h() 函数创建 vnode"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" vnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"h"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'div.cls'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 设置 DOM 元素的行内样式"),(0,t.Uk)("\n  style"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" color"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'#DEDEDE'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" backgroundColor"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'#181A1B'"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 注册事件"),(0,t.Uk)("\n  on"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" click"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" clickHandler "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"h"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'h1'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'Hello Snabbdom'"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"h"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'p'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'这是段落'"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"clickHandler"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 此处的 this 指向对应的 vnode"),(0,t.Uk)("\n  console"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"log"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("innerHTML"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"9"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"10"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"11"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"12"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"13"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"14"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"15"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"16"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"17"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"18"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"19"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"20"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"21"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"22"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"23"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"24"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"25"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"26"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"27"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"28"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"29"),(0,t.Wm)("br")])],-1),Nn=(0,t.Wm)("h2",{id:"snabbdom-源码解析"},[(0,t.Wm)("a",{class:"header-anchor",href:"#snabbdom-源码解析"},"#"),(0,t.Uk)(" Snabbdom 源码解析")],-1),On=(0,t.Wm)("h3",{id:"如何学习源码"},[(0,t.Wm)("a",{class:"header-anchor",href:"#如何学习源码"},"#"),(0,t.Uk)(" 如何学习源码")],-1),En=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"先宏观了解"),(0,t.Wm)("li",null,"带着目标看源码"),(0,t.Wm)("li",null,"看源码的过程要不求甚解"),(0,t.Wm)("li",null,"调试"),(0,t.Wm)("li",null,"参考资料")],-1),Dn=(0,t.Wm)("h3",{id:"snabbdom-的核心"},[(0,t.Wm)("a",{class:"header-anchor",href:"#snabbdom-的核心"},"#"),(0,t.Uk)(" Snabbdom 的核心")],-1),Mn=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"使用 h() 函数创建 JavaScript 对象(VNode)描述真实 DOM"),(0,t.Wm)("li",null,"init() 设置模块，创建 patch()"),(0,t.Wm)("li",null,"patch() 比较新旧两个 VNode"),(0,t.Wm)("li",null,"把变化的内容更新到真实 DOM 树上")],-1),Sn=(0,t.Wm)("h3",{id:"snabbdom-源码"},[(0,t.Wm)("a",{class:"header-anchor",href:"#snabbdom-源码"},"#"),(0,t.Uk)(" Snabbdom 源码")],-1),In=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"源码地址："),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"https://github.com/snabbdom/snabbdom")])]),(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"src 目录结构"),(0,t.Wm)("div",{class:"language-text ext-text line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-text"},[(0,t.Wm)("code",null,"├── package\n│   ├── helpers\n│   │   └── attachto.ts\t\t定义了 vnode.ts 中 AttachData 的数据结构\n│   ├── modules\n│   │   ├── attributes.ts\n│   │   ├── class.ts\n│   │   ├── dataset.ts\n│   │   ├── eventlisteners.ts\n│   │   ├── hero.ts\t\t\t\texample 中使用到的自定义钩子\n│   │   ├── module.ts\t\t\t定义了模块中用到的钩子函数\n│   │   ├── props.ts\n│   │   └── style.ts\n│   ├── h.ts\t\t\t\t\t\t\th() 函数，用来创建 VNode\n│   ├── hooks.ts\t\t\t\t\t所有钩子函数的定义\n│   ├── htmldomapi.ts\t\t\t对 DOM API 的包装\n│   ├── init.ts\t\t\t\t\t\t加载 modules、DOMAPI，返回 patch 函数\n│   ├── is.ts\t\t\t\t\t\t\t判断数组和原始值的函数\n│   ├── jsx-global.ts\t\t\tjsx 的类型声明文件\n│   ├── jsx.ts\t\t\t\t\t\t处理 jsx\n│   ├── thunk.ts\t\t\t\t\t优化处理，对复杂视图不可变值得优化\n│   ├── tovnode.ts\t\t\t\tDOM 转换成 VNode\n│   ├── ts-transform-js-extension.cjs\n│   ├── tsconfig.json\t\t\tts 的编译配置文件\n│   └── vnode.ts\t\t\t\t\t虚拟节点定义\n")]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"9"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"10"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"11"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"12"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"13"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"14"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"15"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"16"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"17"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"18"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"19"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"20"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"21"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"22"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"23"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"24"),(0,t.Wm)("br")])])])],-1),jn=(0,t.Wm)("h3",{id:"h-函数"},[(0,t.Wm)("a",{class:"header-anchor",href:"#h-函数"},"#"),(0,t.Uk)(" h 函数")],-1),Cn=(0,t.Wm)("p",null,"h() 函数介绍",-1),Tn=(0,t.uE)('<li><p>在使用 Vue 的时候见过 h() 函数</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  router<span class="token punctuation">,</span>\n  store<span class="token punctuation">,</span>\n  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">&#39;#app&#39;</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li>',1),An=(0,t.Uk)("h() 函数最早见于 "),_n={href:"https://github.com/hyperhype/hyperscript",target:"_blank",rel:"noopener noreferrer"},Qn=(0,t.Uk)("hyperscript"),Pn=(0,t.Uk)("，使用 JavaScript 创建超文本"),qn=(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"Snabbdom 中的 h() 函数不是用来创建超文本，而是创建 VNode")],-1),Rn=(0,t.uE)('<li><p>函数重载</p><ul><li><p>概念</p><ul><li><strong>参数个数</strong>或<strong>类型</strong>不同的函数</li><li>JavaScript 中没有重载的概念</li><li>TypeScript 中有重载，不过重载的实现还是通过代码调整参数</li></ul></li><li><p>重载的示意</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token operator">:</span> number<span class="token punctuation">,</span> b<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">function</span> <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token operator">:</span> number<span class="token punctuation">,</span> b<span class="token operator">:</span> number<span class="token punctuation">,</span> c<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b <span class="token operator">+</span> c<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>\n<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token operator">:</span> number<span class="token punctuation">,</span> b<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">function</span> <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token operator">:</span> number<span class="token punctuation">,</span> b<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>\n<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;2&#39;</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ul></li><li><p>源码位置：src/package/h.ts</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// h 函数的重载</span>\n<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">h</span> <span class="token punctuation">(</span><span class="token parameter">sel<span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token operator">:</span> VNode\n<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">h</span> <span class="token punctuation">(</span><span class="token parameter">sel<span class="token operator">:</span> string<span class="token punctuation">,</span> data<span class="token operator">:</span> VNodeData <span class="token operator">|</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span><span class="token operator">:</span> VNode\n<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">h</span> <span class="token punctuation">(</span><span class="token parameter">sel<span class="token operator">:</span> string<span class="token punctuation">,</span> children<span class="token operator">:</span> VNodeChildren</span><span class="token punctuation">)</span><span class="token operator">:</span> VNode\n<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">h</span> <span class="token punctuation">(</span><span class="token parameter">sel<span class="token operator">:</span> string<span class="token punctuation">,</span> data<span class="token operator">:</span> VNodeData <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span> children<span class="token operator">:</span> VNodeChildren</span><span class="token punctuation">)</span><span class="token operator">:</span> VNode\n<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">h</span> <span class="token punctuation">(</span><span class="token parameter">sel<span class="token operator">:</span> any<span class="token punctuation">,</span> b<span class="token operator">?</span><span class="token operator">:</span> any<span class="token punctuation">,</span> c<span class="token operator">?</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span><span class="token operator">:</span> VNode <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> data<span class="token operator">:</span> VNodeData <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n  <span class="token keyword">var</span> children<span class="token operator">:</span> any\n  <span class="token keyword">var</span> text<span class="token operator">:</span> any\n  <span class="token keyword">var</span> i<span class="token operator">:</span> number\n  <span class="token comment">// 处理参数，实现重载的机制</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 处理三个参数的情况</span>\n    <span class="token comment">// sel、data、children/text</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      data <span class="token operator">=</span> b\n    <span class="token punctuation">}</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      children <span class="token operator">=</span> c\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">primitive</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      text <span class="token operator">=</span> c\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">&amp;&amp;</span> c<span class="token punctuation">.</span>sel<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      children <span class="token operator">=</span> <span class="token punctuation">[</span>c<span class="token punctuation">]</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> b <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      children <span class="token operator">=</span> b\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">primitive</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 如果 c 是字符串或者数字</span>\n      text <span class="token operator">=</span> b\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">.</span>sel<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 如果 b 是 VNode</span>\n      children <span class="token operator">=</span> <span class="token punctuation">[</span>b<span class="token punctuation">]</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> data <span class="token operator">=</span> b <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>children <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 处理 children 中的原始值(string/number)</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 如果 child 是 string/number，创建文本节点</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">primitive</span><span class="token punctuation">(</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> children<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">vnode</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>\n    sel<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&#39;s&#39;</span> <span class="token operator">&amp;&amp;</span> sel<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&#39;v&#39;</span> <span class="token operator">&amp;&amp;</span> sel<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&#39;g&#39;</span> <span class="token operator">&amp;&amp;</span>\n    <span class="token punctuation">(</span>sel<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">3</span> <span class="token operator">||</span> sel<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&#39;.&#39;</span> <span class="token operator">||</span> sel<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&#39;#&#39;</span><span class="token punctuation">)</span>\n  <span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 如果是 svg，添加命名空间</span>\n    <span class="token function">addNS</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> sel<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// 返回 VNode</span>\n  <span class="token keyword">return</span> <span class="token function">vnode</span><span class="token punctuation">(</span>sel<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> text<span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div></li>',2),Ln=(0,t.Wm)("h3",{id:"vnode"},[(0,t.Wm)("a",{class:"header-anchor",href:"#vnode"},"#"),(0,t.Uk)(" VNode")],-1),Bn=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"一个 VNode 就是一个虚拟节点用来描述一个 DOM 元素，如果这个 VNode 有 children 就是 Virtual DOM")]),(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"源码位置：src/package/vnode.ts")])],-1),Hn=(0,t.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"export"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"interface"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"VNode"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 选择器"),(0,t.Uk)("\n  sel"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" string "),(0,t.Wm)("span",{class:"token operator"},"|"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"undefined"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 节点数据：属性/样式/事件等"),(0,t.Uk)("\n  data"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" VNodeData "),(0,t.Wm)("span",{class:"token operator"},"|"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"undefined"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 子节点，和 text 只能互斥"),(0,t.Uk)("\n  children"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" Array"),(0,t.Wm)("span",{class:"token operator"},"<"),(0,t.Uk)("VNode "),(0,t.Wm)("span",{class:"token operator"},"|"),(0,t.Uk)(" string"),(0,t.Wm)("span",{class:"token operator"},">"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"|"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"undefined"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 记录 vnode 对应的真实 DOM"),(0,t.Uk)("\n  elm"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" Node "),(0,t.Wm)("span",{class:"token operator"},"|"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"undefined"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 节点中的内容，和 children 只能互斥"),(0,t.Uk)("\n  text"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" string "),(0,t.Wm)("span",{class:"token operator"},"|"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"undefined"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 优化用"),(0,t.Uk)("\n  key"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" Key "),(0,t.Wm)("span",{class:"token operator"},"|"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"undefined"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token keyword"},"export"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"vnode"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("sel"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" string "),(0,t.Wm)("span",{class:"token operator"},"|"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"undefined"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n                      data"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" any "),(0,t.Wm)("span",{class:"token operator"},"|"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"undefined"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n                      children"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" Array"),(0,t.Wm)("span",{class:"token operator"},"<"),(0,t.Uk)("VNode "),(0,t.Wm)("span",{class:"token operator"},"|"),(0,t.Uk)(" string"),(0,t.Wm)("span",{class:"token operator"},">"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"|"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"undefined"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n                      text"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" string "),(0,t.Wm)("span",{class:"token operator"},"|"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"undefined"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n                      elm"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" Element "),(0,t.Wm)("span",{class:"token operator"},"|"),(0,t.Uk)(" Text "),(0,t.Wm)("span",{class:"token operator"},"|"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"undefined")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" VNode "),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" key "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" data "),(0,t.Wm)("span",{class:"token operator"},"==="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"undefined"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"?"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"undefined"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" data"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("key\n  "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" sel"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" data"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" children"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" text"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" elm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"9"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"10"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"11"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"12"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"13"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"14"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"15"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"16"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"17"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"18"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"19"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"20"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"21"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"22"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"23"),(0,t.Wm)("br")])],-1),Kn=(0,t.Wm)("h3",{id:"snabbdom"},[(0,t.Wm)("a",{class:"header-anchor",href:"#snabbdom"},"#"),(0,t.Uk)(" snabbdom")],-1),Fn=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"patch(oldVnode, newVnode)"),(0,t.Wm)("li",null,"打补丁，把新节点中变化的内容渲染到真实 DOM，最后返回新节点作为下一次处理的旧节点"),(0,t.Wm)("li",null,"对比新旧 VNode 是否相同节点(节点的 key 和 sel 相同)"),(0,t.Wm)("li",null,"如果不是相同节点，删除之前的内容，重新渲染"),(0,t.Wm)("li",null,"如果是相同节点，再判断新的 VNode 是否有 text，如果有并且和 oldVnode 的 text 不同，直接更新文本内容"),(0,t.Wm)("li",null,"如果新的 VNode 有 children，判断子节点是否有变化，判断子节点的过程使用的就是 diff 算法"),(0,t.Wm)("li",null,"diff 过程只进行同层级比较")],-1),Yn=(0,t.Wm)("p",null,[(0,t.Wm)("img",{src:o,alt:"image-20200102103653779"})],-1),Gn=(0,t.Wm)("h3",{id:"init"},[(0,t.Wm)("a",{class:"header-anchor",href:"#init"},"#"),(0,t.Uk)(" init")],-1),Jn=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"**功能：**init(modules, domApi)，返回 patch() 函数（高阶函数）")]),(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"为什么要使用高阶函数？"),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"因为 patch() 函数再外部会调用多次，每次调用依赖一些参数，比如：modules/domApi/cbs"),(0,t.Wm)("li",null,"通过高阶函数让 init() 内部形成闭包，返回的 patch() 可以访问到 modules/domApi/cbs，而不需要重新创建")])]),(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"init() 在返回 patch() 之前，首先收集了所有模块中的钩子函数存储到 cbs 对象中")]),(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"源码位置：src/package/init.ts"),(0,t.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" hooks"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" Array"),(0,t.Wm)("span",{class:"token operator"},"<"),(0,t.Uk)("keyof Module"),(0,t.Wm)("span",{class:"token operator"},">"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token string"},"'create'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'update'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'remove'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'destroy'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'pre'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'post'"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"export"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"init"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("modules"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" Array"),(0,t.Wm)("span",{class:"token operator"},"<"),(0,t.Uk)("Partial"),(0,t.Wm)("span",{class:"token operator"},"<"),(0,t.Uk)("Module"),(0,t.Wm)("span",{class:"token operator"},">>"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" domApi"),(0,t.Wm)("span",{class:"token operator"},"?"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token constant"},"DOMAPI")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" i"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" number\n  "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" j"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" number\n  "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" cbs"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" ModuleHooks "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    create"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n    update"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n    remove"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n    destroy"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n    pre"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n    post"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 初始化 api"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" api"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token constant"},"DOMAPI"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" domApi "),(0,t.Wm)("span",{class:"token operator"},"!=="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"undefined"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"?"),(0,t.Uk)(" domApi "),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" htmlDomApi\n  "),(0,t.Wm)("span",{class:"token comment"},"// 把传入的所有模块的钩子方法，统一存储到 cbs 对象中"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 最终构建的 cbs 对象的形式 cbs = [ create: [fn1, fn2], update: [], ... ]"),(0,t.Uk)("\n\t"),(0,t.Wm)("span",{class:"token keyword"},"for"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("i "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(" i "),(0,t.Wm)("span",{class:"token operator"},"<"),(0,t.Uk)(" hooks"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("length"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Uk)("i"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// cbs['create'] = []"),(0,t.Uk)("\n    cbs"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("hooks"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("i"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"for"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("j "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(" j "),(0,t.Wm)("span",{class:"token operator"},"<"),(0,t.Uk)(" modules"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("length"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Uk)("j"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// const hook = modules[0]['create']"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" hook "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" modules"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("j"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("hooks"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("i"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("hook "),(0,t.Wm)("span",{class:"token operator"},"!=="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"undefined"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("cbs"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("hooks"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("i"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"as"),(0,t.Uk)(" any"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"push"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("hook"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  ……\n  "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"patch"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("oldVnode"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" VNode "),(0,t.Wm)("span",{class:"token operator"},"|"),(0,t.Uk)(" Element"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" VNode")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" VNode "),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    ……\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"9"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"10"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"11"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"12"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"13"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"14"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"15"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"16"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"17"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"18"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"19"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"20"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"21"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"22"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"23"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"24"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"25"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"26"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"27"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"28"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"29"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"30"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"31"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"32"),(0,t.Wm)("br")])])])],-1),zn=(0,t.Wm)("h3",{id:"patch"},[(0,t.Wm)("a",{class:"header-anchor",href:"#patch"},"#"),(0,t.Uk)(" patch")],-1),$n=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Wm)("p",null,[(0,t.Wm)("strong",null,"功能：")]),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"传入新旧 VNode，对比差异，把差异渲染到 DOM"),(0,t.Wm)("li",null,"返回新的 VNode，作为下一次 patch() 的 oldVnode")])]),(0,t.Wm)("li",null,[(0,t.Wm)("p",null,[(0,t.Wm)("strong",null,"执行过程：")]),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Uk)("首先执行"),(0,t.Wm)("strong",null,"模块"),(0,t.Uk)("中的"),(0,t.Wm)("strong",null,"钩子"),(0,t.Uk)("函数 "),(0,t.Wm)("code",null,"pre")]),(0,t.Wm)("li",null,[(0,t.Uk)("如果 oldVnode 和 vnode 相同（key 和 sel 相同） "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"调用 patchVnode()，找节点的差异并更新 DOM")])]),(0,t.Wm)("li",null,[(0,t.Uk)("如果 oldVnode 是 DOM 元素 "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"把 DOM 元素转换成 oldVnode"),(0,t.Wm)("li",null,"调用 createElm() 把 vnode 转换为真实 DOM，记录到 vnode.elm"),(0,t.Wm)("li",null,"把刚创建的 DOM 元素插入到 parent 中"),(0,t.Wm)("li",null,"移除老节点"),(0,t.Wm)("li",null,[(0,t.Uk)("触发"),(0,t.Wm)("strong",null,"用户"),(0,t.Uk)("设置的 "),(0,t.Wm)("code",null,"create "),(0,t.Uk)(),(0,t.Wm)("strong",null,"钩子"),(0,t.Uk)("函数")])])])])]),(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"源码位置：src/package/init.ts"),(0,t.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"patch"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("oldVnode"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" VNode "),(0,t.Wm)("span",{class:"token operator"},"|"),(0,t.Uk)(" Element"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" VNode")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" VNode "),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" i"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" number"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" elm"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" Node"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" parent"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" Node\n  "),(0,t.Wm)("span",{class:"token comment"},"// 保存新插入节点的队列，为了触发钩子函数"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" insertedVnodeQueue"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" VNodeQueue "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 执行模块的 pre 钩子函数"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"for"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("i "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(" i "),(0,t.Wm)("span",{class:"token operator"},"<"),(0,t.Uk)(" cbs"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("pre"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("length"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Uk)("i"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(" cbs"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("pre"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("i"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n\t"),(0,t.Wm)("span",{class:"token comment"},"// 如果 oldVnode 不是 VNode，创建 VNode 并设置 elm "),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Wm)("span",{class:"token function"},"isVnode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 把 DOM 元素转换成空的 VNode"),(0,t.Uk)("\n    oldVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"emptyNodeAt"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\t"),(0,t.Wm)("span",{class:"token comment"},"// 如果新旧节点是相同节点(key 和 sel 相同)"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"sameVnode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 找节点的差异并更新 DOM"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token function"},"patchVnode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" insertedVnodeQueue"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 如果新旧节点不同，vnode 创建对应的 DOM"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 获取当前的 DOM 元素"),(0,t.Uk)("\n    elm "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Uk)("\n    parent "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" api"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"parentNode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"as"),(0,t.Uk)(" Node\n\t\t"),(0,t.Wm)("span",{class:"token comment"},"// 触发 init/create 钩子函数,创建 DOM"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token function"},"createElm"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("vnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" insertedVnodeQueue"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("parent "),(0,t.Wm)("span",{class:"token operator"},"!=="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"null"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 如果父节点不为空，把 vnode 对应的 DOM 插入到文档中"),(0,t.Uk)("\n      api"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"insertBefore"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("parent"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" api"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"nextSibling"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 移除老节点"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token function"},"removeVnodes"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("parent"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\t"),(0,t.Wm)("span",{class:"token comment"},"// 执行用户设置的 insert 钩子函数"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"for"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("i "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(" i "),(0,t.Wm)("span",{class:"token operator"},"<"),(0,t.Uk)(" insertedVnodeQueue"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("length"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Uk)("i"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    insertedVnodeQueue"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("i"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("data"),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("hook"),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("insert"),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("insertedVnodeQueue"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("i"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 执行模块的 post 钩子函数"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"for"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("i "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(" i "),(0,t.Wm)("span",{class:"token operator"},"<"),(0,t.Uk)(" cbs"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("post"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("length"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Uk)("i"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(" cbs"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("post"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("i"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" vnode\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"9"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"10"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"11"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"12"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"13"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"14"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"15"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"16"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"17"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"18"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"19"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"20"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"21"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"22"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"23"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"24"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"25"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"26"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"27"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"28"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"29"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"30"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"31"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"32"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"33"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"34"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"35"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"36"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"37"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"38"),(0,t.Wm)("br")])])])],-1),Xn=(0,t.Wm)("h3",{id:"createelm"},[(0,t.Wm)("a",{class:"header-anchor",href:"#createelm"},"#"),(0,t.Uk)(" createElm")],-1),Zn=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Wm)("p",null,[(0,t.Wm)("strong",null,"功能：")]),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"createElm(vnode, insertedVnodeQueue)，返回创建的 DOM 元素"),(0,t.Wm)("li",null,"创建 vnode 对应的 DOM 元素")])]),(0,t.Wm)("li",null,[(0,t.Wm)("p",null,[(0,t.Wm)("strong",null,"执行过程：")]),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Uk)("首先触发"),(0,t.Wm)("strong",null,"用户"),(0,t.Uk)("设置的 "),(0,t.Wm)("strong",null,"init"),(0,t.Uk)(),(0,t.Wm)("strong",null,"钩子"),(0,t.Uk)("函数")]),(0,t.Wm)("li",null,"如果选择器是!，创建评论节点"),(0,t.Wm)("li",null,"如果选择器为空，创建文本节点"),(0,t.Wm)("li",null,[(0,t.Uk)("如果选择器不为空 "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"解析选择器，设置标签的 id 和 class 属性"),(0,t.Wm)("li",null,[(0,t.Uk)("执行"),(0,t.Wm)("strong",null,"模块"),(0,t.Uk)("的 "),(0,t.Wm)("strong",null,"create"),(0,t.Uk)(),(0,t.Wm)("strong",null,"钩子"),(0,t.Uk)("函数")]),(0,t.Wm)("li",null,"如果 vnode 有 children，创建子 vnode 对应的 DOM，追加到 DOM 树"),(0,t.Wm)("li",null,"如果 vnode 的 text 值是 string/number，创建文本节点并追击到 DOM 树"),(0,t.Wm)("li",null,[(0,t.Uk)("执行"),(0,t.Wm)("strong",null,"用户"),(0,t.Uk)("设置的 "),(0,t.Wm)("strong",null,"create"),(0,t.Uk)(),(0,t.Wm)("strong",null,"钩子"),(0,t.Uk)("函数")]),(0,t.Wm)("li",null,"如果有用户设置的 insert 钩子函数，把 vnode 添加到队列中")])])])]),(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"源码位置：src/package/init.ts"),(0,t.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Uk)("  "),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"createElm"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("vnode"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" VNode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" insertedVnodeQueue"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" VNodeQueue")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" Node "),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" i"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" any\n    "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" data "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("data\n    \n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("data "),(0,t.Wm)("span",{class:"token operator"},"!=="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"undefined"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 执行用户设置的 init 钩子函数"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" init "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" data"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("hook"),(0,t.Wm)("span",{class:"token operator"},"?."),(0,t.Uk)("init\n      "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"isDef"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("init"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token function"},"init"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("vnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n        data "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("data\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" children "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("children\n    "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" sel "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("sel\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("sel "),(0,t.Wm)("span",{class:"token operator"},"==="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'!'"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 如果选择器是!，创建注释节点"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"isUndef"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("text"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("text "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"''"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n      vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" api"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"createComment"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("text"),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("sel "),(0,t.Wm)("span",{class:"token operator"},"!=="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"undefined"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 如果选择器不为空"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 解析选择器"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// Parse selector"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" hashIdx "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" sel"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"indexOf"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'#'"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" dotIdx "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" sel"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"indexOf"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'.'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" hashIdx"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" hash "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" hashIdx "),(0,t.Wm)("span",{class:"token operator"},">"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"?"),(0,t.Uk)(" hashIdx "),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" sel"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("length\n      "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" dot "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" dotIdx "),(0,t.Wm)("span",{class:"token operator"},">"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"?"),(0,t.Uk)(" dotIdx "),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" sel"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("length\n      "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" tag "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" hashIdx "),(0,t.Wm)("span",{class:"token operator"},"!=="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"-"),(0,t.Wm)("span",{class:"token number"},"1"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"||"),(0,t.Uk)(" dotIdx "),(0,t.Wm)("span",{class:"token operator"},"!=="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"-"),(0,t.Wm)("span",{class:"token number"},"1"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"?"),(0,t.Uk)(" sel"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"slice"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" Math"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"min"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("hash"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" dot"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" sel\n      "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" elm "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"isDef"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("data"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"&&"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"isDef"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("i "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" data"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("ns"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token operator"},"?"),(0,t.Uk)(" api"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"createElementNS"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("i"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" tag"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" api"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"createElement"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("tag"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("hash "),(0,t.Wm)("span",{class:"token operator"},"<"),(0,t.Uk)(" dot"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(" elm"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"setAttribute"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'id'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" sel"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"slice"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("hash "),(0,t.Wm)("span",{class:"token operator"},"+"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"1"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" dot"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("dotIdx "),(0,t.Wm)("span",{class:"token operator"},">"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(" elm"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"setAttribute"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'class'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" sel"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"slice"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("dot "),(0,t.Wm)("span",{class:"token operator"},"+"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"1"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"replace"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token regex"},[(0,t.Wm)("span",{class:"token regex-delimiter"},"/"),(0,t.Wm)("span",{class:"token regex-source language-regex"},"\\."),(0,t.Wm)("span",{class:"token regex-delimiter"},"/"),(0,t.Wm)("span",{class:"token regex-flags"},"g")]),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"' '"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 执行模块的 create 钩子函数"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"for"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("i "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(" i "),(0,t.Wm)("span",{class:"token operator"},"<"),(0,t.Uk)(" cbs"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("create"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("length"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Uk)("i"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(" cbs"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("create"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("i"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("emptyNode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 如果 vnode 中有子节点，创建子 vnode 对应的 DOM 元素并追加到 DOM 树上"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("is"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"array"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("children"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"for"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("i "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(" i "),(0,t.Wm)("span",{class:"token operator"},"<"),(0,t.Uk)(" children"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("length"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Uk)("i"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n          "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" ch "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" children"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("i"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n          "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("ch "),(0,t.Wm)("span",{class:"token operator"},"!="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"null"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n            api"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"appendChild"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"createElm"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("ch "),(0,t.Wm)("span",{class:"token keyword"},"as"),(0,t.Uk)(" VNode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" insertedVnodeQueue"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n          "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("is"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"primitive"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("text"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// 如果 vnode 的 text 值是 string/number，创建文本节点并追加到 DOM 树"),(0,t.Uk)("\n        api"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"appendChild"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" api"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"createTextNode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("text"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" hook "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("data"),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("hook\n      "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"isDef"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("hook"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// 执行用户传入的钩子 create"),(0,t.Uk)("\n        hook"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("create"),(0,t.Wm)("span",{class:"token operator"},"?."),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("emptyNode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("hook"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("insert"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n          "),(0,t.Wm)("span",{class:"token comment"},"// 把 vnode 添加到队列中，为后续执行 insert 钩子做准备"),(0,t.Uk)("\n          insertedVnodeQueue"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"push"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("vnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 如果选择器为空，创建文本节点"),(0,t.Uk)("\n      vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" api"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"createTextNode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("text"),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 返回新创建的 DOM                                "),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"9"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"10"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"11"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"12"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"13"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"14"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"15"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"16"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"17"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"18"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"19"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"20"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"21"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"22"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"23"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"24"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"25"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"26"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"27"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"28"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"29"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"30"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"31"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"32"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"33"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"34"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"35"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"36"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"37"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"38"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"39"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"40"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"41"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"42"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"43"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"44"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"45"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"46"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"47"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"48"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"49"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"50"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"51"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"52"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"53"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"54"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"55"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"56"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"57"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"58"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"59"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"60"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"61"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"62"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"63"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"64"),(0,t.Wm)("br")])])])],-1),ns=(0,t.Wm)("h3",{id:"patchvnode"},[(0,t.Wm)("a",{class:"header-anchor",href:"#patchvnode"},"#"),(0,t.Uk)(" patchVnode")],-1),ss=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Wm)("p",null,[(0,t.Wm)("strong",null,"功能：")]),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"patchVnode(oldVnode, vnode, insertedVnodeQueue)"),(0,t.Wm)("li",null,"对比 oldVnode 和 vnode 的差异，把差异渲染到 DOM")]),(0,t.Wm)("p",null,[(0,t.Wm)("img",{src:p,alt:"img"})])]),(0,t.Wm)("li",null,[(0,t.Wm)("p",null,[(0,t.Wm)("strong",null,"执行过程：")]),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Uk)("首先执行"),(0,t.Wm)("strong",null,"用户"),(0,t.Uk)("设置的 "),(0,t.Wm)("strong",null,"prepatch"),(0,t.Uk)(),(0,t.Wm)("strong",null,"钩子"),(0,t.Uk)("函数")]),(0,t.Wm)("li",null,[(0,t.Uk)("执行 create 钩子函数 "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Uk)("首先执行"),(0,t.Wm)("strong",null,"模块"),(0,t.Uk)("的 "),(0,t.Wm)("strong",null,"create"),(0,t.Uk)(),(0,t.Wm)("strong",null,"钩子"),(0,t.Uk)("函数")]),(0,t.Wm)("li",null,[(0,t.Uk)("然后执行"),(0,t.Wm)("strong",null,"用户"),(0,t.Uk)("设置的 "),(0,t.Wm)("strong",null,"create"),(0,t.Uk)(),(0,t.Wm)("strong",null,"钩子"),(0,t.Uk)("函数")])])]),(0,t.Wm)("li",null,[(0,t.Uk)("如果 "),(0,t.Wm)("strong",null,"vnode.text"),(0,t.Uk)(" 未定义 "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Uk)("如果 "),(0,t.Wm)("code",null,"oldVnode.children"),(0,t.Uk)(" 和 "),(0,t.Wm)("code",null,"vnode.children"),(0,t.Uk)(" 都有值 "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Uk)("调用 "),(0,t.Wm)("code",null,"updateChildren()")]),(0,t.Wm)("li",null,"使用 diff 算法对比子节点，更新子节点")])]),(0,t.Wm)("li",null,[(0,t.Uk)("如果 "),(0,t.Wm)("code",null,"vnode.children"),(0,t.Uk)(" 有值，"),(0,t.Wm)("code",null,"oldVnode.children"),(0,t.Uk)(" 无值 "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"清空 DOM 元素"),(0,t.Wm)("li",null,[(0,t.Uk)("调用 "),(0,t.Wm)("code",null,"addVnodes()"),(0,t.Uk)("，批量添加子节点")])])]),(0,t.Wm)("li",null,[(0,t.Uk)("如果 "),(0,t.Wm)("code",null,"oldVnode.children"),(0,t.Uk)(" 有值，"),(0,t.Wm)("code",null,"vnode.children"),(0,t.Uk)(" 无值 "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Uk)("调用 "),(0,t.Wm)("code",null,"removeVnodes()"),(0,t.Uk)("，批量移除子节点")])])]),(0,t.Wm)("li",null,[(0,t.Uk)("如果 "),(0,t.Wm)("strong",null,"oldVnode.text"),(0,t.Uk)(" 有值 "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"清空 DOM 元素的内容")])])])]),(0,t.Wm)("li",null,[(0,t.Uk)("如果设置了 "),(0,t.Wm)("code",null,"vnode.text"),(0,t.Uk)(" 并且和和 "),(0,t.Wm)("code",null,"oldVnode.text"),(0,t.Uk)(" 不等 "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"如果老节点有子节点，全部移除"),(0,t.Wm)("li",null,[(0,t.Uk)("设置 DOM 元素的 "),(0,t.Wm)("code",null,"textContent"),(0,t.Uk)(" 为 "),(0,t.Wm)("code",null,"vnode.text")])])]),(0,t.Wm)("li",null,[(0,t.Uk)("最后执行用户"),(0,t.Wm)("strong",null,"设置的"),(0,t.Uk)(),(0,t.Wm)("strong",null,"postpatch"),(0,t.Uk)(),(0,t.Wm)("strong",null,"钩子"),(0,t.Uk)("函数")])])]),(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"源码位置：src/package/init.ts"),(0,t.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"patchVnode"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("oldVnode"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" VNode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" VNode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" insertedVnodeQueue"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" VNodeQueue")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" hook "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("data"),(0,t.Wm)("span",{class:"token operator"},"?."),(0,t.Uk)("hook\n    "),(0,t.Wm)("span",{class:"token comment"},"// 首先执行用户设置的 prepatch 钩子函数"),(0,t.Uk)("\n    hook"),(0,t.Wm)("span",{class:"token operator"},"?."),(0,t.Uk)("prepatch"),(0,t.Wm)("span",{class:"token operator"},"?."),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" elm "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" oldCh "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("children "),(0,t.Wm)("span",{class:"token keyword"},"as"),(0,t.Uk)(" VNode"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" ch "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("children "),(0,t.Wm)("span",{class:"token keyword"},"as"),(0,t.Uk)(" VNode"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n  \t"),(0,t.Wm)("span",{class:"token comment"},"// 如果新老 vnode 相同返回"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldVnode "),(0,t.Wm)("span",{class:"token operator"},"==="),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("data "),(0,t.Wm)("span",{class:"token operator"},"!=="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"undefined"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 执行模块的 update 钩子函数"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"for"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" i "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(" i "),(0,t.Wm)("span",{class:"token operator"},"<"),(0,t.Uk)(" cbs"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("update"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("length"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Uk)("i"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(" cbs"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("update"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("i"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 执行用户设置的 update 钩子函数"),(0,t.Uk)("\n      vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("data"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("hook"),(0,t.Wm)("span",{class:"token operator"},"?."),(0,t.Uk)("update"),(0,t.Wm)("span",{class:"token operator"},"?."),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  \t"),(0,t.Wm)("span",{class:"token comment"},"// 如果 vnode.text 未定义"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"isUndef"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("text"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 如果新老节点都有 children"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"isDef"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldCh"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"&&"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"isDef"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("ch"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// 调用 updateChildren 对比子节点，更新子节点"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldCh "),(0,t.Wm)("span",{class:"token operator"},"!=="),(0,t.Uk)(" ch"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"updateChildren"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" ch"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" insertedVnodeQueue"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"isDef"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("ch"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// 如果新节点有 children，老节点没有 children"),(0,t.Uk)("\n      \t"),(0,t.Wm)("span",{class:"token comment"},"// 如果老节点有text，清空dom 元素的内容"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"isDef"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("text"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(" api"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"setTextContent"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"''"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// 批量添加子节点"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token function"},"addVnodes"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"null"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" ch"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" ch"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("length "),(0,t.Wm)("span",{class:"token operator"},"-"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"1"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" insertedVnodeQueue"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"isDef"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldCh"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// 如果老节点有children，新节点没有children"),(0,t.Uk)("\n      \t"),(0,t.Wm)("span",{class:"token comment"},"// 批量移除子节点"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token function"},"removeVnodes"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("length "),(0,t.Wm)("span",{class:"token operator"},"-"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"1"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"isDef"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("text"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// 如果老节点有 text，清空 DOM 元素"),(0,t.Uk)("\n        api"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"setTextContent"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"''"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("text "),(0,t.Wm)("span",{class:"token operator"},"!=="),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("text"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 如果没有设置 vnode.text"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"isDef"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldCh"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// 如果老节点有 children，移除"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token function"},"removeVnodes"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("length "),(0,t.Wm)("span",{class:"token operator"},"-"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"1"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 设置 DOM 元素的 textContent 为 vnode.text"),(0,t.Uk)("\n      api"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"setTextContent"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("text"),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 最后执行用户设置的 postpatch 钩子函数"),(0,t.Uk)("\n    hook"),(0,t.Wm)("span",{class:"token operator"},"?."),(0,t.Uk)("postpatch"),(0,t.Wm)("span",{class:"token operator"},"?."),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"9"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"10"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"11"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"12"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"13"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"14"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"15"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"16"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"17"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"18"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"19"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"20"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"21"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"22"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"23"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"24"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"25"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"26"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"27"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"28"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"29"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"30"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"31"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"32"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"33"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"34"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"35"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"36"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"37"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"38"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"39"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"40"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"41"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"42"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"43"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"44"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"45"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"46"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"47"),(0,t.Wm)("br")])])])],-1),as=(0,t.Wm)("h3",{id:"updatechildren"},[(0,t.Wm)("a",{class:"header-anchor",href:"#updatechildren"},"#"),(0,t.Uk)(" updateChildren")],-1),ts=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Wm)("p",null,[(0,t.Wm)("strong",null,"功能：")]),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"diff 算法的核心，对比新旧节点的 children，更新 DOM")])]),(0,t.Wm)("li",null,[(0,t.Wm)("p",null,[(0,t.Wm)("strong",null,"执行过程：")]),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"要对比两棵树的差异，我们可以取第一棵树的每一个节点依次和第二课树的每一个节点比较，但是这样的时间复杂度为 O(n^3)"),(0,t.Wm)("li",null,"在DOM 操作的时候我们很少很少会把一个父节点移动/更新到某一个子节点"),(0,t.Wm)("li",null,[(0,t.Uk)("因此只需要找"),(0,t.Wm)("strong",null,"同级别"),(0,t.Uk)("的子"),(0,t.Wm)("strong",null,"节点"),(0,t.Uk)("依次"),(0,t.Wm)("strong",null,"比较"),(0,t.Uk)("，然后再找下一级别的节点比较，这样算法的时间复杂度为 O(n)")])]),(0,t.Wm)("p",null,[(0,t.Wm)("img",{src:o,alt:"image-20200102103653779.png"})]),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"在进行同级别节点比较的时候，首先会对新老节点数组的开始和结尾节点设置标记索引，遍历的过程中移动索引"),(0,t.Wm)("li",null,[(0,t.Uk)("在对"),(0,t.Wm)("strong",null,"开始和结束节点"),(0,t.Uk)("比较的时候，总共有四种情况 "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"oldStartVnode / newStartVnode (旧开始节点 / 新开始节点)"),(0,t.Wm)("li",null,"oldEndVnode / newEndVnode (旧结束节点 / 新结束节点)"),(0,t.Wm)("li",null,"oldStartVnode / oldEndVnode (旧开始节点 / 新结束节点)"),(0,t.Wm)("li",null,"oldEndVnode / newStartVnode (旧结束节点 / 新开始节点)")])])]),(0,t.Wm)("p",null,[(0,t.Wm)("img",{src:l,alt:"image-20200109184608649"})]),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Uk)("开始节点和结束节点比较，这两种情况类似 "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"oldStartVnode / newStartVnode (旧开始节点 / 新开始节点)"),(0,t.Wm)("li",null,"oldEndVnode / newEndVnode (旧结束节点 / 新结束节点)")])]),(0,t.Wm)("li",null,[(0,t.Uk)("如果 oldStartVnode 和 newStartVnode 是 sameVnode (key 和 sel 相同) "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"调用 patchVnode() 对比和更新节点"),(0,t.Wm)("li",null,"把旧开始和新开始索引往后移动 oldStartIdx++ / oldEndIdx++")])])]),(0,t.Wm)("p",null,[(0,t.Wm)("img",{src:c,alt:"image-20200103121812840"})]),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Uk)("oldStartVnode / newEndVnode (旧开始节点 / 新结束节点) 相同 "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"调用 patchVnode() 对比和更新节点"),(0,t.Wm)("li",null,"把 oldStartVnode 对应的 DOM 元素，移动到右边 - 更新索引")])])]),(0,t.Wm)("p",null,[(0,t.Wm)("img",{src:m,alt:"image-20200103125428541"})]),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Uk)("oldEndVnode / newStartVnode (旧结束节点 / 新开始节点) 相同 "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"调用 patchVnode() 对比和更新节点"),(0,t.Wm)("li",null,"把 oldEndVnode 对应的 DOM 元素，移动到左边"),(0,t.Wm)("li",null,"更新索引")])])]),(0,t.Wm)("p",null,[(0,t.Wm)("img",{src:u,alt:"image-20200103125735048"})]),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Uk)("如果不是以上四种情况 "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"遍历新节点，使用 newStartNode 的 key 在老节点数组中找相同节点"),(0,t.Wm)("li",null,[(0,t.Uk)("如果没有找到，说明 newStartNode 是新节点 "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"创建新节点对应的 DOM 元素，插入到 DOM 树中")])]),(0,t.Wm)("li",null,[(0,t.Uk)("如果找到了 "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"判断新节点和找到的老节点的 sel 选择器是否相同"),(0,t.Wm)("li",null,[(0,t.Uk)("如果不相同，说明节点被修改了 "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"重新创建对应的 DOM 元素，插入到 DOM 树中")])]),(0,t.Wm)("li",null,"如果相同，把 elmToMove 对应的 DOM 元素，移动到左边")])])])])]),(0,t.Wm)("p",null,[(0,t.Wm)("img",{src:k,alt:"image-20200109184822439"})]),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Uk)("循环结束 "),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"当老节点的所有子节点先遍历完 (oldStartIdx > oldEndIdx)，循环结束"),(0,t.Wm)("li",null,"新节点的所有子节点先遍历完 (newStartIdx > newEndIdx)，循环结束")])]),(0,t.Wm)("li",null,"如果老节点的数组先遍历完(oldStartIdx > oldEndIdx)，说明新节点有剩余，把剩余节点批量插入到右边")]),(0,t.Wm)("p",null,[(0,t.Wm)("img",{src:W,alt:"image-20200103150918335"})]),(0,t.Wm)("p",null,"​"),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"如果新节点的数组先遍历完(newStartIdx > newEndIdx)，说明老节点有剩余，把剩余节点批量删除")]),(0,t.Wm)("p",null,[(0,t.Wm)("img",{src:i,alt:"image-20200109194751093"})])]),(0,t.Wm)("li",null,[(0,t.Wm)("p",null,"源码位置：src/package/init.ts"),(0,t.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"updateChildren"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("parentElm"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" Node"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  oldCh"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" VNode"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  newCh"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" VNode"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  insertedVnodeQueue"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" VNodeQueue")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" oldStartIdx "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" newStartIdx "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" oldEndIdx "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("length "),(0,t.Wm)("span",{class:"token operator"},"-"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"1"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" oldStartVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" oldEndVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("oldEndIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" newEndIdx "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newCh"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("length "),(0,t.Wm)("span",{class:"token operator"},"-"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"1"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" newStartVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" newEndVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("newEndIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" oldKeyToIdx"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" KeyToIndexMap "),(0,t.Wm)("span",{class:"token operator"},"|"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"undefined"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" idxInOld"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" number\n  "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" elmToMove"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" VNode\n  "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" before"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" any\n\n  "),(0,t.Wm)("span",{class:"token keyword"},"while"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldStartIdx "),(0,t.Wm)("span",{class:"token operator"},"<="),(0,t.Uk)(" oldEndIdx "),(0,t.Wm)("span",{class:"token operator"},"&&"),(0,t.Uk)(" newStartIdx "),(0,t.Wm)("span",{class:"token operator"},"<="),(0,t.Uk)(" newEndIdx"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 索引变化后，可能会把节点设置为空"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldStartVnode "),(0,t.Wm)("span",{class:"token operator"},"=="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"null"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 节点为空移动索引"),(0,t.Uk)("\n      oldStartVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Uk)("oldStartIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// Vnode might have been moved left"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldEndVnode "),(0,t.Wm)("span",{class:"token operator"},"=="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"null"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      oldEndVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token operator"},"--"),(0,t.Uk)("oldEndIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("newStartVnode "),(0,t.Wm)("span",{class:"token operator"},"=="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"null"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      newStartVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Uk)("newStartIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("newEndVnode "),(0,t.Wm)("span",{class:"token operator"},"=="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"null"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      newEndVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token operator"},"--"),(0,t.Uk)("newEndIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 比较开始和结束节点的四种情况"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"sameVnode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 1. 比较老开始节点和新的开始节点"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token function"},"patchVnode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" insertedVnodeQueue"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      oldStartVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Uk)("oldStartIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n      newStartVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Uk)("newStartIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"sameVnode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldEndVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newEndVnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 2. 比较老结束节点和新的结束节点"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token function"},"patchVnode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldEndVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newEndVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" insertedVnodeQueue"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      oldEndVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token operator"},"--"),(0,t.Uk)("oldEndIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n      newEndVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token operator"},"--"),(0,t.Uk)("newEndIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"sameVnode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newEndVnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// Vnode moved right"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 3. 比较老开始节点和新的结束节点"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token function"},"patchVnode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newEndVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" insertedVnodeQueue"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      api"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"insertBefore"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("parentElm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" api"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"nextSibling"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldEndVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      oldStartVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Uk)("oldStartIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n      newEndVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token operator"},"--"),(0,t.Uk)("newEndIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"sameVnode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldEndVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// Vnode moved left"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 4. 比较老结束节点和新的开始节点"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token function"},"patchVnode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldEndVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" insertedVnodeQueue"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      api"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"insertBefore"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("parentElm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldEndVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      oldEndVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token operator"},"--"),(0,t.Uk)("oldEndIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n      newStartVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Uk)("newStartIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 开始节点和结束节点都不相同"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 使用 newStartNode 的 key 再老节点数组中找相同节点"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 先设置记录 key 和 index 的对象"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldKeyToIdx "),(0,t.Wm)("span",{class:"token operator"},"==="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"undefined"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        oldKeyToIdx "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"createKeyToOldIdx"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldCh"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldStartIdx"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldEndIdx"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 遍历 newStartVnode, 从老的节点中找相同 key 的 oldVnode 的索引"),(0,t.Uk)("\n      idxInOld "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldKeyToIdx"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("newStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("key "),(0,t.Wm)("span",{class:"token keyword"},"as"),(0,t.Uk)(" string"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 如果是新的vnode"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"isUndef"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("idxInOld"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// New element"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// 如果没找到，newStartNode 是新节点"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// 创建元素插入 DOM 树"),(0,t.Uk)("\n        api"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"insertBefore"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("parentElm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"createElm"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("newStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" insertedVnodeQueue"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// 如果找到相同 key 相同的老节点，记录到 elmToMove 遍历"),(0,t.Uk)("\n        elmToMove "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("idxInOld"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("elmToMove"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("sel "),(0,t.Wm)("span",{class:"token operator"},"!=="),(0,t.Uk)(" newStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("sel"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n          "),(0,t.Wm)("span",{class:"token comment"},"// 如果新旧节点的选择器不同"),(0,t.Uk)("\n          "),(0,t.Wm)("span",{class:"token comment"},"// 创建新开始节点对应的 DOM 元素，插入到 DOM 树中"),(0,t.Uk)("\n          api"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"insertBefore"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("parentElm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"createElm"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("newStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" insertedVnodeQueue"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n          "),(0,t.Wm)("span",{class:"token comment"},"// 如果相同，patchVnode()"),(0,t.Uk)("\n          "),(0,t.Wm)("span",{class:"token comment"},"// 把 elmToMove 对应的 DOM 元素，移动到左边"),(0,t.Uk)("\n          "),(0,t.Wm)("span",{class:"token function"},"patchVnode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("elmToMove"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" insertedVnodeQueue"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n          oldCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("idxInOld"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"undefined"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"as"),(0,t.Uk)(" any\n          api"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"insertBefore"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("parentElm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" elmToMove"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 重新给 newStartVnode 赋值，指向下一个新节点"),(0,t.Uk)("\n      newStartVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Uk)("newStartIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 循环结束，老节点数组先遍历完成或者新节点数组先遍历完成"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldStartIdx "),(0,t.Wm)("span",{class:"token operator"},"<="),(0,t.Uk)(" oldEndIdx "),(0,t.Wm)("span",{class:"token operator"},"||"),(0,t.Uk)(" newStartIdx "),(0,t.Wm)("span",{class:"token operator"},"<="),(0,t.Uk)(" newEndIdx"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldStartIdx "),(0,t.Wm)("span",{class:"token operator"},">"),(0,t.Uk)(" oldEndIdx"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 如果老节点数组先遍历完成，说明有新的节点剩余"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 把剩余的新节点都插入到右边"),(0,t.Uk)("\n      before "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("newEndIdx "),(0,t.Wm)("span",{class:"token operator"},"+"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"1"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"=="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"null"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"?"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"null"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" newCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("newEndIdx "),(0,t.Wm)("span",{class:"token operator"},"+"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"1"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm\n      "),(0,t.Wm)("span",{class:"token function"},"addVnodes"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("parentElm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" before"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newCh"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newStartIdx"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newEndIdx"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" insertedVnodeQueue"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 如果新节点数组先遍历完成，说明老节点有剩余"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 批量删除老节点"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token function"},"removeVnodes"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("parentElm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldStartIdx"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldEndIdx"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"9"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"10"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"11"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"12"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"13"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"14"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"15"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"16"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"17"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"18"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"19"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"20"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"21"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"22"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"23"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"24"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"25"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"26"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"27"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"28"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"29"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"30"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"31"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"32"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"33"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"34"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"35"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"36"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"37"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"38"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"39"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"40"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"41"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"42"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"43"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"44"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"45"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"46"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"47"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"48"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"49"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"50"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"51"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"52"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"53"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"54"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"55"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"56"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"57"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"58"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"59"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"60"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"61"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"62"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"63"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"64"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"65"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"66"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"67"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"68"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"69"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"70"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"71"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"72"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"73"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"74"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"75"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"76"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"77"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"78"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"79"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"80"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"81"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"82"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"83"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"84"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"85"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"86"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"87"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"88"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"89"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"90"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"91"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"92"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"93"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"94"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"95"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"96"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"97"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"98"),(0,t.Wm)("br")])])])],-1),es=(0,t.Wm)("h3",{id:"调试-updatechildren"},[(0,t.Wm)("a",{class:"header-anchor",href:"#调试-updatechildren"},"#"),(0,t.Uk)(" 调试 updateChildren")],-1),os=(0,t.Wm)("div",{class:"language-html ext-html line-numbers-mode"},[(0,t.Wm)("pre",{class:"language-html"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Uk)("ul")]),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Uk)("li")]),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)("首页"),(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token punctuation"},"</"),(0,t.Uk)("li")]),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Uk)("li")]),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)("微博"),(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token punctuation"},"</"),(0,t.Uk)("li")]),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Uk)("li")]),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)("视频"),(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token punctuation"},"</"),(0,t.Uk)("li")]),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token punctuation"},"</"),(0,t.Uk)("ul")]),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Uk)("ul")]),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Uk)("li")]),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)("首页"),(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token punctuation"},"</"),(0,t.Uk)("li")]),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Uk)("li")]),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)("视频"),(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token punctuation"},"</"),(0,t.Uk)("li")]),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Uk)("li")]),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)("微博"),(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token punctuation"},"</"),(0,t.Uk)("li")]),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token punctuation"},"</"),(0,t.Uk)("ul")]),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)("\n")])]),(0,t.Wm)("div",{class:"line-numbers"},[(0,t.Wm)("span",{class:"line-number"},"1"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"2"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"3"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"4"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"5"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"6"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"7"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"8"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"9"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"10"),(0,t.Wm)("br"),(0,t.Wm)("span",{class:"line-number"},"11"),(0,t.Wm)("br")])],-1),ps=(0,t.Wm)("p",null,[(0,t.Wm)("img",{src:r,alt:"image-20200112120036948"})],-1),ls={render:function(n,s){const a=(0,t.up)("OutboundLink");return(0,t.wg)(),(0,t.j4)(t.HY,null,[U,d,b,h,g,f,(0,t.Wm)("ul",null,[w,y,v,V,(0,t.Wm)("li",null,[(0,t.Wm)("p",null,[x,(0,t.Wm)("a",N,[O,(0,t.Wm)(a)]),E]),D])]),M,S,I,(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Wm)("a",j,[C,(0,t.Wm)(a)]),T]),(0,t.Wm)("li",null,[(0,t.Wm)("a",A,[_,(0,t.Wm)(a)])])]),Q,(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Wm)("a",P,[q,(0,t.Wm)(a)])]),(0,t.Wm)("li",null,[(0,t.Wm)("a",R,[L,(0,t.Wm)(a)])])]),B,H,(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Wm)("p",null,[K,(0,t.Wm)("a",F,[Y,(0,t.Wm)(a)])])]),(0,t.Wm)("li",null,[(0,t.Wm)("p",null,[G,(0,t.Wm)("a",J,[z,(0,t.Wm)(a)])]),$]),X]),Z,nn,sn,an,tn,en,on,pn,ln,cn,mn,un,kn,Wn,rn,Un,dn,bn,hn,gn,fn,wn,yn,vn,Vn,xn,Nn,On,En,Dn,Mn,Sn,In,jn,(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[Cn,(0,t.Wm)("ul",null,[Tn,(0,t.Wm)("li",null,[(0,t.Wm)("p",null,[An,(0,t.Wm)("a",_n,[Qn,(0,t.Wm)(a)]),Pn])]),qn])]),Rn]),Ln,Bn,Hn,Kn,Fn,Yn,Gn,Jn,zn,$n,Xn,Zn,ns,ss,as,ts,es,os,ps],64)}}}}]);